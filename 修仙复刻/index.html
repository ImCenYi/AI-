<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>指数修仙：丹药无双 (副本秘宝版)</title>
    <link rel="stylesheet" href="css/style.css">
<style>
/* 大千宝录UI美化样式 */

/* 里程碑动画效果 */
@keyframes milestone-glow {
    0%, 100% { box-shadow: 0 0 10px rgba(251, 191, 36, 0.3); }
    50% { box-shadow: 0 0 20px rgba(251, 191, 36, 0.6); }
}

#ancient-treasure-milestone {
    animation: milestone-glow 2s ease-in-out infinite;
}

/* 界域进度条动画 */
#ancient-treasure-realms div div div:last-child div {
    transition: width 0.5s ease-out;
}

/* 古宝卡片光效 */
.treasure-card {
    transition: all 0.3s ease;
}

.treasure-card:hover {
    transform: translateY(-2px);
}

/* 品质光晕效果 */
.treasure-card.ur {
    animation: ur-glow 2s ease-in-out infinite;
}

@keyframes ur-glow {
    0%, 100% { box-shadow: 0 0 5px rgba(220, 38, 38, 0.5); }
    50% { box-shadow: 0 0 15px rgba(220, 38, 38, 0.8); }
}

.treasure-card.ssr {
    animation: ssr-glow 2s ease-in-out infinite;
}

@keyframes ssr-glow {
    0%, 100% { box-shadow: 0 0 5px rgba(234, 88, 12, 0.5); }
    50% { box-shadow: 0 0 15px rgba(234, 88, 12, 0.8); }
}

/* 升级成功特效 */
@keyframes upgrade-success {
    0% { transform: scale(1); opacity: 1; }
    50% { transform: scale(1.2); opacity: 0.8; }
    100% { transform: scale(1); opacity: 1; }
}

.upgrade-flash {
    animation: upgrade-success 0.5s ease-out;
}

/* 寻宝结果闪光效果 */
@keyframes draw-shine {
    0% { background-position: -200% 0; }
    100% { background-position: 200% 0; }
}

.draw-result-shine {
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
    background-size: 200% 100%;
    animation: draw-shine 1s ease-out;
}

/* 完成界域庆祝动画 */
@keyframes realm-complete {
    0% { transform: scale(0.8); opacity: 0; }
    50% { transform: scale(1.1); opacity: 1; }
    100% { transform: scale(1); opacity: 1; }
}

.realm-complete-anim {
    animation: realm-complete 0.6s ease-out;
}

/* 进度条填充动画 */
@keyframes progress-fill {
    from { width: 0; }
    to { width: var(--progress-width); }
}

.progress-animated {
    animation: progress-fill 1s ease-out forwards;
}

/* 按钮悬停光效 */
.sys-btn:hover {
    box-shadow: 0 0 15px rgba(59, 130, 246, 0.5);
}
</style>
</head>
<body>

<header>
    <h1>指数修仙：丹药无双 (副本秘宝版)</h1>
    <div class="header-controls">
        <div class="difficulty-badge" id="level-display">荒野层数: 0 (凡人)</div>
        <button class="cheat-btn" onclick="game.toggleCheatModal()">🔥 金手指</button>
    </div>
</header>

<div id="game-container">
    <!-- Left Panel: Stats & Equipment -->
    <div class="panel">
        <div class="panel-title">修士属性</div>
        <div class="stat-row"><span>生命值:</span> <span id="stat-hp" class="val">300 / 300</span></div>
        <div class="stat-row"><span>攻击力:</span> <span id="stat-atk" class="val">50</span></div>
        <div class="stat-row"><span>暴击率:</span> <span id="stat-crit" class="val">0%</span></div>
        
        <div class="panel-title" style="margin-top:10px; display:flex; justify-content:space-between; align-items:center;">
            <span>加成统计</span>
            <button class="sys-btn" style="padding:2px 8px; font-size:0.7rem;" onclick="game.openStatsDetailModal()">📊 详情</button>
        </div>
        <div class="stat-row"><span>境界加成:</span> <span id="mul-realm" class="val">x1.00</span></div>
        <div class="stat-row"><span>法则倍率:</span> <span id="mul-atk" class="val">100%</span> (攻/血)</div>
        <div class="stat-row"><span>通天塔掉率:</span> <span id="mul-drop" class="val">0%</span></div>
        <div class="stat-row"><span>秘宝加成:</span> <span id="bonus-treasure" class="val" style="font-size:0.8rem">无</span></div>

        <div class="panel-title" style="margin-top:10px;">装备 (自动替换)</div>
        <div class="equip-grid" id="equip-grid">
            <!-- Generated by JS -->
        </div>
    </div>

    <!-- Center Panel: Combat -->
    <div class="panel" style="position: relative;">
        <div class="panel-title" id="stage-name">荒野 - 第 0 层</div>
        
        <div class="combat-scene">
            <div id="damage-overlay" style="position:absolute; width:100%; height:100%; pointer-events:none;"></div>
            <div id="skill-overlay" style="position:absolute; width:100%; height:100%; pointer-events:none;"></div>
            
            <div id="resurrect-overlay" class="resurrect-overlay">
                <div id="resurrect-text">已死亡<br><span style="font-size:1rem; color:#fff;">2秒后复活...</span></div>
            </div>

            <!-- Enemy Grid Container -->
            <div class="enemy-container" id="enemy-container">
                <!-- Enemies injected here -->
            </div>
            
            <div style="height: 30px; text-align: center; color: #555; font-size: 0.8rem; display: flex; align-items: center;">
                VS
            </div>

            <!-- Player -->
            <div class="entity player-entity" id="player-entity">
                <span>⚔️</span>
                <div class="hp-bar-container">
                    <div class="hp-bar-fill" id="player-hp-bar" style="width: 100%;"></div>
                </div>
            </div>
        </div>

        <div class="controls">
            <!-- Modified Button -->
            <button class="btn-boss" id="btn-challenge" 
                onclick="game.manualSummonBoss()" 
                oncontextmenu="event.preventDefault(); game.toggleAutoBoss()">
                💀 召唤荒野BOSS (右键自动)
            </button>
        </div>
        
        <div id="battle-log"></div>
    </div>

    <!-- Right Panel: Game Systems -->
    <div class="panel">
        <div class="panel-title">游戏系统</div>
        
        <div class="tabs">
            <button class="tab-btn active" onclick="game.switchTab('law')">☯️ 法则悟道</button>
            <button class="tab-btn" onclick="game.switchTab('dungeon')">🔥 副本探险</button>
            <button class="tab-btn" onclick="game.switchTab('realm')">✨ 境界突破</button>
<button class="tab-btn" onclick="game.switchTab('garden')">🌿 百草灵园</button>
            <button class="tab-btn" onclick="game.switchTab('ancient-treasure')">📜 大千宝录</button>
            <button class="tab-btn" onclick="game.switchTab('zhou-tian')">⭐ 周天星窍</button>
            <button class="tab-btn" onclick="game.openStarBeastModal()">🌟 星空巨兽</button>
            <button class="tab-btn" onclick="game.switchTab('abyss')">🌑 深渊遗宝</button>
        </div>

        <!-- Law Cultivation Tab (法则悟道 - 合并法则修炼+通天塔) -->
        <div id="tab-law" class="tab-content active">
            <!-- 上部：法则修炼 -->
            <div class="system-section">
                <div class="res-display" style="border:none; color:#00bcd4;">📿 法则修炼</div>
                <div class="res-display">法则真意: <span id="res-law">0</span></div>
                <div class="sub-stat">当前轮次: <span id="cult-round" class="val">0</span></div>
                <div class="sub-stat">修炼进度: <span id="cult-step" class="val">0 / 10</span></div>
                <div class="sub-stat">下次加成: <span id="cult-next" class="highlight">攻击 +10%</span></div>
                <div class="sub-stat">单次消耗: <span id="cult-cost">2</span></div>
                <div style="display:flex; gap:5px; margin-top:10px;">
                    <button class="sys-btn btn-cultivate" onclick="game.cultivate()">✨ 感悟法则</button>
                    <button class="sys-btn btn-cultivate-all" onclick="game.cultivateAll()">⚡ 一键感悟</button>
                </div>
            </div>
            
            <!-- 下部：通天塔 -->
            <div class="system-section" style="margin-top:10px;">
                <div class="res-display" style="border:none; color:#3f51b5;">🗼 通天塔</div>
                <div class="sub-stat">当前层数: <span id="tower-lv" class="val">0</span></div>
                <div class="sub-stat">怪物强度: <span class="highlight">10^层数</span> (极难)</div>
                <div class="sub-stat">掉落真意: <span id="tower-drop">1</span></div>
                <button class="sys-btn btn-tower" id="btn-tower-toggle" onclick="game.toggleTowerMode()">🗼 挑战通天塔</button>
                <div style="font-size:0.7rem; color:#888; margin-top:5px;">
                    * 挑战通天塔可获得法则真意<br>
                    * 每10层法则掉率翻倍
                </div>
            </div>
        </div>

        <!-- Dungeon & Treasure Tab (副本探险 - 合并副本+秘宝) -->
        <div id="tab-dungeon" class="tab-content">
            <!-- 上部：副本挑战 -->
            <div class="system-section">
                <div class="res-display" style="border:none; color:#e65100;">🔥 血色副本</div>
                <div class="sub-stat">当前层数: <span id="dungeon-tier" class="val">T1</span></div>
                <div class="sub-stat">副本难度: <span id="dungeon-lv" class="val">1</span></div>
                <div class="sub-stat">当前进度: <span id="dungeon-status">未开启</span></div>
                <div class="sub-stat">自动倒计时: <span id="dungeon-timer">--</span></div>
                
                <!-- 层数选择 - 无限层数 -->
                <div style="margin: 10px 0; padding: 8px; background: #1a1a1a; border-radius: 5px;">
                    <div style="font-size: 0.75rem; color: #888; margin-bottom: 5px;">输入层数 (T-A):</div>
                    <div style="display: flex; gap: 5px; align-items: center;">
                        <span style="color: #888;">T-</span>
                        <input type="number" id="dungeon-tier-input" value="1" min="1" style="flex: 1; padding: 5px 8px; background: #262626; border: 1px solid #444; color: #fff; border-radius: 3px; font-size: 0.9rem; width: 60px;">
                        <button onclick="game.dungeon.setTierFromInput()" style="padding: 5px 12px; background: #e65100; border: none; color: white; border-radius: 3px; cursor: pointer; font-size: 0.8rem;">前往</button>
                    </div>
                    <div id="dungeon-recommend-tier" style="font-size: 0.7rem; color: #4ade80; margin-top: 5px;">推荐层数: T1</div>
                    <div id="dungeon-unlock-hint" style="font-size: 0.7rem; color: #ff9800; margin-top: 3px;"></div>
                </div>
                
                <button class="sys-btn btn-dungeon" id="btn-dungeon-toggle" onclick="game.toggleDungeonMode()">🔥 进入副本</button>
                <div style="font-size:0.7rem; color:#888; margin-top:5px;">
                    * 伤害数值压缩: (log伤害)^2。<br>
                    * 通关获得秘宝宝箱与碎片。
                </div>
            </div>
            
            <!-- 下部：秘宝系统 -->
            <div class="system-section" style="margin-top:10px;">
                <div class="res-display" style="border:none; color:#7b1fa2;">🏺 秘宝阁</div>
                <div class="sub-stat">待开宝箱: <span id="chest-count" class="highlight">0</span></div>
                <div class="sub-stat">剩余次数: <span id="treasure-daily">20 / 20</span></div>
                <div class="sub-stat">秘宝碎片: <span id="treasure-frags">0</span></div>
                <button class="sys-btn btn-treasure" onclick="game.openTreasureModal()">🚪 进入秘宝阁</button>
                <div style="font-size:0.7rem; color:#888; margin-top:5px;">
                    * 通关副本获得宝箱<br>
                    * 每日20次开启限制
                </div>
            </div>
        </div>

        <!-- Realm Breakthrough Tab (境界突破 - 独立标签) -->
        <div id="tab-realm" class="tab-content">
            <div class="system-section">
                <div class="res-display" style="border:none; color:#ffd700;">✨ 境界突破</div>
                <div class="sub-stat">当前境界: <span id="realm-name" class="val highlight">凡人-武者</span></div>
                <div class="sub-stat">境界加成: <span id="realm-bonus" class="val">x1.00</span> (全属性)</div>
                <div class="sub-stat">下一境界: <span id="next-realm" class="val">练气-初期</span></div>
                <div class="sub-stat">突破需求: 历史最高难度达到 <span id="realm-req" class="val highlight">N4</span></div>
                <div class="sub-stat">突破跨度: <span id="realm-span" class="val highlight" style="color:#f59e0b;">跨越 3 层</span></div>
                <div class="sub-stat">突破倍率: <span id="realm-multiplier" class="val highlight" style="color:#ef4444;">x1.33</span></div>
                <div class="sub-stat">当前进度: <span id="realm-progress" class="val">1/4 (25%)</span></div>

                <button class="sys-btn btn-realm" id="btn-realm-challenge" onclick="game.summonRealmBoss()" disabled>🔒 难度不足</button>
                <div style="font-size:0.7rem; color:#888; margin-top:5px;">
                    * 达到指定难度后可挑战境界天劫<br>
                    * 击败天劫BOSS即可突破境界<br>
                    * <b style="color:#f59e0b;">突破跨度越大，获得的加成越丰厚！</b>
                </div>
            </div>
        </div>

        <!-- Spirit Garden Tab (百草灵园 - 概览入口) -->
        <div id="tab-garden" class="tab-content">
            <div class="system-section">
                <div class="res-display" style="border:none; color:#22c55e;">🌿 百草灵园</div>
                
                <!-- 等级和转数 -->
                <div class="sub-stat">
                    <span>灵植等级:</span>
                    <span>Lv.<span id="garden-overview-level" class="val highlight">1</span> 
                    (<span id="garden-overview-turn">凡阶</span>)</span>
                </div>
                
                <!-- 灵石和收入 -->
                <div class="sub-stat">
                    <span>灵石储备:</span>
                    <span id="garden-overview-stones" class="val">100</span>
                </div>
                <div class="sub-stat">
                    <span>灵石收入:</span>
                    <span id="garden-overview-income" class="val highlight" style="color:#22c55e;">+0/分</span>
                </div>
                <div class="sub-stat">
                    <span>生灵精华:</span>
                    <span id="garden-overview-essence" class="val highlight" style="color:#a78bfa;">0</span>
                    <span style="font-size:0.7rem; color:#888;">(+<span id="garden-overview-essence-rate">0</span>/分)</span>
                </div>
                
                <!-- 炼体信息 -->
                <div style="background: rgba(139,92,246,0.1); border: 1px solid #8b5cf6; border-radius: 8px; padding: 8px; margin: 10px 0;">
                    <div style="color: #8b5cf6; font-size: 0.8rem; font-weight: bold; margin-bottom: 5px;">⚔️ 炼体锻身</div>
                    <div class="sub-stat" style="margin:3px 0;">
                        <span>锻体境界:</span>
                        <span id="garden-overview-refine-realm" class="val" style="color:#888;">第1境·凡胎</span>
                    </div>
                    <div class="sub-stat" style="margin:3px 0;">
                        <span>当前进度:</span>
                        <span><span id="garden-overview-refine-step" class="val">0</span>/10</span>
                    </div>
                    <div class="sub-stat" style="margin:3px 0;">
                        <span>肉身强度:</span>
                        <span id="garden-overview-meridian-bonus" class="val" style="color:#ef4444;">×1 / +0%</span>
                    </div>
                </div>
                
                <!-- 土地状态 -->
                <div class="sub-stat">
                    <span>已开垦:</span>
                    <span><span id="garden-overview-lands">4</span>/16 块</span>
                </div>
                <div class="sub-stat">
                    <span>可收获:</span>
                    <span id="garden-overview-mature" class="val highlight" style="color:#fbbf24;">0</span>
                </div>
                
                <!-- 进入灵植园按钮 -->
                <button class="sys-btn btn-garden" onclick="game.openGardenModal()" style="margin-top:10px; background:linear-gradient(to right, #15803d, #22c55e);">
                    <i class="fas fa-leaf"></i> 进入灵植园
                </button>
                
                <div style="font-size:0.7rem; color:#888; margin-top:5px;">
                    * 灵植自动生长，收获获得灵石<br>
                    * 灵植经验自动转化为法则真意<br>
                    * 傀儡托管自动收获和种植
                </div>
            </div>
        </div>

        <!-- Ancient Treasure Tab (大千宝录) -->
        <div id="tab-ancient-treasure" class="tab-content">
            <div class="system-section">
                <div class="res-display" style="border:none; color:#3b82f6;">📜 大千宝录</div>

                <!-- 收集进度 -->
                <div class="sub-stat">
                    <span>收集进度:</span>
                    <span id="ancient-treasure-progress" class="val highlight">0/0 (0%)</span>
                </div>

                <!-- 寻宝令 -->
                <div class="sub-stat">
                    <span>寻宝令:</span>
                    <span id="ancient-treasure-tokens" class="val highlight" style="color:#fbbf24;">0</span>
                </div>

                <!-- 总倍率预览 -->
                <div style="margin:10px 0; padding:10px; background:rgba(59,130,246,0.1); border-radius:6px; font-size:0.85rem;">
                    <div style="color:#3b82f6; font-weight:bold;">总属性倍率: <span id="ancient-treasure-total-power">×1.00</span></div>
                </div>

                <!-- 里程碑信息 -->
                <div id="ancient-treasure-milestone" style="margin:10px 0; padding:10px; background:rgba(251,191,36,0.1); border:1px solid rgba(251,191,36,0.3); border-radius:6px; font-size:0.85rem;">
                    <div style="color: #fbbf24; font-weight: bold;">🏆 已完成界域: 0/6</div>
                    <div style="font-size: 0.75rem; color: #888;">里程碑加成: +0% (每完成一个界域+50%)</div>
                </div>

                <!-- 羁绊系统 -->
                <div style="margin:10px 0; padding:10px; background:rgba(139,92,246,0.1); border:1px solid rgba(139,92,246,0.3); border-radius:6px; font-size:0.85rem;">
                    <div style="color: #a78bfa; font-weight: bold; margin-bottom:8px;">⚔️ 古宝羁绊</div>
                    <div id="ancient-treasure-synergies" style="display:flex; flex-direction:column; gap:8px;">
                        <!-- 羁绊列表由JS动态生成 -->
                    </div>
                </div>

                <!-- 各界域收集进度 -->
                <div id="ancient-treasure-realms" style="margin:10px 0;"></div>

                <!-- 进入按钮 -->
                <button class="sys-btn" onclick="game.openAncientTreasureModal()" style="margin-top:10px; background:linear-gradient(to right, #1e40af, #3b82f6);">
                    📜 进入大千宝录
                </button>

                <div style="font-size:0.7rem; color:#888; margin-top:5px;">
                    * 收集各界古宝，获得巨大加成<br>
                    * 古宝品质越高，成长率越高<br>
                    * 使用寻宝令进行天命寻宝 (UR保底40抽)
                </div>
            </div>
        </div>

        <!-- ZhouTian Star Acupoint Tab (周天星窍) -->
        <div id="tab-zhou-tian" class="tab-content">
            <div class="system-section">
                <div class="res-display" style="border:none; color:#fbbf24;">⭐ 周天星窍</div>

                <!-- 周天等级和指数加成 -->
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:8px; margin-bottom:10px;">
                    <div style="background:#1a1a1a; padding:8px; border-radius:6px; text-align:center;">
                        <div style="font-size:0.7rem; color:#888;">当前周天</div>
                        <div id="zhou-tian-level" style="font-size:1.3rem; font-weight:bold; color:#fbbf24;">第1周天</div>
                    </div>
                    <div style="background:#1a1a1a; padding:8px; border-radius:6px; text-align:center;">
                        <div style="font-size:0.7rem; color:#888;">指数加成</div>
                        <div id="zhou-tian-exp-bonus" style="font-size:1.3rem; font-weight:bold; color:#a855f7;">+0.0%</div>
                    </div>
                </div>

                <!-- 圆满进度 -->
                <div style="background:#1a1a1a; padding:10px; border-radius:6px; margin-bottom:10px;">
                    <div style="display:flex; justify-content:space-between; font-size:0.8rem; margin-bottom:5px;">
                        <span style="color:#888;">星域圆满进度</span>
                        <span id="zhou-tian-complete-count" style="color:#22c55e; font-weight:bold;">0/5</span>
                    </div>
                    <div style="height:6px; background:#333; border-radius:3px; overflow:hidden;">
                        <div id="zhou-tian-progress" style="width:0%; height:100%; background:linear-gradient(90deg, #fbbf24, #f59e0b); transition:width 0.3s;"></div>
                    </div>
                </div>

                <!-- 属性加成预览 -->
                <div style="background:#1a1a1a; padding:10px; border-radius:6px; margin-bottom:10px; font-size:0.75rem;">
                    <div style="color:#888; margin-bottom:5px;">属性加成</div>
                    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:5px;">
                        <div>🐉 攻击: <span id="zhou-tian-atk" class="val" style="color:#22c55e;">×1</span></div>
                        <div>🦅 生命: <span id="zhou-tian-hp" class="val" style="color:#ef4444;">×1</span></div>
                        <div>🐅 装备: <span id="zhou-tian-equip" class="val" style="color:#f59e0b;">+0</span></div>
                        <div>🐢 精华: <span id="zhou-tian-essence" class="val" style="color:#3b82f6;">×1</span></div>
                        <div style="grid-column:span 2;">🦌 全属: <span id="zhou-tian-all" class="val" style="color:#a855f7;">×1</span></div>
                    </div>
                </div>

                <!-- 星髓数量 -->
                <div style="display:flex; justify-content:space-between; align-items:center; background:linear-gradient(135deg, #1a1a2e 0%, #0f0f1a 100%); padding:10px; border-radius:6px; border:1px solid #333; margin-bottom:10px;">
                    <span style="font-size:0.8rem; color:#888;">💎 星髓</span>
                    <span id="zhou-tian-marrow-count" style="font-size:1.1rem; font-weight:bold; color:#fbbf24;">1000</span>
                </div>

                <!-- 进入按钮 -->
                <button class="sys-btn" onclick="game.openZhouTianModal()" style="background:linear-gradient(to right, #d97706, #fbbf24); color:#000; font-weight:bold;">
                    ⭐ 进入星窍洗练
                </button>

                <div style="font-size:0.7rem; color:#888; margin-top:5px;">
                    * 洗练星窍获得属性加成<br>
                    * 25窍全满可进入下一周天<br>
                    * 每周天+0.1%指数加成
                </div>
            </div>
        </div>

        <!-- Abyss Relic Tab (深渊遗宝) -->
        <div id="tab-abyss" class="tab-content">
            <div class="system-section">
                <div class="res-display" style="border:none; color:#8b5cf6;">🌑 深渊遗宝</div>
                
                <!-- 收集进度 -->
                <div class="sub-stat">
                    <span>收集进度:</span>
                    <span id="abyss-overview-progress" class="val highlight">0/0 (0%)</span>
                </div>
                
                <!-- 遗宝碎片 -->
                <div class="sub-stat">
                    <span>遗宝碎片:</span>
                    <span id="abyss-overview-fragments" class="val highlight" style="color:#fbbf24;">0</span>
                </div>
                
                <!-- 属性加成预览 -->
                <div id="abyss-bonus-preview" style="margin:10px 0; padding:10px; background:rgba(139,92,246,0.1); border-radius:6px; font-size:0.85rem;">
                    <div style="color:#888;">暂无属性加成</div>
                </div>
                
                <!-- 进入深渊战场按钮 -->
                <button class="sys-btn" onclick="game.openAbyssModal()" style="margin-top:10px; background:linear-gradient(to right, #7c3aed, #8b5cf6);">
                    ⚔️ 深渊战场
                </button>
                
                <!-- 遗宝图鉴按钮 -->
                <button class="sys-btn" onclick="game.openAbyssCodex()" style="margin-top:10px; background:linear-gradient(to right, #0891b2, #06b6d4);">
                    📚 遗宝图鉴
                </button>
                
                <div style="font-size:0.7rem; color:#888; margin-top:5px;">
                    * 挑战深渊BOSS获取遗宝<br>
                    * 遗宝可升级，满级自动分解<br>
                    * 碎片可兑换任意遗宝
                </div>
            </div>
        </div>
    </div>
</div>

<div id="tooltip"></div>

<!-- Item Modal -->
<div id="item-modal" class="game-modal" style="z-index: 2000;">
    <div class="modal-content">
        <h3 id="modal-title" style="margin-top:0;">Item Name</h3>
        <p id="modal-desc" style="color:#aaa; font-size:0.9rem;">Stats</p>
        <div id="modal-actions">
            <!-- Buttons injected by JS -->
        </div>
        <button class="modal-btn btn-close" onclick="game.closeModal('item-modal')">关闭</button>
    </div>
</div>

<!-- Treasure Full Screen Modal -->
<div id="treasure-full-modal" class="game-modal">
    <div class="modal-content">
        <div style="display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid #444; padding-bottom:10px;">
            <h2 style="margin:0; color:#7b1fa2;">秘宝阁</h2>
            <button class="modal-btn btn-close" style="width:auto; margin:0;" onclick="game.closeModal('treasure-full-modal')">✕</button>
        </div>
        
        <div class="treasure-layout">
            <!-- Left: Equipped -->
            <div class="treasure-left-panel">
                <div style="font-weight:bold; margin-bottom:10px; color:#aaa;">已装备秘宝 (右键卸下)</div>
                <div class="equip-grid" id="treasure-equip-grid" style="grid-template-columns: repeat(2, 1fr); gap: 8px;">
                    <!-- Slots -->
                </div>
                
                <div style="margin-top:auto; font-size:0.8rem; color:#888;">
                    <div class="sub-stat">待开宝箱: <span id="modal-chest-count" class="highlight">0</span></div>
                    <div class="sub-stat">剩余次数: <span id="modal-daily-count">20</span></div>
                    <div class="sub-stat">秘宝碎片: <span id="modal-frag-count">0</span></div>
                </div>
            </div>

            <!-- Right: Bag & Controls -->
            <div class="treasure-right-panel">
                <div style="display:flex; gap:10px; margin-bottom:10px;">
                    <button class="sys-btn btn-treasure" style="flex:1; margin:0;" onclick="game.openTreasureBox(1)">🎁 开启宝箱 (消耗1次)</button>
                    <button class="sys-btn btn-treasure" style="flex:1; margin:0;" onclick="game.exchangeTreasure()">♻️ 碎片兑换</button>
                </div>

                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;">
                    <span style="font-weight:bold; color:#aaa;">秘宝背包 (右键穿戴/替换)</span>
                    <button onclick="game.autoDecompose()" style="font-size:0.8rem; padding:4px 8px; background:#f44336; border:none; color:white; cursor:pointer;">一键分解</button>
                </div>
                
                <div class="treasure-bag-grid" id="treasure-bag">
                    <!-- Bag Items -->
                </div>

                <div style="margin-top:10px; border-top:1px solid #444; padding-top:10px; display:flex; gap:5px;">
                    <input type="text" id="redeem-code-modal" placeholder="输入兑换码" style="flex:1; padding:5px; background:#111; border:1px solid #444; color:#fff;">
                    <button onclick="game.redeemCode('modal')" style="padding:5px 15px;">兑换</button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Garden Full Screen Modal -->
<div id="garden-full-modal" class="game-modal" style="z-index: 1500;">
    <div class="modal-content" style="width: 95%; max-width: 1100px; height: 90%; display: flex; flex-direction: column;">
        <div style="display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid #444; padding-bottom:10px; margin-bottom:10px;">
            <h2 style="margin:0; color:#22c55e;">🌿 百草灵园</h2>
            <button class="modal-btn btn-close" style="width:auto; margin:0;" onclick="game.closeGardenModal()">✕</button>
        </div>
        
        <div style="display:flex; gap:15px; flex:1; overflow:hidden;">
            <!-- 左侧：炼体锻身 -->
            <div style="flex:1; display:flex; flex-direction:column; gap:10px; min-width:220px; max-width:280px;">
                <!-- 炼体图 -->
                <div style="background:#1a1a1a; padding:10px; border-radius:8px; flex:1; display:flex; flex-direction:column;">
                    <h3 style="margin:0 0 10px 0; color:#8b5cf6; font-size:1rem;">⚔️ 炼体锻身</h3>
                    
                    <!-- 炼体图容器 -->
                    <div id="meridian-map-container" style="flex:1; position:relative; background:radial-gradient(circle at center, #1a1a2e 0%, #0f0f1a 100%); border-radius:8px; min-height:320px; height:320px; overflow:hidden; display:flex; align-items:center; justify-content:center;">
                        <!-- 由JS生成经脉图 -->
                    </div>
                    
                    <!-- 淬炼信息 -->
                    <div style="margin-top:10px; padding:10px; background:#262626; border-radius:6px;">
                        <!-- 境界显示 -->
                        <div style="text-align:center; padding:8px; background:linear-gradient(135deg, #1a1a2e 0%, #0f0f1a 100%); border-radius:6px; margin-bottom:10px; border:1px solid #333;">
                            <div style="font-size:0.7rem; color:#888; margin-bottom:3px;">锻体境界</div>
                            <div id="garden-refine-realm" style="font-size:1.1rem; font-weight:bold; color:#888;">第1境·凡胎</div>
                            <div id="garden-refine-realm-desc" style="font-size:0.65rem; color:#666; margin-top:2px;">未曾修炼</div>
                        </div>
                        <div style="display:flex; justify-content:space-between; font-size:0.8rem; margin-bottom:5px;">
                            <span style="color:#888;">当前轮次:</span>
                            <span id="garden-refine-round" style="color:#fbbf24; font-weight:bold;">0轮</span>
                        </div>
                        <div style="display:flex; justify-content:space-between; font-size:0.8rem; margin-bottom:5px;">
                            <span style="color:#888;">当前进度:</span>
                            <span id="garden-refine-step" style="color:#22c55e;">0/10</span>
                        </div>
                        <div style="display:flex; justify-content:space-between; font-size:0.8rem; margin-bottom:5px;">
                            <span style="color:#888;">肉身强度:</span>
                            <span id="garden-meridian-bonus" style="color:#ef4444; font-weight:bold;">×1 / +0%</span>
                        </div>
                        
                        <!-- 下一级预览 -->
                        <div style="background:linear-gradient(135deg, #1a2f1a 0%, #0f1f0f 100%); border:1px solid #22c55e40; border-radius:6px; padding:8px; margin:8px 0;">
                            <div style="font-size:0.7rem; color:#22c55e; margin-bottom:4px;">🎯 下一级突破</div>
                            <div style="display:flex; justify-content:space-between; font-size:0.75rem; margin-bottom:3px;">
                                <span style="color:#888;">当前:</span>
                                <span id="garden-preview-current" style="color:#aaa;">×1</span>
                            </div>
                            <div style="display:flex; justify-content:space-between; font-size:0.75rem; margin-bottom:3px;">
                                <span style="color:#888;">突破后:</span>
                                <span id="garden-preview-next" style="color:#fbbf24; font-weight:bold;">×1.1</span>
                            </div>
                            <div style="display:flex; justify-content:space-between; font-size:0.75rem;">
                                <span style="color:#888;">收益:</span>
                                <span id="garden-preview-gain" style="color:#4ade80;">×1.1 全属性</span>
                            </div>
                        </div>
                        <div style="border-top:1px solid #444; padding-top:8px; margin-top:8px;">
                            <div style="display:flex; justify-content:space-between; font-size:0.8rem; margin-bottom:5px;">
                                <span style="color:#a78bfa;">💧 生灵精华:</span>
                                <span id="garden-life-essence" style="color:#a78bfa; font-weight:bold;">0</span>
                            </div>
                            <div style="display:flex; justify-content:space-between; font-size:0.75rem; color:#666;">
                                <span>下次消耗:</span>
                                <span id="garden-refine-cost">100</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 淬炼按钮 -->
                    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:8px; margin-top:10px;">
                        <button class="sys-btn" style="background:linear-gradient(to right, #dc2626, #ef4444); font-size:0.8rem; padding:8px;" onclick="game.garden.refinement.refineAndUpdate()">
                            🔥 锻体强身
                        </button>
                        <button class="sys-btn" style="background:linear-gradient(to right, #991b1b, #b91c1c); font-size:0.8rem; padding:8px;" onclick="game.garden.refinement.refineAll()">
                            ⚔️ 连续锻体
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- 中间：灵植园主界面 -->
            <div style="flex:2; display:flex; flex-direction:column; gap:10px; overflow:hidden;">
                <!-- 状态栏 -->
                <div style="background:#1a1a1a; padding:10px; border-radius:8px; display:flex; justify-content:space-between; align-items:center;">
                    <div>
                        <div style="font-size:1.1rem; font-weight:bold; color:#22c55e;">
                            Lv.<span id="garden-modal-level">1</span> 
                            (<span id="garden-modal-turn">凡阶</span>)
                        </div>
                        <div style="width:150px; height:6px; background:#333; border-radius:3px; margin-top:5px; overflow:hidden;">
                            <div id="garden-modal-exp-bar" style="width:0%; height:100%; background:linear-gradient(90deg, #22c55e, #16a34a);"></div>
                        </div>
                    </div>
                    <div style="text-align:right;">
                        <div style="font-size:1.2rem; color:#fbbf24; font-weight:bold;">
                            💎 <span id="garden-modal-stones">100</span>
                        </div>
                        <div style="font-size:0.75rem; color:#888;">
                            <span style="color:#22c55e;" id="garden-modal-income">+0/分</span> | 
                            <span style="color:#3b82f6;" id="garden-modal-exp-rate">+0/分</span> | 
                            <span style="color:#a78bfa;" id="garden-modal-essence-rate">+0/分</span>
                        </div>
                    </div>
                </div>
                
                <!-- 土地网格 -->
                <div style="flex:1; background:#1a1a1a; border-radius:8px; padding:10px; overflow-y:auto;">
                    <div id="modal-land-grid" class="garden-land-grid" style="grid-template-columns: repeat(4, 1fr);">
                        <!-- 由JS生成 -->
                    </div>
                </div>
                
                <!-- 操作按钮 -->
                <div style="display:grid; grid-template-columns: repeat(4, 1fr); gap:8px;">
                    <button class="sys-btn" style="background:linear-gradient(to right, #15803d, #22c55e); font-size:0.8rem; padding:8px;" onclick="game.gardenOneClickHarvest()">
                        <i class="fas fa-hand-holding-dollar"></i> 一键收获
                    </button>
                    <button class="sys-btn" style="background:linear-gradient(to right, #1d4ed8, #3b82f6); font-size:0.8rem; padding:8px;" onclick="game.gardenOneClickPlant()">
                        <i class="fas fa-seedling"></i> 一键种植
                    </button>
                    <button class="sys-btn" style="background:linear-gradient(to right, #991b1b, #dc2626); font-size:0.8rem; padding:8px;" onclick="game.gardenOneClickClear()">
                        <i class="fas fa-trash-alt"></i> 铲除未熟
                    </button>
                    <button id="modal-puppet-btn" class="sys-btn" style="background:linear-gradient(to right, #581c87, #9333ea); font-size:0.8rem; padding:8px; opacity:0.6;" onclick="game.togglePuppetMode()" disabled>
                        <i class="fas fa-robot"></i> 傀儡
                    </button>
                </div>
            </div>
            
            <!-- 右侧：灵植阁 -->
            <div style="flex:1; display:flex; flex-direction:column; gap:10px; min-width:200px;">
                <div style="background:#1a1a1a; padding:10px; border-radius:8px; flex:1; display:flex; flex-direction:column;">
                    <h3 style="margin:0 0 10px 0; color:#16a34a; font-size:1rem;">🏪 灵植阁</h3>
                    
                    <!-- 转数选择器 -->
                    <div style="padding-bottom:8px; margin-bottom:8px; border-bottom:1px solid #333;">
                        <label style="font-size:0.75rem; color:#9ca3af; margin-bottom:4px; display:block;">选择转数</label>
                        <select id="modal-turn-selector" onchange="game.garden.setShopTurn(parseInt(this.value)); game.updateGardenUI();" style="width:100%; padding:6px; background:#262626; border:1px solid #4b5563; border-radius:4px; color:#fff; font-size:0.85rem;">
                            <!-- 由JS生成 -->
                        </select>
                    </div>
                    
                    <!-- 工具栏 -->
                    <div id="modal-shovel-btn" class="tool-btn" style="padding:8px; background:#374151; border-radius:6px; display:flex; align-items:center; gap:8px; border:1px solid #4b5563; margin-bottom:8px;">
                        <span style="font-size:1.3rem;">⛏️</span>
                        <div style="pointer-events:none;">
                            <div style="font-size:0.85rem; color:#f87171; font-weight:bold;">玉灵铲</div>
                            <div style="font-size:0.7rem; color:#9ca3af;">点击植物单体移除</div>
                        </div>
                    </div>
                    
                    <!-- 种子列表 -->
                    <div id="modal-seed-list" style="flex:1; overflow-y:auto; background:#262626; border-radius:6px; padding:6px;">
                        <!-- 由JS生成 -->
                    </div>
                    
                    <!-- 丹火提炼 -->
                    <div id="modal-alchemy-toggle" style="display:none; margin-top:8px; padding:8px; background:#262626; border-radius:6px; align-items:center; justify-content:space-between;">
                        <div>
                            <span style="color:#f97316;">🔥 丹火提炼</span>
                            <span style="font-size:0.7rem; color:#888; margin-left:5px;">+20%收益</span>
                        </div>
                        <button id="modal-alchemy-btn" onclick="game.toggleAlchemyMode();" style="padding:4px 12px; background:#374151; border:none; border-radius:4px; color:#fff; font-size:0.75rem; cursor:pointer;">OFF</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Abyss Battle Modal (深渊战场) -->
<div id="abyss-modal" class="game-modal">
    <div class="modal-content" style="width: 90%; max-width: 600px; height: 90%; display: flex; flex-direction: column;">
        <div style="display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid #444; padding-bottom:10px; margin-bottom:10px;">
            <h2 style="margin:0; color:#8b5cf6;">🌑 深渊战场</h2>
            <button class="modal-btn btn-close" style="width:auto; margin:0;" onclick="game.closeAbyssModal()">✕</button>
        </div>
        
        <div style="flex:1; overflow-y:auto; padding-right:5px;">
            <div style="background:#1a1a1a; padding:15px; border-radius:8px; margin-bottom:15px;">
                <div style="color:#888; font-size:0.85rem; margin-bottom:10px;">
                    👇 点击下方按钮直接挑战BOSS
                </div>
                <div id="boss-select-list" style="display:flex; flex-direction:column; gap:10px;">
                    <!-- 由JS生成 -->
                </div>
            </div>
            
            <!-- 收集进度 -->
            <div style="background:#1a1a1a; padding:15px; border-radius:8px; margin-bottom:15px;">
                <div id="abyss-total-progress" style="color:#a78bfa; font-size:0.9rem;">
                    📚 遗宝收集：0/0 (0%)
                </div>
            </div>
            
            <!-- 图鉴按钮 -->
            <button class="sys-btn" onclick="game.openAbyssCodex()" style="background:linear-gradient(to right, #0891b2, #06b6d4); width:100%;">
                📚 查看遗宝图鉴
            </button>
        </div>
    </div>
</div>

<!-- Abyss Codex Modal (遗宝图鉴) -->
<div id="abyss-codex-modal" class="game-modal">
    <div class="modal-content" style="width: 95%; max-width: 1200px; height: 90%; display: flex; flex-direction: column;">
        <div style="display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid #444; padding-bottom:10px; margin-bottom:10px;">
            <h2 style="margin:0; color:#8b5cf6;">📚 遗宝图鉴</h2>
            <button class="modal-btn btn-close" style="width:auto; margin:0;" onclick="game.closeAbyssCodex()">✕</button>
        </div>
        
        <!-- 总体收集进度 -->
        <div id="collection-progress" style="margin-bottom:10px; padding:10px; background:#1a1a1a; border-radius:6px;">
            <!-- 由JS生成 -->
        </div>
        
        <!-- 5列遗宝图鉴（每列一个BOSS） -->
        <div id="relic-codex-container" style="flex:1; display:grid; grid-template-columns: repeat(5, 1fr); gap:10px; overflow-y:auto; background:#1a1a1a; border-radius:8px; padding:12px;">
            <!-- 由JS生成5列 -->
        </div>
    </div>
</div>

<!-- Stats Detail Modal -->
<div id="stats-detail-modal" class="game-modal">
    <div class="modal-content" style="max-width: 600px; max-height: 80vh; overflow-y: auto;">
        <h3 style="margin-top:0; color:#fbbf24;">📊 属性详情面板</h3>
        
        <!-- 最终属性 -->
        <div style="background: linear-gradient(135deg, #fbbf2420 0%, #f59f0b20 100%); border: 1px solid #fbbf24; border-radius: 10px; padding: 15px; margin-bottom: 15px;">
            <div style="color: #fbbf24; font-weight: bold; margin-bottom: 10px; font-size: 1.1rem;">⚔️ 最终战斗属性</div>
            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; text-align: center;">
                <div style="background: rgba(0,0,0,0.3); padding: 10px; border-radius: 8px;">
                    <div style="color: #888; font-size: 0.75rem;">生命值</div>
                    <div id="detail-final-hp" style="color: #4ade80; font-weight: bold; font-size: 0.9rem;">-</div>
                </div>
                <div style="background: rgba(0,0,0,0.3); padding: 10px; border-radius: 8px;">
                    <div style="color: #888; font-size: 0.75rem;">攻击力</div>
                    <div id="detail-final-atk" style="color: #f87171; font-weight: bold; font-size: 0.9rem;">-</div>
                </div>
                <div style="background: rgba(0,0,0,0.3); padding: 10px; border-radius: 8px;">
                    <div style="color: #888; font-size: 0.75rem;">暴击率</div>
                    <div id="detail-final-crit" style="color: #fbbf24; font-weight: bold; font-size: 0.9rem;">-</div>
                </div>
            </div>
        </div>
        
        <!-- 各系统加成详情 -->
        <div style="display: grid; gap: 12px;">
            
            <!-- 基础属性 -->
            <div style="background: rgba(255,255,255,0.05); border-radius: 8px; padding: 12px;">
                <div style="color: #888; font-size: 0.85rem; margin-bottom: 8px;">📊 基础属性</div>
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; font-size: 0.8rem;">
                    <div>生命: <span id="detail-base-hp" class="val">-</span></div>
                    <div>攻击: <span id="detail-base-atk" class="val">-</span></div>
                    <div>暴击: <span id="detail-base-crit" class="val">-</span></div>
                </div>
            </div>
            
            <!-- 境界加成 -->
            <div style="background: rgba(255,255,255,0.05); border-radius: 8px; padding: 12px;">
                <div style="color: #888; font-size: 0.85rem; margin-bottom: 8px;">✨ 境界加成 (跨度奖励)</div>
                <div style="font-size: 0.8rem;">
                    <div>当前境界: <span id="detail-realm-name" class="val" style="color:#c084fc">-</span></div>
                    <div>境界倍率: <span id="detail-realm-bonus" class="val" style="color:#fbbf24">-</span></div>
                    <div>突破次数: <span id="detail-realm-count" class="val">-</span></div>
                    <div style="color:#888; font-size:0.75rem; margin-top:4px;">
                        * 每次突破获得 x1.1^(跨度) 倍率
                    </div>
                </div>
            </div>
            
            <!-- 装备加成 -->
            <div style="background: rgba(255,255,255,0.05); border-radius: 8px; padding: 12px;">
                <div style="color: #888; font-size: 0.85rem; margin-bottom: 8px;">🛡️ 装备加成 (12件)</div>
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; font-size: 0.8rem;">
                    <div>装备攻击: <span id="detail-equip-atk" class="val">-</span></div>
                    <div>装备生命: <span id="detail-equip-hp" class="val">-</span></div>
                    <div>装备暴击: <span id="detail-equip-crit" class="val">-</span></div>
                </div>
            </div>
            
            <!-- 法则加成 -->
            <div style="background: rgba(255,255,255,0.05); border-radius: 8px; padding: 12px;">
                <div style="color: #888; font-size: 0.85rem; margin-bottom: 8px;">☯️ 法则悟道</div>
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; font-size: 0.8rem;">
                    <div>攻击倍率: <span id="detail-law-atk" class="val" style="color:#60a5fa">-</span></div>
                    <div>生命倍率: <span id="detail-law-hp" class="val" style="color:#60a5fa">-</span></div>
                    <div>当前轮次: <span id="detail-law-round" class="val">-</span></div>
                </div>
            </div>
            
            <!-- 秘宝加成 -->
            <div style="background: rgba(255,255,255,0.05); border-radius: 8px; padding: 12px;">
                <div style="color: #888; font-size: 0.85rem; margin-bottom: 8px;">🔮 秘宝加成 (6槽位)</div>
                <div style="font-size: 0.8rem;">
                    <div>全属性倍率: <span id="detail-treasure-mult" class="val" style="color:#fbbf24">-</span></div>
                    <div>丹药倍率: <span id="detail-treasure-pill" class="val" style="color:#fbbf24">-</span></div>
                    <div>爬塔掉率: <span id="detail-treasure-tower" class="val" style="color:#fbbf24">-</span></div>
                    <div id="detail-treasure-list" style="color: #666; font-size: 0.75rem; margin-top: 5px;">-</div>
                </div>
            </div>
            
            <!-- 遗宝加成 -->
            <div style="background: rgba(255,255,255,0.05); border-radius: 8px; padding: 12px;">
                <div style="color: #888; font-size: 0.85rem; margin-bottom: 8px;">🌑 深渊遗宝</div>
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; font-size: 0.8rem;">
                    <div>全属性倍率: <span id="detail-relic-stat" class="val" style="color:#ef4444">-</span></div>
                    <div>爬塔掉率: <span id="detail-relic-tower" class="val" style="color:#ef4444">-</span></div>
                    <div>刷丹倍率: <span id="detail-relic-pill" class="val" style="color:#ef4444">-</span></div>
                    <div>装备等级: <span id="detail-relic-equip" class="val" style="color:#f59f0b">-</span></div>
                    <div>秘宝等级: <span id="detail-relic-treasure" class="val" style="color:#f59f0b">-</span></div>
                </div>
            </div>
            
            <!-- 炼体加成 -->
            <div style="background: rgba(255,255,255,0.05); border-radius: 8px; padding: 12px;">
                <div style="color: #888; font-size: 0.85rem; margin-bottom: 8px;">⚔️ 炼体锻身 (百草灵园)</div>
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; font-size: 0.8rem;">
                    <div>锻体境界: <span id="detail-meridian-realm" class="val" style="color:#22c55e">-</span></div>
                    <div>锻体轮次: <span id="detail-meridian-round" class="val">-</span></div>
                    <div>肉身加成: <span id="detail-meridian-mult" class="val" style="color:#8b5cf6">-</span></div>
                </div>
            </div>
            
            <!-- 计算说明 -->
            <div style="background: rgba(0,0,0,0.3); border-radius: 8px; padding: 10px; font-size: 0.75rem; color: #666;">
                <div style="color: #888; margin-bottom: 5px;">📝 计算公式</div>
                <div>最终攻击 = (基础攻击 + 装备攻击) × 法则攻击倍率 × 秘宝全属性倍率 × 遗宝全属性倍率 × 境界加成 × 肉身乘算，然后指数+肉身蜕变%</div>
                <div>最终生命 = (基础生命 + 装备生命) × 法则生命倍率 × 秘宝全属性倍率 × 遗宝全属性倍率 × 境界加成 × 肉身乘算，然后指数+肉身蜕变%</div>
                <div style="color: #8b5cf6; margin-top: 5px;">💡 炼体加成：前9次锻体×1.1，最后1次打通经脉肉身蜕变+0.1%</div>
            </div>
        </div>
        
        <button class="modal-btn btn-close" onclick="game.closeModal('stats-detail-modal')" style="margin-top: 15px;">关闭</button>
    </div>
</div>

<!-- ZhouTian System Modal (周天星窍系统 - 星座图版) -->
<div id="zhou-tian-modal" class="game-modal" style="z-index: 1600;">
    <div class="modal-content" style="width: 95%; max-width: 1000px; height: 90%; display: flex; flex-direction: column; padding: 0; overflow: hidden;">
        <!-- 头部 -->
        <div style="display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid #333; padding:15px 20px; background:linear-gradient(135deg, #0f172a 0%, #1e293b 100%);">
            <div>
                <h2 style="margin:0; color:#fbbf24; font-size:1.3rem; letter-spacing:0.2em;">⭐ 周天星窍</h2>
                <div style="font-size:0.7rem; color:#64748b; margin-top:3px;">洗练星窍，突破周天</div>
            </div>
            <div style="display:flex; align-items:center; gap:15px;">
                <div style="display:flex; align-items:center; gap:8px; padding:6px 12px; background:rgba(251,191,36,0.1); border-radius:20px; border:1px solid rgba(251,191,36,0.3);">
                    <span style="font-size:0.75rem; color:#fbbf24;">💎 星髓:</span>
                    <span id="zhou-tian-modal-marrow" style="font-size:0.9rem; font-weight:bold; color:#fbbf24;">0</span>
                </div>
                <button class="modal-btn btn-close" style="width:auto; margin:0; padding:5px 12px;" onclick="game.closeZhouTianModal()">✕</button>
            </div>
        </div>

        <!-- 主体内容 -->
        <div style="display:flex; flex:1; overflow:hidden;">
            <!-- 左侧：星座图 -->
            <div style="flex:1; background:radial-gradient(circle at center, #0f172a 0%, #0a0a0a 100%); padding:15px; overflow-y:auto; position:relative;">
                <!-- 星座图容器 -->
                <div id="zhou-tian-constellation" style="position:relative; width:100%; height:500px; min-height:500px;">
                    <!-- 连接线 SVG -->
                    <svg id="constellation-lines" style="position:absolute; inset:0; width:100%; height:100%; pointer-events:none; z-index:1;">
                        <!-- 由JS生成连接线 -->
                    </svg>
                    <!-- 星窍点位 -->
                    <div id="constellation-points" style="position:absolute; inset:0; z-index:2;">
                        <!-- 由JS生成25个星窍 -->
                    </div>
                    <!-- 星域标签 -->
                    <div id="constellation-labels" style="position:absolute; inset:0; z-index:3; pointer-events:none;">
                        <!-- 由JS生成5个星域标签 -->
                    </div>
                </div>

                <!-- 选中的星窍详情 -->
                <div id="acupoint-detail" style="background:#1a1a1a; border:1px solid #333; border-radius:8px; padding:12px; margin-top:10px; display:none;">
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;">
                        <span id="detail-sector-name" style="font-weight:bold; color:#fbbf24;">--</span>
                        <span id="detail-quality" style="font-size:0.8rem; padding:2px 8px; border-radius:4px;">--</span>
                    </div>
                    <div style="font-size:0.75rem; color:#888; margin-bottom:5px;">当前加成</div>
                    <div id="detail-bonus" style="font-size:1.1rem; font-weight:bold; color:#22c55e; margin-bottom:8px;">--</div>
                    <div style="font-size:0.7rem; color:#64748b;">
                        下一级: <span id="detail-next-bonus" style="color:#fbbf24;">--</span>
                    </div>
                </div>
            </div>

            <!-- 右侧：控制台 -->
            <div style="width:280px; background:#0f0f0f; border-left:1px solid #222; display:flex; flex-direction:column; padding:15px;">
                <!-- 周天信息 -->
                <div style="background:#1a1a1a; padding:12px; border-radius:8px; margin-bottom:12px;">
                    <div style="display:flex; justify-content:space-between; margin-bottom:8px;">
                        <span style="font-size:0.75rem; color:#888;">当前周天</span>
                        <span id="zhou-tian-modal-level" style="font-size:0.9rem; font-weight:bold; color:#fbbf24;">第1周天</span>
                    </div>
                    <div style="display:flex; justify-content:space-between; margin-bottom:8px;">
                        <span style="font-size:0.75rem; color:#888;">指数加成</span>
                        <span id="zhou-tian-modal-exp" style="font-size:0.9rem; font-weight:bold; color:#a855f7;">+0.0%</span>
                    </div>
                    <div style="display:flex; justify-content:space-between;">
                        <span style="font-size:0.75rem; color:#888;">已锁定</span>
                        <span id="zhou-tian-modal-locks" style="font-size:0.9rem; font-weight:bold; color:#22c55e;">0/4</span>
                    </div>
                </div>

                <!-- 各星域加成 -->
                <div style="background:#1a1a1a; padding:12px; border-radius:8px; margin-bottom:12px; font-size:0.75rem;">
                    <div style="color:#888; margin-bottom:8px; font-size:0.7rem; text-transform:uppercase; letter-spacing:0.1em;">各星域加成</div>

                    <!-- 青龙 -->
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:6px; padding:6px; background:#0f1f0f; border-radius:4px;">
                        <span style="color:#22c55e;">🐉 青龙 <span id="modal-locks-0" style="font-size:0.65rem; opacity:0.8;">🔒0/4</span></span>
                        <span id="modal-bonus-attack" style="color:#22c55e; font-weight:bold;">×1</span>
                    </div>
                    <!-- 朱雀 -->
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:6px; padding:6px; background:#1f0f0f; border-radius:4px;">
                        <span style="color:#ef4444;">🦅 朱雀 <span id="modal-locks-1" style="font-size:0.65rem; opacity:0.8;">🔒0/4</span></span>
                        <span id="modal-bonus-health" style="color:#ef4444; font-weight:bold;">×1</span>
                    </div>
                    <!-- 白虎 -->
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:6px; padding:6px; background:#1f1a0f; border-radius:4px;">
                        <span style="color:#f59e0b;">🐅 白虎 <span id="modal-locks-2" style="font-size:0.65rem; opacity:0.8;">🔒0/4</span></span>
                        <span id="modal-bonus-equip" style="color:#f59e0b; font-weight:bold;">+0</span>
                    </div>
                    <!-- 玄武 -->
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:6px; padding:6px; background:#0f1a2f; border-radius:4px;">
                        <span style="color:#3b82f6;">🐢 玄武 <span id="modal-locks-3" style="font-size:0.65rem; opacity:0.8;">🔒0/4</span></span>
                        <span id="modal-bonus-essence" style="color:#3b82f6; font-weight:bold;">×1</span>
                    </div>
                    <!-- 麒麟 -->
                    <div style="display:flex; justify-content:space-between; align-items:center; padding:6px; background:#1a0f2f; border-radius:4px;">
                        <span style="color:#a855f7;">🦌 麒麟 <span id="modal-locks-4" style="font-size:0.65rem; opacity:0.8;">🔒0/4</span></span>
                        <span id="modal-bonus-all" style="color:#a855f7; font-weight:bold;">×1</span>
                    </div>
                </div>

                <!-- 突破按钮（可突破时显示） -->
                <div id="breakthrough-panel" style="background:linear-gradient(135deg, #1a0f2f, #2d1f3f); padding:12px; border-radius:8px; margin-bottom:12px; display:none; border:1px solid #a855f7;">
                    <div style="text-align:center; margin-bottom:8px;">
                        <span style="font-size:0.9rem; font-weight:bold; color:#fbbf24;">✨ 周天圆满</span>
                    </div>
                    <div style="font-size:0.7rem; color:#888; text-align:center; margin-bottom:8px;">
                        所有星窍已达天品<br>
                        可突破进入下一周天
                    </div>
                    <button onclick="game.zhouTianTriggerBreakthrough()" style="width:100%; padding:10px; background:linear-gradient(135deg, #a855f7, #7c3aed); border:none; border-radius:6px; color:white; font-size:0.8rem; font-weight:bold; cursor:pointer;">
                        🚀 突破周天
                    </button>
                </div>

                <!-- 当前选中星域洗练 -->
                <div id="sector-wash-panel" style="background:#1a1a1a; padding:12px; border-radius:8px; margin-bottom:12px; display:none;">
                    <div id="wash-sector-name" style="font-weight:bold; color:#fbbf24; margin-bottom:8px;">--</div>
                    <div id="wash-cost-display" style="font-size:0.7rem; color:#888; margin-bottom:8px;">消耗: 50 星髓</div>
                    <div id="wash-buttons" style="display:flex; gap:5px;">
                        <button id="btn-start-wash" style="flex:1; padding:8px; background:#1e3a8a; border:none; border-radius:6px; color:#60a5fa; font-size:0.75rem; cursor:pointer;">
                            洗练
                        </button>
                    </div>
                </div>

                <!-- 快捷操作 -->
                <div style="background:#1a1a1a; padding:12px; border-radius:8px; margin-bottom:12px;">
                    <div style="color:#888; margin-bottom:8px; font-size:0.7rem; text-transform:uppercase; letter-spacing:0.1em;">快捷操作</div>
                    <button onclick="game.zhouTianAutoLock()" style="width:100%; padding:8px; background:#1e3a8a; border:none; border-radius:6px; color:#60a5fa; font-size:0.75rem; cursor:pointer; margin-bottom:6px;">
                        🔒 自动锁定天品
                    </button>
                    <button onclick="game.zhouTianAutoWash()" style="width:100%; padding:8px; background:#14532d; border:none; border-radius:6px; color:#4ade80; font-size:0.75rem; cursor:pointer;">
                        ⚡ 自动洗练至全满
                    </button>
                </div>

                <!-- 日志 -->
                <div style="flex:1; background:#0a0a0a; border-radius:8px; padding:10px; overflow-y:auto; font-size:0.7rem;">
                    <div style="color:#475569; margin-bottom:5px; font-size:0.65rem; text-transform:uppercase; letter-spacing:0.1em;">修行志</div>
                    <div id="zhou-tian-logs" style="display:flex; flex-direction:column; gap:4px;">
                        <!-- 由JS填充 -->
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- StarBeast Dungeon Modal (星空巨兽副本) -->
<div id="starbeast-modal" class="game-modal" style="z-index: 1600;">
    <div class="modal-content" style="width: 95%; max-width: 600px; height: 85%; display: flex; flex-direction: column; padding: 0; overflow: hidden;">
        <!-- 头部 -->
        <div style="display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid #333; padding:15px 20px; background:linear-gradient(135deg, #0f0f1a 0%, #1a1a2e 100%);">
            <div>
                <h2 style="margin:0; color:#a855f7; font-size:1.3rem; letter-spacing:0.2em;">🌟 星空巨兽</h2>
                <div style="font-size:0.7rem; color:#64748b; margin-top:3px;">挑战巨兽，获取星髓</div>
            </div>
            <div style="display:flex; align-items:center; gap:15px;">
                <div style="display:flex; align-items:center; gap:8px; padding:6px 12px; background:rgba(168,85,247,0.1); border-radius:20px; border:1px solid rgba(168,85,247,0.3);">
                    <span style="font-size:0.75rem; color:#a855f7;">💎 星髓:</span>
                    <span id="starbeast-total-marrow" style="font-size:0.9rem; font-weight:bold; color:#fbbf24;">0</span>
                </div>
                <button class="modal-btn btn-close" style="width:auto; margin:0; padding:5px 12px;" onclick="game.closeStarBeastModal()">✕</button>
            </div>
        </div>

        <!-- 主体内容 -->
        <div style="flex:1; background:#0a0a0f; padding:20px; overflow-y:auto;">
            <!-- 今日挑战次数 -->
            <div style="background:#1a1a2e; border:1px solid #2a2a3e; border-radius:8px; padding:12px; margin-bottom:20px; text-align:center;">
                <span style="font-size:0.75rem; color:#888;">今日剩余挑战:</span>
                <span id="starbeast-attempts" style="font-size:1rem; font-weight:bold; color:#a855f7; margin-left:8px;">10/10</span>
            </div>

            <!-- 难度列表 -->
            <div style="margin-bottom:15px;">
                <div style="font-size:0.8rem; color:#888; margin-bottom:12px; text-transform:uppercase; letter-spacing:0.1em;">选择难度</div>
                <div id="starbeast-difficulty-list" style="display:flex; flex-direction:column; gap:8px;">
                    <!-- 由JS生成 -->
                </div>
            </div>

            <!-- 说明 -->
            <div style="background:#0f0f1a; border-radius:8px; padding:12px; font-size:0.7rem; color:#64748b;">
                <div style="margin-bottom:6px;">📜 战斗规则:</div>
                <div style="margin-left:12px; line-height:1.6;">
                    • 数值压缩战斗：玩家攻击/生命按对数压缩<br>
                    • 每日可挑战10次，次数每日0点重置<br>
                    • 难度越高，星髓奖励越丰厚
                </div>
            </div>
        </div>
    </div>
</div>

<!-- StarBeast Reward Modal (星空巨兽奖励) -->
<div id="starbeast-reward-modal" class="game-modal" style="z-index: 1700;">
    <div class="modal-content" style="width: 300px; padding: 30px; text-align: center; background: linear-gradient(135deg, #1a1a2e 0%, #0f0f1a 100%); border: 1px solid #a855f7;">
        <div style="font-size: 3rem; margin-bottom: 15px;">🎉</div>
        <h3 style="color: #fbbf24; margin: 0 0 15px 0;">挑战成功!</h3>
        <div style="color: #888; font-size: 0.85rem; margin-bottom: 20px;">
            击败星空巨兽，获得星髓
        </div>
        <div style="font-size: 1.5rem; font-weight: bold; color: #a855f7; margin-bottom: 20px;">
            +<span id="starbeast-reward-amount">0</span> 💎
        </div>
        <button onclick="game.closeStarBeastRewardModal()" style="padding: 10px 30px; background: linear-gradient(135deg, #a855f7, #7c3aed); border: none; border-radius: 6px; color: white; font-size: 0.9rem; cursor: pointer;">
            确定
        </button>
    </div>
</div>

<!-- Ancient Treasure Modal (大千宝录古宝系统) -->
<div id="treasure-ancient-modal" class="game-modal" style="z-index: 1600;">
    <div class="modal-content" style="width: 95%; max-width: 1100px; height: 90%; display: flex; flex-direction: column; padding: 0; overflow: hidden;">
        <!-- 头部 -->
        <div style="display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid #333; padding:15px 20px; background:linear-gradient(135deg, #0f172a 0%, #1e293b 100%);">
            <div>
                <h2 style="margin:0; color:#3b82f6; font-size:1.3rem; letter-spacing:0.2em;">📜 大千宝录</h2>
                <div style="font-size:0.7rem; color:#64748b; margin-top:3px;">收集古宝，提升战力</div>
            </div>
            <div style="display:flex; align-items:center; gap:15px;">
                <!-- 导航令 -->
                <div style="display:flex; align-items:center; gap:8px; padding:6px 12px; background:rgba(59,130,246,0.1); border-radius:20px; border:1px solid rgba(59,130,246,0.3);">
                    <span style="font-size:0.75rem; color:#60a5fa;">🟡 寻宝令:</span>
                    <span id="treasure-draw-tokens" style="font-size:0.9rem; font-weight:bold; color:#fbbf24;">0</span>
                </div>
                <button class="modal-btn btn-close" style="width:auto; margin:0; padding:5px 12px;" onclick="game.closeAncientTreasureModal()">✕</button>
            </div>
        </div>
        
        <!-- 主体内容 -->
        <div style="display:flex; flex:1; overflow:hidden;">
            <!-- 左侧：界域标签 -->
            <div style="width:70px; background:#0a0a0a; border-right:1px solid #222; display:flex; flex-direction:column; padding:10px 0;">
                <div style="text-align:center; padding:10px 0; border-bottom:1px solid #222; margin-bottom:10px;">
                    <div style="font-size:0.6rem; color:#475569; letter-spacing:0.1em;">界域</div>
                </div>
                <div id="treasure-tabs" style="flex:1; display:flex; flex-direction:column; gap:5px; padding:0 8px;">
                    <!-- 标签由JS生成 -->
                </div>
                <!-- 一键升级按钮 -->
                <div style="padding:10px 8px; border-top:1px solid #222;">
                    <button onclick="game.ancientTreasure.upgradeAll()" style="width:100%; padding:8px 0; background:linear-gradient(135deg, #ea580c, #f97316); border:none; border-radius:6px; color:white; font-size:0.65rem; cursor:pointer;" title="一键升级所有可升级的古宝">
                        <div style="font-weight:bold;">⚡ ALL</div>
                    </button>
                </div>
            </div>
            
            <!-- 中间：古宝列表 -->
            <div style="flex:1; background:#0f0f0f; display:flex; flex-direction:column; overflow:hidden;">
                <!-- 顶部战力显示 -->
                <div style="padding:12px 15px; background:linear-gradient(180deg, #0f172a 0%, #0a0a0a 100%); border-bottom:1px solid #1e293b;">
                    <div style="display:flex; justify-content:space-between; align-items:center;">
                        <div>
                            <div style="font-size:0.65rem; color:#475569; text-transform:uppercase; letter-spacing:0.15em; margin-bottom:2px;">Total Multiplier</div>
                            <div id="treasure-total-power" style="font-size:1.4rem; font-weight:900; background:linear-gradient(90deg, #fbbf24, #f59e0b, #ef4444); -webkit-background-clip:text; -webkit-text-fill-color:transparent; font-family:monospace;">
                                ×1.00
                            </div>
                        </div>
                        <div style="text-align:right;">
                            <div style="font-size:0.65rem; color:#475569; text-transform:uppercase; letter-spacing:0.1em;">已收集</div>
                            <div style="font-size:0.9rem; color:#60a5fa; font-weight:bold;">
                                <span id="treasure-collected-count">0</span> / <span id="treasure-total-count">0</span>
                            </div>
                            <div style="font-size:0.6rem; color:#334155; margin-top:2px;">
                                当前界域: ×<span id="treasure-tab-power">1.00</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 古宝列表区域 -->
                <div id="treasure-list-container" style="flex:1; overflow-y:auto; padding:15px;">
                    <!-- 按品质分类渲染 -->
                    <div id="treasure-list-content">
                        <!-- 由JS生成 -->
                    </div>
                </div>
            </div>
            
            <!-- 右侧：详情/抽奖 -->
            <div style="width:280px; background:#0a0a0a; border-left:1px solid #222; display:flex; flex-direction:column;">
                <!-- 抽奖面板（默认显示） -->
                <div id="treasure-draw-panel" style="flex:1; display:flex; flex-direction:column; padding:20px;">
                    <div style="flex:1; display:flex; flex-direction:column; align-items:center; justify-content:center; text-align:center; background:linear-gradient(180deg, rgba(59,130,246,0.1) 0%, transparent 100%); border-radius:12px; border:1px solid rgba(59,130,246,0.2); padding:20px;">
                        <div style="font-size:3rem; margin-bottom:15px; animation:float 3s ease-in-out infinite;">📦</div>
                        <h3 style="margin:0 0 8px 0; color:#fff; font-size:1.1rem; letter-spacing:0.3em; font-style:italic;">天命寻宝</h3>
                        <p style="font-size:0.7rem; color:#64748b; margin:0 0 15px 0;">
                            概率：UR 2% | SSR 8% | SR 30%
                        </p>
                        <div style="padding:4px 12px; background:rgba(59,130,246,0.1); border:1px solid rgba(59,130,246,0.2); border-radius:20px; font-size:0.65rem; color:#60a5fa;">
                            UR保底: <span id="treasure-pity-count">0</span>/40
                        </div>
                    </div>
                    
                    <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-top:15px;">
                        <button onclick="game.ancientTreasure.draw(1)" style="padding:12px; background:#1e293b; border:1px solid #334155; border-radius:8px; color:#94a3b8; font-size:0.75rem; font-weight:bold; cursor:pointer; transition:all 0.2s;" onmouseover="this.style.background='#334155'" onmouseout="this.style.background='#1e293b'">
                            一次
                        </button>
                        <button onclick="game.ancientTreasure.draw(10)" style="padding:12px; background:linear-gradient(135deg, #2563eb, #3b82f6); border:1px solid #60a5fa; border-radius:8px; color:#fff; font-size:0.75rem; font-weight:bold; cursor:pointer; box-shadow:0 4px 15px rgba(59,130,246,0.3); transition:all 0.2s;" onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
                            十次
                        </button>
                    </div>
                </div>
                
                <!-- 详情面板（选中古宝时显示） -->
                <div id="treasure-detail-panel" style="flex:1; display:none; flex-direction:column;">
                    <div style="display:flex; justify-content:space-between; align-items:center; padding:12px 15px; border-bottom:1px solid #222;">
                        <button onclick="game.ancientTreasure.selectedId = null; game.updateTreasureUI();" style="background:none; border:none; color:#64748b; cursor:pointer; font-size:1rem;">✕</button>
                        <span style="font-size:0.65rem; color:#475569; text-transform:uppercase; letter-spacing:0.2em;">Detail View</span>
                        <div style="width:20px;"></div>
                    </div>
                    
                    <div style="flex:1; overflow-y:auto; padding:15px;">
                        <div style="text-align:center; margin-bottom:15px;">
                            <div id="treasure-detail-icon-container" style="width:70px; height:70px; margin:0 auto 10px; border-radius:12px; display:flex; align-items:center; justify-content:center; font-size:2rem;">
                                <!-- 由JS填充 -->
                            </div>
                            <h3 id="treasure-detail-name" style="margin:0 0 5px 0; color:#fff; font-size:1rem;">古宝名称</h3>
                            <div style="font-size:0.7rem; color:#64748b;">成长: <span id="treasure-detail-growth">0</span>%/Lv</div>
                        </div>
                        
                        <div style="background:#111; border:1px solid #222; border-radius:8px; padding:12px; margin-bottom:10px;">
                            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;">
                                <span style="font-size:0.65rem; color:#3b82f6; text-transform:uppercase; letter-spacing:0.1em;">单体倍率</span>
                                <span id="treasure-detail-attr" style="font-size:0.65rem; color:#475569;">属性</span>
                            </div>
                            <div id="treasure-detail-power" style="font-size:1.3rem; font-weight:900; background:linear-gradient(90deg, #60a5fa, #22d3ee); -webkit-background-clip:text; -webkit-text-fill-color:transparent; font-family:monospace;">
                                ×1.00
                            </div>
                            <div style="display:flex; justify-content:space-between; font-size:0.65rem; margin-top:5px;">
                                <span style="color:#475569;">下级预览:</span>
                                <span id="treasure-detail-next-power" style="color:#4ade80;">×1.00</span>
                            </div>
                        </div>

                        <!-- 觉醒效果 -->
                        <div id="treasure-detail-awakening" style="background:linear-gradient(135deg, rgba(251,191,36,0.1), rgba(245,158,11,0.05)); border:1px solid rgba(251,191,36,0.3); border-radius:8px; padding:12px; margin-bottom:10px; display:none;">
                            <!-- 由JS填充觉醒效果 -->
                        </div>

                        <div style="background:#111; border:1px solid #222; border-radius:8px; padding:12px;">
                            <div style="font-size:0.65rem; color:#3b82f6; text-transform:uppercase; letter-spacing:0.1em; margin-bottom:5px;">古宝传记</div>
                            <p id="treasure-detail-desc" style="font-size:0.75rem; color:#64748b; line-height:1.5; margin:0; font-style:italic;">
                                古宝描述...
                            </p>
                        </div>
                    </div>
                    
                    <div style="padding:15px; border-top:1px solid #222; background:#0f0f0f;">
                        <div style="margin-bottom:10px;">
                            <div style="display:flex; justify-content:space-between; font-size:0.7rem; margin-bottom:5px;">
                                <span style="color:#64748b; text-transform:uppercase; letter-spacing:0.1em;">注入进度</span>
                                <span style="color:#60a5fa; font-family:monospace;"><span id="treasure-detail-level">0</span>/10</span>
                            </div>
                            <div style="height:4px; background:#1e293b; border-radius:2px; overflow:hidden;">
                                <div id="treasure-detail-level-bar" style="height:100%; background:linear-gradient(90deg, #2563eb, #22d3ee); transition:width 0.3s; width:0%;"></div>
                            </div>
                        </div>
                        
                        <button id="treasure-upgrade-btn" onclick="game.upgradeSelectedTreasure()" style="width:100%; padding:10px; background:linear-gradient(135deg, #ea580c, #f97316); border:none; border-radius:8px; color:#fff; font-size:0.8rem; font-weight:bold; cursor:pointer; display:flex; align-items:center; justify-content:center; gap:8px;">
                            <span>注入</span>
                            <span style="font-size:0.65rem; opacity:0.8;">碎片 x<span id="treasure-detail-cost">1</span> (余:<span id="treasure-detail-shards">0</span>)</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 寻宝结果弹窗 -->
<div id="treasure-draw-result-modal" class="game-modal" style="z-index: 1700;" onclick="game.closeTreasureDrawResult()">
    <div style="text-align:center; pointer-events:none;" onclick="event.stopPropagation()">
        <h2 style="font-size:1.5rem; font-weight:900; font-style:italic; color:rgba(255,255,255,0.3); margin-bottom:30px; letter-spacing:0.5em; text-transform:uppercase;">寻得宝物</h2>
        <div id="treasure-draw-result" style="display:flex; flex-wrap:wrap; justify-content:center; gap:15px; max-width:600px; margin:0 auto;">
            <!-- 由JS填充 -->
        </div>
        <div style="margin-top:30px; font-size:0.75rem; color:#475569; text-transform:uppercase; letter-spacing:0.3em; animation:pulse 2s infinite;">点击任意位置关闭</div>
    </div>
</div>

<!-- Cheat Modal -->
<div id="cheat-modal" class="game-modal">
    <div class="modal-content">
        <h3 style="margin-top:0; color:#ff1744;">🔥 金手指修改器</h3>
        <select id="cheat-type" class="cheat-select">
            <option value="atk">增加基础攻击力</option>
            <option value="hp">增加基础生命值</option>
            <option value="curHp">恢复当前生命值</option>
            <option value="law">增加法则真意</option>
            <option value="chest">增加秘宝宝箱</option>
            <option value="frag">增加秘宝碎片</option>
            <option value="ticket">增加秘宝次数</option>
            <option value="realm">增加境界等级</option>
            <option value="diff">增加历史最高难度</option>
            <option value="gardenExp">灵植经验倍率</option>
            <option value="gardenStone">灵植灵石倍率</option>
            <option value="gardenEssence">生灵精华倍率</option>
            <option value="abyssFrag">深渊遗宝碎片</option>
            <option value="treasureToken">古宝寻宝令</option>
            <option value="zhouTianMarrow">周天星髓</option>
            <option value="currentDiff">当前主线难度</option>
        </select>
        <input type="text" id="cheat-val" class="cheat-input" placeholder="输入数值 (支持 1e100)">
        <div style="font-size:0.8rem; color:#888;">支持极大数值，输入过大将变为∞</div>
        <button class="modal-btn btn-use" onclick="game.applyCheat()">确认修改</button>
        <button class="modal-btn btn-close" onclick="game.closeModal('cheat-modal')">关闭</button>
    </div>
</div>

<!-- Core Scripts -->
<script src="js/core/BigNum.js"></script>
<script src="js/config.js"></script>
<script src="js/utils.js"></script>
<script src="js/classes/Item.js"></script>
<script src="js/classes/Treasure.js"></script>
<script src="js/classes/Dungeon.js"></script>
<script src="js/classes/LifeEssenceRefinement.js"></script>
<script src="js/classes/SpiritGarden.js"></script>
<script src="js/classes/AncientTreasure.js"></script>
<script src="js/classes/ZhouTianSystem.js"></script>
<script src="js/classes/StarBeastDungeon.js"></script>
<script src="js/classes/AbyssRelic.js"></script>
<script src="js/classes/AbyssDungeon.js"></script>
<script src="js/game/Game.js"></script>

<!-- Initialize Game -->
<script>
const game = new Game();
</script>

</body>
</html>
