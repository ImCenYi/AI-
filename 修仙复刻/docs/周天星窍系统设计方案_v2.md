# 周天星窍系统设计方案 v2 - 快速迭代版

## 一、核心改动总结

| 维度 | 原版设计 | 新版设计 | 目的 |
|------|----------|----------|------|
| 品质概率 | 权重不均(凡50%→天1%) | 五品均分(各20%) | 快速获得高品质，迭代更爽 |
| 属性类型 | 全属性倍率 | 分区域差异化 | 策略选择，build多样性 |
| 周天奖励 | 基础倍率×2 | 指数+0.1% | 长期指数成长，后期爆炸 |
| 洗练节奏 | 高成本低频 | 低成本高频 | 快速反馈，心流体验 |

---

## 二、属性差异化设计

### 2.1 五大星域属性分配

| 星域 | 属性 | 说明 | 玩家类型 |
|------|------|------|----------|
| **东方青龙** | 攻击力 | 主输出属性 | 进攻型玩家优先 |
| **南方朱雀** | 生命值 | 生存属性 | 稳健型玩家优先 |
| **西方白虎** | 装备掉率 | 资源获取 | 发育型玩家优先 |
| **北方玄武** | 星髓获取 | 系统内循环加速 | 重度玩家优先 |
| **中央麒麟** | 全属性 | 均衡但数值较低 | 均衡型选择 |

### 2.2 属性生效机制

#### 攻击/生命属性
```
最终攻击 = (基础攻击 × 攻击倍率) 的指数加成
周天星窍攻击倍率 = 青龙星窍品质倍率和 × 周天等级系数

最终生命 = (基础生命 × 生命倍率) 的指数加成
周天星窍生命倍率 = 朱雀星窍品质倍率和 × 周天等级系数
```

#### 装备掉率属性
```
实际掉率 = 基础掉率 × (1 + 白虎星窍加成)
白虎加成 = 白虎星窍品质倍率和 × 0.5%
```

#### 星髓获取加成
```
星髓产出 = 基础产出 × (1 + 玄武星窍加成)
玄武加成 = 玄武星窍品质倍率和 × 0.5%
```

#### 全属性（中央麒麟）
```
麒麟倍率 = 麒麟星窍品质倍率和 × 0.3%（比单属性低，但影响所有属性）
```

---

## 三、品质系统重做

### 3.1 均分品质概率

| 等级 | 名称 | 颜色 | 基础倍率 | 概率 | 特点 |
|------|------|------|----------|------|------|
| 1 | 凡 | 灰 | ×1 | 20% | 保底，不亏 |
| 2 | 灵 | 绿 | ×2 | 20% | 小赚 |
| 3 | 玄 | 蓝 | ×4 | 20% | 中等收益 |
| 4 | 地 | 紫 | ×8 | 20% | 大赚 |
| 5 | 天 | 橙/金 | ×16 | 20% |  jackpot |

**设计意图**: 每次洗练都有20%概率获得最高品质，玩家平均5次就有1次天品，体验爽快。

### 3.2 各星域加成计算示例

假设某玩家**第3周天**（周天系数=1.5），各星域品质分布：

| 星域 | 星窍分布 | 品质倍率和 | 最终加成 |
|------|----------|------------|----------|
| 青龙(攻击) | 天×2 + 地×2 + 玄×1 | 2×16+2×8+4=52 | 攻击×78倍 |
| 朱雀(生命) | 天×1 + 地×3 + 灵×1 | 16+3×8+2=42 | 生命×63倍 |
| 白虎(掉率) | 地×2 + 玄×2 + 灵×1 | 2×8+2×4+2=26 | 掉率+13% |
| 玄武(星髓) | 天×1 + 玄×3 + 凡×1 | 16+3×4+1=29 | 星髓产出+14.5% |
| 麒麟(全属) | 地×1 + 玄×2 + 灵×2 | 8+2×4+2×2=20 | 全属性×9倍 |

> 周天等级系数：第n周天的系数为 `1 + (n-1) × 0.5`，即 1, 1.5, 2, 2.5, 3...

---

## 四、周天大圆满 - 指数加成机制

### 4.1 核心机制

每次25星窍全部达到**天品**，触发**周天大圆满**：

1. **指数加成**: 永久获得 `+0.1%` 指数加成
2. **周天等级+1**
3. **星窍重置**: 所有星窍降为凡品，重新开始洗练
4. **锁定解除**
5. **周天系数提升**: 下一周天的属性倍率系数增加

### 4.2 指数加成详解

```javascript
// 假设玩家基础属性经过各种乘算后：
// 尾数 m = 5.2, 指数 e = 150

// 第1周天大圆满后：
// 指数加成 = 0.1%
// 新指数 = 150 × (1 + 0.001) = 150.15
// 实际倍率 = 10^0.15 ≈ ×1.41

// 第5周天大圆满后：
// 指数加成 = 0.5%
// 新指数 = 150 × 1.005 = 150.75
// 实际倍率 = 10^0.75 ≈ ×5.62

// 第10周天大圆满后：
// 指数加成 = 1.0%
// 实际倍率 = 10^1.5 ≈ ×31.6
```

### 4.3 指数加成的威力

| 周天数 | 指数加成 | 等效倍率 | 说明 |
|--------|----------|----------|------|
| 1 | +0.1% | ×1.00023 | 几乎无感 |
| 5 | +0.5% | ×1.00115 | 微弱感觉 |
| 10 | +1.0% | ×1.0023 | 轻微提升 |
| 50 | +5.0% | ×1.0116 | 明显差距 |
| 100 | +10.0% | ×1.023 | 巨大优势 |
| 500 | +50.0% | ×1.12 | 后期爆炸 |

> **关键**: 指数加成是在所有乘算之后应用的，越后期收益越明显，形成长期追求目标。

---

## 五、快速迭代 - 节奏优化

### 5.1 降低洗练成本

| 锁定数 | 原版成本 | 新版成本 | 降低比例 |
|--------|----------|----------|----------|
| 0 | 100 | 50 | 50% |
| 1 | 300 | 100 | 66% |
| 2 | 500 | 150 | 70% |
| 3 | 700 | 200 | 71% |
| 4 | 900 | 250 | 72% |

### 5.2 提高星髓产出

| 来源 | 原版 | 新版 | 提升 |
|------|------|------|------|
| 矿脉首层 | 500 | 800 | 60% |
| 矿脉每层递增 | +100 | +150 | 50% |
| 每日恢复 | 1000 | 2000 | 100% |
| 境界奖励 | 5000×境界 | 8000×境界 | 60% |

### 5.3 批量洗练（可选优化）

为追求极致效率，可增加**一键洗练**功能：
```
功能：一键洗练目标星域直到满足某条件
条件选项：
- 洗出至少X个天品
- 总品质倍率达到Y
- 消耗不超过Z星髓
- 洗练N次
```

---

## 六、数值模拟 - 验证迭代速度

### 6.1 单星域洗满天品期望

**条件**: 5个星窍，各20%概率天品，可锁定

**策略**: 洗出1个天品→锁定→继续洗剩下4个→依此类推

| 步骤 | 目标 | 概率 | 期望次数 | 消耗星髓 |
|------|------|------|----------|----------|
| 第1天品 | 5选1 | 1-(0.8)^5=67% | 1.5次 | 75 |
| 第2天品 | 4选1 | 1-(0.8)^4=59% | 1.7次 | 170(锁1) |
| 第3天品 | 3选1 | 1-(0.8)^3=49% | 2.0次 | 300(锁2) |
| 第4天品 | 2选1 | 1-(0.8)^2=36% | 2.8次 | 560(锁3) |
| 第5天品 | 1选1 | 20% | 5.0次 | 1250(锁4) |
| **合计** | - | - | **13次** | **2355星髓** |

### 6.2 全周天大圆满期望

- 5个星域 × 2355 = **11775星髓**
- 每次矿脉平均获取约3000星髓（保守估计）
- 需要约4次矿脉探险
- 假设每次矿脉5分钟，总耗时约20分钟/周天

**结论**: 积极游玩的情况下，1-2天可完成一周天，节奏紧凑爽快。

---

## 七、界面优化 - 快速操作

### 7.1 新增快捷操作区

```
┌─────────────────────────────────────┐
│  ⚡ 快捷操作                         │
│  [一键补满] [放弃预览] [自动洗练▼]   │
└─────────────────────────────────────┘
```

**一键补满**: 对当前未满的星窍，自动进行单次洗练直到所有位置都有品质
**自动洗练**: 设置目标（如"洗出3个天品"），自动执行直到达成或资源耗尽

### 7.2 星域属性一目了然

```
┌─ 东方青龙 [攻击 ████████████ 120%] ─┐
│                                    │
└────────────────────────────────────┘
```

每个星域标题旁显示当前属性加成进度条。

---

## 八、与其他系统的协同

### 8.1 与炼体系统的区别

| 维度 | 炼体锻身 | 周天星窍 |
|------|----------|----------|
| 循环 | 10次一轮 | 25窍一周天 |
| 加成类型 | 乘算+指数 | 分属性倍率+指数 |
| 重置 | 每轮重置进度 | 满品后重置 |
| 玩家控制 | 低（固定流程） | 高（策略洗练） |

### 8.2 与深渊/秘宝的区别

- **深渊遗宝**: 收集型，随机掉落，有保底
- **大千宝录**: 收集型，抽卡获取
- **周天星窍**: 养成型，玩家主导进度，确定性高

### 8.3 属性计算链（更新版）

```
最终攻击 = ((基础攻击 + 装备攻击) ×
         (法则攻击倍率 × 秘宝攻击倍率 × 遗宝攻击倍率 ×
          境界倍率 × 古宝倍率 × 肉身乘算 × 星窍攻击倍率))
         的指数+(炼体指数%+周天指数%)

其中：
- 星窍攻击倍率 = 青龙倍率和 × (1 + (周天等级-1)×0.5)
- 周天指数% = 周天大圆满次数 × 0.1%
```

---

## 九、留存与心流设计

### 9.1 短期爽点（分钟级）

1. **每次洗练都有惊喜**: 20%天品概率，经常出金
2. **锁定策略成功**: 保留好属性，刷出更好属性，正反馈明确
3. **星域圆满**: 5个天品集齐的视觉成就感

### 9.2 中期目标（小时级）

1. **本周天大圆满**: 1-2天的明确目标
2. **属性build**: 优先堆攻击？还是均衡发展？
3. **星髓管理**: 今天洗练哪个星域最划算？

### 9.3 长期追求（周/月级）

1. **指数积累**: 第N周天的指数加成带来的巨大差距
2. **极限build**: 纯攻击极限流 vs 均衡发展流
3. **周天数排行榜**（如有排行榜系统）

---

## 十、实现要点

### 10.1 核心数据结构

```javascript
zhouTianSystem = {
    level: 1,                    // 当前周天等级
    completions: 0,              // 大圆满次数（指数加成 = ×0.1%）
    marrow: 10000,               // 星髓数量

    // 25个星窍的品质 (1-5)
    acupoints: [
        1,1,1,1,1,  // 青龙
        1,1,1,1,1,  // 朱雀
        1,1,1,1,1,  // 白虎
        1,1,1,1,1,  // 玄武
        1,1,1,1,1   // 麒麟
    ],

    locks: [],                   // 锁定索引

    // 预览状态
    preview: {
        sectorIdx: null,
        data: [1,2,3,4,5]
    }
}
```

### 10.2 品质倍率配置

```javascript
const QUALITY_CONFIG = [
    { level: 1, name: '凡', color: 'slate', multiplier: 1 },
    { level: 2, name: '灵', color: 'green', multiplier: 2 },
    { level: 3, name: '玄', color: 'blue', multiplier: 4 },
    { level: 4, name: '地', color: 'purple', multiplier: 8 },
    { level: 5, name: '天', color: 'amber', multiplier: 16 }
];

const SECTOR_CONFIG = [
    { name: '东方青龙', attr: 'attack', factor: 1.0 },
    { name: '南方朱雀', attr: 'health', factor: 1.0 },
    { name: '西方白虎', attr: 'dropRate', factor: 0.005 },  // 每点倍率+0.5%
    { name: '北方玄武', attr: 'marrowBonus', factor: 0.005 },
    { name: '中央麒麟', attr: 'allStats', factor: 0.3 }     // 全属性系数较低
];
```

### 10.3 关键计算方法

```javascript
// 获取某星域的倍率和
function getSectorMultiplier(sectorIdx) {
    const start = sectorIdx * 5;
    const end = start + 5;
    let sum = 0;

    for (let i = start; i < end; i++) {
        const quality = state.acupoints[i];
        sum += QUALITY_CONFIG[quality - 1].multiplier;
    }

    return sum;
}

// 获取周天系数
function getZhouTianCoefficient() {
    return 1 + (state.level - 1) * 0.5;
}

// 获取各属性加成
function getZhouTianBonuses() {
    const coeff = getZhouTianCoefficient();

    return {
        attack: getSectorMultiplier(0) * coeff * SECTOR_CONFIG[0].factor,
        health: getSectorMultiplier(1) * coeff * SECTOR_CONFIG[1].factor,
        dropRate: getSectorMultiplier(2) * coeff * SECTOR_CONFIG[2].factor,
        marrowBonus: getSectorMultiplier(3) * coeff * SECTOR_CONFIG[3].factor,
        allStats: getSectorMultiplier(4) * coeff * SECTOR_CONFIG[4].factor
    };
}

// 获取指数加成百分比
function getExponentBonus() {
    return state.completions * 0.1;  // 0.1%
}
```

---

## 十一、平衡性自检清单

- [ ] 20%天品概率是否太高？是否需要降低至15%或10%？
- [ ] 每周天+0.1%指数是否足够有吸引力？是否需要+0.2%？
- [ ] 各星域属性权重是否平衡？麒麟全属性是否太弱？
- [ ] 洗练成本曲线是否支持"快速迭代"的目标？
- [ ] 星髓产出是否与消耗匹配？是否需要动态调整？
- [ ] 与其他养成系统的数值比例是否协调？

---

## 附录：新版数值速查

### 品质倍率
| 等级 | 倍率 | 概率 |
|------|------|------|
| 凡 | ×1 | 20% |
| 灵 | ×2 | 20% |
| 玄 | ×4 | 20% |
| 地 | ×8 | 20% |
| 天 | ×16 | 20% |

### 周天系数
| 周天 | 系数 | 指数加成 |
|------|------|----------|
| 1 | ×1.0 | +0.0% |
| 2 | ×1.5 | +0.1% |
| 3 | ×2.0 | +0.2% |
| 5 | ×3.0 | +0.4% |
| 10 | ×5.5 | +0.9% |

### 洗练成本
| 锁定 | 消耗 |
|------|------|
| 0 | 50 |
| 1 | 100 |
| 2 | 150 |
| 3 | 200 |
| 4 | 250 |
