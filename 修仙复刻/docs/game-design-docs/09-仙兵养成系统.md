# 仙兵养成系统 - 词条洗练（梦幻模拟战/暗黑式）

## 🎯 核心定位

**系统名称**：本命仙兵  
**核心体验**：洗练词条追求极品 + 品质突破系统  
**特色**：6个仙兵槽位，每个5条属性，追求全UR品质，数值指数级成长

---

## 🎮 核心机制（参考第二张图）

### 1. 仙兵槽位

```javascript
const IMMORTAL_WEAPONS = {
    // 6个仙兵，与装备系统完全独立
    slots: [
        { id: 'main',    name: '本命剑', icon: '⚔️', desc: '主手武器' },
        { id: 'offhand', name: '护心镜', icon: '🛡️', desc: '副手法宝' },
        { id: 'armor',   name: '琉璃甲', icon: '👕', desc: '防具' },
        { id: 'helm',    name: '玄天冠', icon: '👑', desc: '头部' },
        { id: 'boots',   name: '踏云履', icon: '👢', desc: '鞋子' },
        { id: 'acc',     name: '乾坤戒', icon: '💍', desc: '饰品' }
    ],
    
    // 每个仙兵有5条属性
    affixCount: 5,
    
    // 品质等级
    qualities: ['N', 'R', 'SR', 'SSR', 'UR'],
    
    // 品质数值倍率
    qualityMultipliers: {
        N:    1,      // 白色
        R:    5,      // 绿色
        SR:   25,     // 蓝色
        SSR:  125,    // 紫色
        UR:   625     // 金色
    },
    
    // 突破等级
    maxLevel: 9999
};
```

### 2. 属性类型

```javascript
const AFFIX_TYPES = [
    { id: 'atk',      name: '攻击力',    base: 100,   icon: '⚔️' },
    { id: 'hp',       name: '生命值',    base: 500,   icon: '❤️' },
    { id: 'def',      name: '防御力',    base: 50,    icon: '🛡️' },
    { id: 'crit',     name: '暴击率',    base: 1,     icon: '💥' },
    { id: 'crit_dmg', name: '暴击伤害',  base: 5,     icon: '🔥' },
    { id: 'speed',    name: '攻击速度',  base: 2,     icon: '⚡' },
    { id: 'lifesteal', name: '生命偷取', base: 1,     icon: '🧛' },
    { id: 'dmg_bonus', name: '伤害加成', base: 2,     icon: '💢' }
];
```

### 3. 洗练机制

```javascript
const WASH_SYSTEM = {
    // 洗练消耗
    cost: (weaponLevel) => 100 * Math.pow(1.1, weaponLevel),
    
    // 洗练结果
    wash: {
        // 随机生成5条新属性
        // 每条属性 = 随机类型 + 随机品质
        
        types: '从AFFIX_TYPES随机5个（可重复）',
        
        qualityWeights: {
            N:   50,  // 50%
            R:   30,  // 30%
            SR:  15,  // 15%
            SSR:  4,  // 4%
            UR:   1   // 1%
        }
    },
    
    // 锁定机制
    lock: {
        max: 2,           // 最多锁2条
        cost: 500         // 锁一条+500消耗
    }
};
```

### 4. 突破机制（核心成长）

```javascript
const BREAKTHROUGH = {
    // 突破条件：当前5条属性全部达到UR品质
    condition: 'all_affixes_quality === UR',
    
    // 突破效果
    effect: {
        level: '+1',
        qualityReset: 'N',    // 品质回N，但可以继续洗
        statBoost: '×1.1指数级'  // 每次突破基础数值×1.1
    },
    
    // 突破奖励
    bonus: {
        10: '解锁仙兵特效',
        50: '解锁仙兵光环',
        100: '解锁仙兵觉醒',
        500: '解锁仙兵真身',
        1000: '仙兵化灵'
    }
};
```

---

## 📦 材料来源

### 仙材副本

```javascript
const IMMORTAL_MATERIAL = {
    name: '仙兵遗迹',
    unlockLevel: 40,
    dailyAttempts: 5,
    
    // 层数系统
    floors: {
        max: 200,
        reward: (floor) => 50 + floor * 2  // 第N层给 50+2N 仙材
    },
    
    // 材料
    drop: '仙材（唯一材料，用于洗练）'
};
```

---

## 📊 数值设计

### 单条属性数值

```javascript
// 属性值 = 基础值 × 品质倍率 × 突破系数^等级
function calculateAffixValue(type, quality, level) {
    const base = AFFIX_TYPES.find(t => t.id === type).base;
    const qualityMult = IMMORTAL_WEAPONS.qualityMultipliers[quality];
    const levelMult = Math.pow(1.1, level);  // 指数级！
    
    return base * qualityMult * levelMult;
}

// 例子：攻击力，UR品质，100级
// = 100 × 625 × 1.1^100 
// ≈ 100 × 625 × 13,780 
// ≈ 8.6亿

// 6个仙兵 × 5条属性 = 30条属性
// 全UR 100级 ≈ 30 × 8.6亿 = 258亿属性
```

### 指数级成长曲线

| 突破等级 | 系数 | UR攻击力 | 全30条总属性 |
|---------|------|---------|-------------|
| 0 | 1.0 | 62,500 | 187万 |
| 10 | 2.6 | 162,500 | 487万 |
| 50 | 117 | 731万 | 21.9亿 |
| 100 | 13,780 | 8.6亿 | 2,580亿 |
| 200 | 1.9亿 | 11.9万亿 | 357万亿 |
| 500 | 4.2×10²⁰ | 2.6×10²³ | 7.8×10²⁴ |

**这正是我们要的指数级！**

---

## 🔄 迭代路线图

### Phase 1 - 基础洗练（1周）
- 6个仙兵槽位
- 每个仙兵5条属性
- 洗练系统（随机5条新属性）
- 替换/保留选择

### Phase 2 - 锁定系统（3天）
- 可以锁定1-2条属性
- 锁定后消耗增加

### Phase 3 - 突破系统（1周）
- 全UR可以突破
- 突破+1，品质回N
- 基础数值指数级增长

### Phase 4 - 特效系统（1周）
- 突破10级解锁部位特效
- 突破50级解锁仙兵光环
- 突破100级解锁觉醒技能

### Phase 5 - 保底机制（3天）
- 洗练次数保底（一定次数必出UR）
- 突破保护券（突破失败不降级）

---

## 💰 商业化

### 付费点

```
1. 仙材礼包
   - 小包（6元）：1000仙材
   - 大包（30元）：6000仙材

2. 锁定券（核心付费）
   - 单价：12元/张
   - 作用：洗练时可以锁定2条属性
   - 追求全UR必买

3. 突破保护符（高价值）
   - 单价：68元/张
   - 作用：突破失败不降级
   - 100级以上突破几乎必买

4. 必成符（超高价值）
   - 单价：198元/张
   - 作用：下次洗练5条全UR
   - 土豪追求极致专用

5. 仙兵月卡
   - 30元/月
   - 每日送200仙材 + 1张锁定券
```

---

## 🎨 UI设计（参考截图）

```
┌─────────────────────────────────────────────────┐
│  ⚔️ 本命仙兵                                      │
├─────────────────────────────────────────────────┤
│                                                  │
│  【仙兵槽位】           仙材: 5,052 💎           │
│  ┌──┬──┬──┬──┬──┐                               │
│  │⚔️│🛡️│👕│👑│👢│💍│                               │
│  │10│14│ 9│10│...│                               │
│  └──┴──┴──┴──┴──┘                               │
│                                                  │
│  【斩仙 - Lv.31/9999】                            │
│  ┌─────────────────────────────────────────┐    │
│  │  当前                      新           │    │
│  │                                          │    │
│  │  全属性  1000垓 UR ☑️     全属性 1000垓 UR │    │
│  │  全属性  300垓  SR        全属性 1000垓 UR │    │
│  │  全属性  1000垓 UR ☑️     全属性 1000垓 UR │    │
│  │  全属性  1000垓 UR        全属性 1000垓 UR │    │
│  │  全属性  1000垓 UR        全属性  300垓  SR │    │
│  │                                          │    │
│  │  总属性: 300e152           总属性: 1000e152│    │
│  │                                          │    │
│  │  已锁2条 (+1000消耗)                      │    │
│  └─────────────────────────────────────────┘    │
│                                                  │
│  【突破条件】                                     │
│  当所有词条均为UR，即可进行突破                   │
│  突破后仙兵等级+1，词条品质变回N                 │
│                                                  │
│     [洗练] 5120仙材    [替换]    [保留]          │
│                                                  │
│  💡 每级仙兵等级使神器属性指数级提升0.2%         │
└─────────────────────────────────────────────────┘
```

---

## 🔧 技术实现

### 数据结构

```javascript
class ImmortalWeapon {
    constructor() {
        // 6个仙兵
        this.weapons = {
            main:    { level: 0, affixes: [] },
            offhand: { level: 0, affixes: [] },
            armor:   { level: 0, affixes: [] },
            helm:    { level: 0, affixes: [] },
            boots:   { level: 0, affixes: [] },
            acc:     { level: 0, affixes: [] }
        };
        
        // 材料
        this.materials = 0;
        
        // 洗练预览（未确认的新属性）
        this.previewAffixes = null;
    }
    
    // 生成随机5条属性
    generateAffixes() {
        const affixes = [];
        for (let i = 0; i < 5; i++) {
            const type = randomChoice(AFFIX_TYPES);
            const quality = weightedRandom(IMMORTAL_WEAPONS.qualityWeights);
            affixes.push({
                type: type.id,
                quality: quality,
                value: this.calculateValue(type.id, quality)
            });
        }
        return affixes;
    }
    
    // 计算属性值
    calculateValue(typeId, quality) {
        const type = AFFIX_TYPES.find(t => t.id === typeId);
        const weapon = this.weapons[this.selectedSlot];
        const qualityMult = IMMORTAL_WEAPONS.qualityMultipliers[quality];
        const levelMult = Math.pow(1.1, weapon.level);
        
        return type.base * qualityMult * levelMult;
    }
    
    // 洗练
    wash(lockedIndices = []) {
        const cost = this.calculateWashCost(lockedIndices.length);
        if (this.materials < cost) return '材料不足';
        
        this.materials -= cost;
        
        // 生成新属性
        const current = this.weapons[this.selectedSlot].affixes;
        const newAffixes = this.generateAffixes();
        
        // 应用锁定
        lockedIndices.forEach(idx => {
            newAffixes[idx] = current[idx];
        });
        
        this.previewAffixes = newAffixes;
        return '洗练成功';
    }
    
    // 确认替换
    confirmReplace() {
        if (!this.previewAffixes) return;
        
        this.weapons[this.selectedSlot].affixes = this.previewAffixes;
        this.previewAffixes = null;
        
        // 检查是否可以突破
        this.checkBreakthrough();
    }
    
    // 检查突破
    checkBreakthrough() {
        const weapon = this.weapons[this.selectedSlot];
        const allUR = weapon.affixes.every(a => a.quality === 'UR');
        
        if (allUR) {
            // 可以突破
            weapon.level++;
            // 品质回N，但数值×1.1
            weapon.affixes = weapon.affixes.map(a => ({
                ...a,
                quality: 'N',
                value: this.calculateValue(a.type, 'N')
            }));
            return '突破成功！等级+';
        }
    }
    
    // 获取总属性加成
    getTotalBonus() {
        let bonus = {};
        
        Object.values(this.weapons).forEach(weapon => {
            weapon.affixes.forEach(affix => {
                if (!bonus[affix.type]) bonus[affix.type] = 0;
                bonus[affix.type] += affix.value;
            });
        });
        
        return bonus;
    }
}
```

---

## ✅ 验收标准

- [ ] 6个仙兵槽位可切换
- [ ] 每个仙兵5条属性
- [ ] 洗练随机生成5条新属性
- [ ] 可以锁定1-2条属性
- [ ] 全UR时可以突破
- [ ] 突破后等级+1，品质回N，数值×1.1
- [ ] 属性计算使用BigNum（指数级！）
- [ ] 替换/保留功能正常

---

## 🎯 与魂器系统的区别

| 维度 | 魂器淬炼 | 仙兵养成 |
|-----|---------|---------|
| 体验 | 赌博强化（一次成功/失败） | 词条收集（慢慢追求全UR） |
| 节奏 | 刺激、瞬间、大起大落 | 渐进、积累、追求极致 |
| 失败 | 掉级/归零（心疼） | 只是没出好词条（继续洗） |
| 成长 | 线性（每级+10%） | 指数级（突破×1.1） |
| 付费点 | 保护符（3元） | 锁定券（12元）、必成符（198元） |
| 目标玩家 | 喜欢刺激、赌狗 | 喜欢养成、追求极致 |

---

## 🎮 两个系统并存的价值

1. **覆盖不同玩家类型**
   - 魂器吸引刺激型玩家
   - 仙兵吸引收集型玩家

2. **时间错开**
   - 魂器：前期就有（30级解锁）
   - 仙兵：中后期（40级解锁）

3. **材料不冲突**
   - 魂器用魂石
   - 仙兵用仙材
   - 两个副本分开刷

4. **付费不重叠**
   - 魂器：3元保护符
   - 仙兵：12元锁定券
   - 两个系统都想玩的玩家付双倍

5. **开发复用**
   - 两个系统都使用"层数副本+洗练/强化"结构
   - UI布局可以复用
   - 后端逻辑相似
