# 周天星窍系统 - 无限循环突破式养成

## 🎯 核心体验
> "洗练36个星窍追求全UR → 达成后突破周天 → 基础×2重新洗 → 无限循环"

---

## 💎 一句话规则

**36个星窍，每个有品质（N→UR），洗练追求全UR，达成后突破到下一周天（基础×2），星窍品质回N，重新洗。**

---

## 🎮 核心机制

### 1. 星窍布局（36个）

```javascript
const STAR_ACUPOINTS = {
    // 36个星窍，对应人体大周天
    // 简单排列成6×6矩阵，视觉清晰
    count: 36,
    layout: '6×6矩阵',
    
    // 每个星窍独立品质
    qualities: {
        1: { name: '凡', color: '#888', multiplier: 1 },
        2: { name: '灵', color: '#0f0', multiplier: 3 },
        3: { name: '玄', color: '#00f', multiplier: 9 },
        4: { name: '地', color: '#f0f', multiplier: 27 },
        5: { name: '天', color: '#fa0', multiplier: 81 },
        6: { name: '圣', color: '#f00', multiplier: 243 },
        7: { name: '道', color: '#ff0', multiplier: 729 },
        8: { name: '仙', color: '#0ff', multiplier: 2187 },
        9: { name: '神', color: '#fff', multiplier: 6561 }  // UR
    }
};
```

### 2. 周天突破（核心循环）

```javascript
const ZHOUTIAN_BREAKTHROUGH = {
    // 条件：36个星窍全部达到"神"品质（9级）
    condition: 'all 36 acupoints quality === 9',
    
    // 突破效果
    effect: {
        // 周天+1
        stage: '+1',
        
        // 星窍品质全部回1（凡）
        qualityReset: 1,
        
        // 但基础倍率×2
        // 第1周天：神品质=×6561
        // 第2周天：神品质=×13122（×2）
        // 第N周天：神品质=×6561×(2^N)
        baseMultiplier: (zhouTian) => Math.pow(2, zhouTian)
    },
    
    // 无上限，无限循环
    maxZhouTian: Infinity
};
```

### 3. 洗练机制（悟道）

```javascript
const ENLIGHTENMENT = {
    // 消耗：星髓（唯一材料）
    cost: 100,  // 基础100，每次洗练+10，每天重置
    
    // 洗练结果：随机改变所有36个星窍品质
    result: {
        // 每个星窍独立随机
        // 权重：越高级越难出
        weights: {
            1: 40,  // 凡 40%
            2: 25,  // 灵 25%
            3: 15,  // 玄 15%
            4: 10,  // 地 10%
            5: 6,   // 天 6%
            6: 3,   // 圣 3%
            7: 0.8, // 道 0.8%
            8: 0.15,// 仙 0.15%
            9: 0.05 // 神 0.05%（万分之5）
        }
    },
    
    // 锁定机制：可锁定0-3个星窍不被改变
    lock: {
        max: 3,
        costPerLock: 200  // 每锁一个+200消耗
    },
    
    // 替换/保留：洗出新结果后选择是否替换
    choice: 'KEEP_OR_REPLACE'
};
```

### 4. 数值计算

```javascript
// 总属性倍率 = 基础倍率 × 所有星窍倍率之和
function calculateMultiplier(zhouTian, acupoints) {
    const base = Math.pow(2, zhouTian);  // 周天基础
    
    let acupointTotal = 0;
    for (let q of acupoints) {
        acupointTotal += STAR_ACUPOINTS.qualities[q].multiplier;
    }
    
    return base * acupointTotal;
}

// 示例计算：
// 第1周天，全神品质（9级）
// = 2^1 × (36 × 6561) 
// = 2 × 236,196 
// = 472,392倍

// 第10周天，全神品质
// = 2^10 × 236,196
// = 1024 × 236,196
// = 241,864,704倍（2.4亿倍）

// 第100周天，全神品质  
// = 2^100 × 236,196
// ≈ 1.27e30 × 2.36e5
// ≈ 3e35倍（天文数字）
```

---

## 📦 材料来源

### 星髓矿脉（独立副本）

```javascript
const STAR_MARROW = {
    name: '星髓矿脉',
    unlockLevel: 30,
    
    // 玩法：挖矿，越深层矿脉奖励越多
    // 但可以随时退出结算，挖越深风险越大（可能遇到坍塌损失50%）
    
    mechanics: {
        // 每层给100星髓
        rewardPerFloor: 100,
        
        // 但每层有10%概率"坍塌"
        // 坍塌时损失当前已获得的50%
        // 可以选择"见好就收"或"继续深入"
        collapseChance: 0.10,
        collapsePenalty: 0.50,
        
        // 每日3次机会
        dailyAttempts: 3
    },
    
    // 也可以直接购买：1元 = 500星髓
    purchase: {
        rate: '1元 = 500星髓'
    }
};
```

---

## 🎨 UI设计

```
┌──────────────────────────────────────────────────────┐
│  ✨ 周天星窍 - 第12周天                                 │
├──────────────────────────────────────────────────────┤
│                                                        │
│  星髓: 15,230 ⭐  [进入矿脉]                           │
│                                                        │
│  【突破进度】 神窍: 28/36  ⚠️ 还需8个                  │
│  [========================>        ] 77.8%             │
│                                                        │
│  【当前总倍率】 ×482,391,840 🔥                        │
│  基础: ×4096 | 星窍: ×117,696                          │
│                                                        │
│  【36星窍矩阵】  [一键锁定最高3个]                      │
│  ┌────┬────┬────┬────┬────┬────┐                    │
│  │ 神 │ 仙 │ 圣 │ 天 │ 地 │ 玄 │  ←第1行              │
│  │ ☑️ │    │    │    │    │    │  (已锁)              │
│  ├────┼────┼────┼────┼────┼────┤                    │
│  │ 神 │ 神 │ 道 │ 圣 │ 玄 │ 灵 │  ←第2行              │
│  │ ☑️ │ ☑️ │    │    │    │    │  (已锁2个)           │
│  ├────┼────┼────┼────┼────┼────┤                    │
│  │ 仙 │ 地 │ 天 │ 灵 │ 凡 │ 凡 │                      │
│  ├────┼────┼────┼────┼────┼────┤                    │
│  │ ... (省略) ...              │                      │
│  └────┴────┴────┴────┴────┴────┘                    │
│                                                        │
│  【悟道洗练】                                          │
│  消耗: 星髓×340 (基础100 + 锁定3×80)                   │
│  [☑️ 锁定最高品质] 已锁: 3/3                           │
│                                                        │
│        【开始悟道】☯️                                  │
│                                                        │
│  悟道记录:                                             │
│  [第11次] 28神8仙 → 26神9仙2道  | 保留                │
│  [第10次] 25神 → 28神8仙          | 替换 ✓            │
└──────────────────────────────────────────────────────┘
```

---

## 🎰 赌博性设计

### 1. 洗练瞬间

```
【开始悟道】

36个星窍闪烁...

✨✨✨✨✨✨
✨✨✨✨✨✨
✨✨✨✨✨✨

[结果揭晓]

神: 28 (+2) 🔥
仙: 5 (-3)
圣: 2
天: 1

⚠️ 未达成全神，无法突破！

[保留] [放弃]
```

### 2. 矿脉探险

```
当前深度: 47层
已获得: 4,700星髓

下一层: 48层
成功概率: 90%
预计获得: +100 = 4,800

[继续深入]  [见好就收]

⚠️ 若坍塌，损失2,350星髓！
```

---

## 💰 商业化

```
1. 悟道锁定符（核心）
   - 效果：可锁定4-5个星窍（突破3个限制）
   - 定价：18元/张

2. 星髓礼包
   - 小包（6元）：3,000星髓
   - 大包（30元）：20,000星髓

3. 周天加速令（高价值）
   - 效果：下次洗练必出全神品质（但周天不+1）
   - 定价：198元/枚
   - 用途：冲记录、冲榜

4. 坍塌保险
   - 效果：矿脉坍塌时不损失
   - 定价：3元/次

5. 月卡
   - 效果：每日送2,000星髓 + 免费锁定+1
   - 定价：30元/月
```

---

## 🔄 迭代路线图

### Phase 1 - 基础循环（1周）
- 36星窍 + 洗练 + 突破
- 星髓矿脉
- 核心循环跑通

### Phase 2 - 锁定系统（3天）
- 可锁定3个星窍
- 付费突破锁定数

### Phase 3 - 矿脉深度（3天）
- 见好就收机制
- 坍塌风险

### Phase 4 - 特殊星窍（1周）
- 特定位置星窍有特殊效果（如角落4个双倍倍率）
- 洗练策略更复杂

### Phase 5 - 周天特效（1周）
- 每10周天解锁特效（角色光环、战斗特效）
- 外观炫耀

### Phase 6 - 多人排行（1周）
- 全服周天排行榜
- 每周重置矿脉深度榜

---

## 🔧 技术实现

```javascript
class StarAcupointSystem {
    constructor() {
        this.zhouTian = 1;  // 当前周天
        this.acupoints = Array(36).fill(1);  // 36个星窍，默认凡品
        this.stoneMarrow = 0;  // 星髓
        this.preview = null;  // 洗练预览
    }
    
    // 洗练
    enlighten(lockedIndices = []) {
        const cost = 100 + lockedIndices.length * 80;
        if (this.stoneMarrow < cost) return '材料不足';
        
        this.stoneMarrow -= cost;
        
        // 生成新结果
        const newAcupoints = this.acupoints.map((q, i) => {
            if (lockedIndices.includes(i)) return q;  // 锁定的不变
            return this.randomQuality();  // 随机新品质
        });
        
        this.preview = newAcupoints;
        return 'success';
    }
    
    // 随机品质（按权重）
    randomQuality() {
        const weights = [40, 25, 15, 10, 6, 3, 0.8, 0.15, 0.05];
        const total = weights.reduce((a, b) => a + b, 0);
        let roll = Math.random() * total;
        
        for (let i = 0; i < weights.length; i++) {
            roll -= weights[i];
            if (roll <= 0) return i + 1;
        }
        return 1;
    }
    
    // 确认替换
    confirmReplace() {
        if (!this.preview) return;
        this.acupoints = this.preview;
        this.preview = null;
        
        // 检查突破
        if (this.canBreakthrough()) {
            this.breakthrough();
        }
    }
    
    // 检查可突破
    canBreakthrough() {
        return this.acupoints.every(q => q === 9);
    }
    
    // 突破
    breakthrough() {
        this.zhouTian++;
        this.acupoints.fill(1);  // 重置为凡品
        
        // 特效：全屏金光，数字爆炸
        this.showBreakthroughEffect();
        
        return `突破成功！进入第${this.zhouTian}周天！`;
    }
    
    // 计算总倍率
    getMultiplier() {
        const base = Math.pow(2, this.zhouTian);
        const acupointSum = this.acupoints.reduce((sum, q) => {
            return sum + Math.pow(3, q - 1);  // 1,3,9,27...
        }, 0);
        return base * acupointSum;
    }
}
```

---

## ✅ 为什么这个设计符合要求

| 要求 | 实现 |
|-----|------|
| **转生式循环** | ✓ 周天突破，数值爆炸，重置再来 |
| **瞬间数值膨胀** | ✓ 突破时倍率×2，视觉冲击 |
| **阶段性完成** | ✓ 36个全神品质 = 一个阶段完成 |
| **不断重复** | ✓ 洗练→替换→洗练→突破→再洗练 |
| **洗词条体验** | ✓ 36个条目随机roll品质 |
| **强化体验** | ✓ 突破后基础提升，重新强化 |
| **无限迭代** | ✓ 无上限，可以无限周天 |
| **最小成本** | ✓ 36个数字+洗练+突破，极简 |

---

## 🎯 与仙兵系统对比

| 维度 | 仙兵系统 | 周天星窍 |
|-----|---------|---------|
| 条目数 | 6件×5条=30条 | 36个星窍 |
| 品质数 | 5级（N-R-SR-SSR-UR） | 9级（凡到神） |
| 突破条件 | 全UR | 全神（9级） |
| 突破效果 | 等级+1，品质回N，×1.1 | 周天+1，品质回凡，基础×2 |
| 成长曲线 | ×1.1指数 | **×2指数（更激进）** |
| 洗练方式 | 一次洗5条 | **一次洗36条（更爽）** |
| 锁定数 | 2条 | **3条（更宽容）** |

**星窍系统：更多条目、更激进成长、更爽快的批量洗练。**
