# 魂器淬炼系统 - 部位强化（DNF式）

## 🎯 核心定位

**系统名称**：四象魂器（魂、心、体、意）  
**核心体验**：DNF式部位强化 + 造梦西游魂器淬炼  
**特色**：4个独立部位，每个都能强化到+20，失败掉级刺激赌博感

---

## 🎮 核心机制（最简单形式）

### 1. 四象魂器

```javascript
const SOUL_ARTIFACTS = {
    // 4个独立部位，与装备系统完全分离
    slots: [
        { id: 'soul',  name: '魂', icon: '🔮', stat: 'atk_pct', desc: '攻击加成' },
        { id: 'heart', name: '心', icon: '❤️', stat: 'hp_pct',  desc: '生命加成' },
        { id: 'body',  name: '体', icon: '💪', stat: 'def_pct', desc: '防御加成' },
        { id: 'will',  name: '意', icon: '👁️', stat: 'crit_pct', desc: '暴击加成' }
    ],
    
    // 每个部位独立强化等级
    maxLevel: 20,
    
    // 成功率（越高级越难）
    successRate: {
         0: 1.0,   // +0→+1: 100%
         1: 0.95,  // +1→+2: 95%
         2: 0.9,   // ...
         3: 0.85,
         4: 0.8,
         5: 0.75,  // +5开始有意思
         6: 0.6,
         7: 0.5,   // 50%分水岭
         8: 0.4,
         9: 0.3,
        10: 0.25,  // +10大坎
        11: 0.2,
        12: 0.15,
        13: 0.12,
        14: 0.1,
        15: 0.08,  // +15以上极度困难
        16: 0.05,
        17: 0.03,
        18: 0.02,
        19: 0.01   // +19→+20: 1%
    },
    
    // 失败惩罚（+8开始）
    failPenalty: {
        0: 'none',      // 无惩罚
        1: 'none',
        2: 'none',
        3: 'none',
        4: 'none',
        5: 'none',
        6: 'none',
        7: 'downgrade', // +8开始失败降级
        8: 'downgrade',
        9: 'downgrade',
        10: 'reset',    // +11开始失败归零
        11: 'reset',
        12: 'reset',
        13: 'reset',
        14: 'reset',
        15: 'reset',
        16: 'reset',
        17: 'reset',
        18: 'reset',
        19: 'reset'
    },
    
    // 属性加成（每级固定+10%，+20=300%）
    statBonus: (level) => 1 + (level * 0.1)
};
```

### 2. 淬炼材料

```javascript
const FORGE_MATERIALS = {
    // 唯一材料：魂石
    '魂石': {
        // 所有强化都只用这一种材料
        // 简化材料系统，降低理解成本
        baseCost: 10,           // +0→+1 需要10个
        costGrowth: 1.5,        // 每级成本×1.5
        // +20需要约 10 × 1.5^20 ≈ 3万个魂石
    }
};
```

---

## 📦 材料来源（新建副本）

### 魂石矿洞（每日副本）

```javascript
const SOUL_MINE = {
    name: '魂石矿洞',
    unlockLevel: 30,  // 境界30解锁
    
    // 每日次数
    dailyAttempts: 3,
    
    // 层数系统（类似通天塔）
    floors: {
        max: 100,
        reward: (floor) => 10 + floor  // 第N层给 10+N 个魂石
    },
    
    // 难度
    difficulty: 'current_difficulty × 1.5',
    
    // 快速扫荡
    sweep: {
        unlock: '通关过的层数可以扫荡',
        cost: '每日免费3次，额外5魂石/次'
    }
};
```

---

## 📊 数值设计

### 属性加成

| 部位 | +0 | +10 | +15 | +20 |
|-----|-----|-----|-----|-----|
| 魂（攻击） | 100% | 200% | 250% | 300% |
| 心（生命） | 100% | 200% | 250% | 300% |
| 体（防御） | 100% | 200% | 250% | 300% |
| 意（暴击） | 100% | 200% | 250% | 300% |

**总加成**：4个部位都+20 = 全属性×4

### 成功率心理曲线

```
+0~+5：安心期（75%~100%）
+6~+9：紧张期（40%~60%，可能降级）
+10~+12：刺激期（15%~25%，可能归零）
+13~+20：赌狗期（1%~12%，归零但装备还在）
```

---

## 🔄 迭代路线图

### Phase 1 - 基础淬炼（1周）
- 4个部位 +0~+20 强化
- 魂石矿洞副本
- 基础成功率/失败惩罚

### Phase 2 - 保护机制（3天）
- 保护符（失败后不掉级/归零，消耗1张）
- 保底系统（连续失败+成功率）

### Phase 3 - 幸运系统（3天）
- 幸运值（每次失败+幸运值，成功清空）
- 幸运值可兑换成功率加成

### Phase 4 - 特殊效果（1周）
- +10解锁部位特效（发光）
- +15解锁部位专属被动
- +20解锁部位觉醒技能

### Phase 5 - 套装效果（1周）
- 4个部位都+10：全属性额外+20%
- 4个部位都+15：全属性额外+50%
- 4个部位都+20：全属性额外+100%

---

## 💰 商业化

### 付费点

```
1. 魂石礼包
   - 小包（6元）：500魂石
   - 大包（30元）：3000魂石

2. 保护符（核心付费）
   - 单价：3元/张
   - 作用：强化失败时不掉级/归零
   - +10以后几乎必买

3. 每日扫荡券
   - 5魂石/张或1元/张
   - 快速获取魂石

4. 双倍魂石卡
   - 月卡：30元/月，矿洞产出×2

5. 保底券（高价值）
   - 必成券（68元）：100%成功一次（限+12以下）
```

---

## 🎨 UI设计

```
┌─────────────────────────────────────────────────┐
│  🔮 四象魂器                                      │
├─────────────────────────────────────────────────┤
│                                                  │
│  【选择部位】          魂石: 15,230 💎           │
│  ┌────────┬────────┬────────┬────────┐         │
│  │  🔮魂  │  ❤️心  │  💪体  │  👁️意  │         │
│  │  +17   │  +14   │  +14   │  +14   │         │
│  │ [选中] │        │        │        │         │
│  └────────┴────────┴────────┴────────┘         │
│                                                  │
│  【魂 - 当前状态】                                │
│  强化等级: +17                                   │
│  攻击加成: 270%                                  │
│  下一级: +18 (280%)                              │
│                                                  │
│  【淬炼】 (+17 → +18)                            │
│  成功率: 3%                                      │
│  失败惩罚: 归零 ⚠️                               │
│  消耗: 魂石×2,500                                │
│  [☑️ 使用保护符 (剩余: 5)]                       │
│                                                  │
│  幸运值: 1,200 (下次+12%成功率)                  │
│                                                  │
│        [开始淬炼] 🔥                             │
│                                                  │
│  淬炼记录:                                       │
│  [+17→+18] 失败 归零      12:30                  │
│  [+0→+17]  成功          12:15  ←用了保护符      │
│  [+16→+17] 失败 保持     12:10                  │
└─────────────────────────────────────────────────┘
```

---

## 🔧 技术实现

### 新增文件

```
js/
├── classes/
│   └── SoulArtifact.js      # 魂器类
├── config/
│   └── soul-config.js       # 魂器配置
└── game/
    └── SoulSystem.js        # 魂器系统管理
```

### 数据结构

```javascript
class SoulArtifactSystem {
    constructor() {
        // 4个部位，每个独立等级
        this.levels = {
            soul: 0,   // 魂
            heart: 0,  // 心
            body: 0,   // 体
            will: 0    // 意
        };
        
        // 幸运值（每个部位独立或共用）
        this.luckyPoints = 0;
        
        // 材料
        this.soulStones = 0;
        this.protectTokens = 0;
    }
    
    // 计算属性加成
    getTotalBonus() {
        let bonus = { atk: 1, hp: 1, def: 1, crit: 1 };
        
        bonus.atk = 1 + (this.levels.soul * 0.1);
        bonus.hp = 1 + (this.levels.heart * 0.1);
        bonus.def = 1 + (this.levels.body * 0.1);
        bonus.crit = 1 + (this.levels.will * 0.1);
        
        return bonus;
    }
    
    // 强化
    enhance(slot, useProtect) {
        const currentLevel = this.levels[slot];
        const successRate = SOUL_ARTIFACTS.successRate[currentLevel];
        
        // 消耗材料
        const cost = this.calculateCost(currentLevel);
        if (this.soulStones < cost) return '材料不足';
        this.soulStones -= cost;
        
        // 判定成功
        const roll = Math.random();
        const success = roll < successRate;
        
        if (success) {
            this.levels[slot]++;
            this.luckyPoints = 0;  // 成功清空幸运值
            return '成功';
        } else {
            // 处理失败
            if (useProtect && this.protectTokens > 0) {
                this.protectTokens--;
                this.luckyPoints += 100;  // 失败加幸运值
                return '失败（保护生效）';
            } else {
                // 应用惩罚
                const penalty = SOUL_ARTIFACTS.failPenalty[currentLevel];
                if (penalty === 'downgrade') {
                    this.levels[slot]--;
                } else if (penalty === 'reset') {
                    this.levels[slot] = 0;
                }
                this.luckyPoints += 100;
                return '失败';
            }
        }
    }
}
```

---

## ✅ 验收标准

- [ ] 4个部位可以独立强化
- [ ] 每个部位可以强化到+20
- [ ] 成功率按表格执行
- [ ] +8开始失败降级，+11开始失败归零
- [ ] 幸运值系统正常工作
- [ ] 保护符效果正确
- [ ] 魂石矿洞产出正确
- [ ] 淬炼记录显示正确

---

## 🎯 设计亮点

1. **极简材料**：只用一种材料（魂石），降低理解成本
2. **部位独立**：4个部位各自赌博，不会一次失败全完蛋
3. **长期追求**：+20需要约3万魂石×4部位=12万，足够刷很久
4. **刺激感强**：+17只有3%成功率，失败归零，保护符是刚需
5. **付费合理**：保护符3元/张，+10以后几乎必买，但零氪也能靠攒
