# 深渊遗宝系统设计文档

## 📋 系统概述

### 核心体验
**深渊探险 + BOSS挑战 + 收集升级 + 系统属性成长**

深渊遗宝系统是面向中后期玩家的长期养成系统。玩家挑战深渊BOSS获取遗宝，遗宝可升级强化，重复获得溢出为碎片用于兑换。提供5大系统属性加成，形成持续的养成体验。

### 系统定位
| 维度 | 定位 |
|-----|------|
| 目标用户 | 中后期玩家（N50+） |
| 核心循环 | 挑战BOSS → 获取/升级遗宝 → 属性成长 → 变强后更快挑战 |
| 数值类型 | 系统属性加成（全属性倍率、掉率、装备等级等） |
| 付费深度 | 中等（加速挑战次数、复活时间） |

---

## 🎮 核心机制

### 1. 深渊战场场景

深渊副本拥有**独立的战斗场景**，与主线、通天塔、副本完全分离：

**进入流程**：
1. 点击「🌑 深渊遗宝」按钮进入深渊战场场景
2. 点击「👹 召唤深渊BOSS」按钮打开BOSS选择界面
3. 选择已解锁的BOSS开始1v1单挑
4. 战斗结束后自动返回场景，等待复活或选择其他BOSS

**场景特点**：
- 独立场景：不会刷出主线的小怪
- BOSS召唤：手动选择要挑战的BOSS
- 伤害压缩：使用与副本相同的数值压缩逻辑
- 复活机制：每个BOSS有独立的复活倒计时

### 2. 深渊BOSS

游戏中有5个深渊BOSS，按难度递增排列：

| BOSS | 解锁难度 | 复活时间 | 遗宝数量 | 目标击杀 | 目标存活 |
|-----|---------|---------|---------|---------|---------|
| 🐉 深渊魔龙 | N50 | 60秒 | 22个 (UR3+SSR4+SR5+R5+N5) | 40秒 | 50秒 |
| 👹 深渊魔王 | N150 | 90秒 | 22个 | 45秒 | 55秒 |
| 👾 虚空巨兽 | N300 | 120秒 | 22个 | 50秒 | 60秒 |
| 👿 远古邪神 | N500 | 180秒 | 22个 | 55秒 | 65秒 |
| 🌑 混沌主宰 | N800 | 300秒 | 22个 | 60秒 | 70秒 |

### 3. BOSS数值设计（固定预期属性）

深渊BOSS使用**基于解锁难度的固定预期属性**设计，不随玩家成长而变化：

```javascript
// ===== 数值压缩规律 =====
// 主线每+1难度，攻击指数+0.33（因为 2.155³ ≈ 10）
// N-A难度下，玩家压缩攻击 = (0.33 × A)²

// ===== BOSS属性公式（A = 解锁难度）=====
压缩基准 = (0.33 × A)²

// BOSS生命 = 压缩基准 × 目标击杀时间 × DPS倍率
// → 玩家刚好在目标时间内击杀BOSS
BOSS生命 = (0.33 × A)² × killTime × dpsMult

// BOSS攻击 = 压缩基准 × 目标击杀时间 / 目标存活时间  
// → BOSS刚好在目标存活时间内击杀玩家
BOSS攻击 = (0.33 × A)² × killTime / surviveTime

// ===== 示例：深渊魔龙（N50，40秒击杀，50秒存活）=====
压缩基准 = (0.33 × 50)² = 272.25
BOSS生命 = 272.25 × 40 × 1 = 10,890
BOSS攻击 = 272.25 × 40 / 50 = 217.8

// 刚解锁时（N50）玩家预期：
// - 压缩攻击 = 272.25，需要 10,890 / 272.25 = 40秒击杀 ✓
// - 压缩生命 = 272.25 × 5 = 1,361.25
// - 每回合伤害 = 217.8 / 1,361.25 = 16%
// - 实际存活 = 1 / 0.16 = 6.25秒（需要调整理解）
```

**设计原理**：
- **目标击杀时间**：玩家刚解锁时击杀BOSS所需时间（40-60秒）
- **目标存活时间**：玩家在BOSS攻击下可存活时间（50-70秒）
- 玩家变强后，压缩攻击增加，实际击杀时间会显著缩短

### 4. 实际战斗伤害计算

```javascript
// ===== 玩家攻击BOSS =====
// 1. 压缩玩家攻击力
玩家压缩攻击 = (log₁₀(玩家攻击))²

// 2. 对BOSS造成实际伤害
BOSS生命 -= 玩家压缩攻击

// ===== BOSS攻击玩家（副本系统相同逻辑）=====
// 1. 压缩玩家生命值作为防御基准
玩家压缩生命 = (log₁₀(玩家生命))² × 5

// 2. 计算伤害比例
伤害比例 = BOSS攻击 / 玩家压缩生命

// 3. 实际伤害 = 当前生命 × 伤害比例
实际伤害 = 玩家当前生命 × 伤害比例
玩家生命 -= 实际伤害
```

**设计特点**：
- **固定BOSS数值**：基于解锁难度的预期属性，不随玩家变化
- **玩家成长反馈**：变强后击杀BOSS更快
- **动态战斗时间**：预估时间实时显示玩家进步

---

## 🎁 遗宝系统

### 1. 遗宝品质与等级

每个BOSS掉落22个遗宝，分5个品质，每个品质有不同的等级上限：

| 品质 | 数量 | 等级上限 | 属性倍率 | 溢出碎片 | 兑换成本 |
|-----|------|---------|---------|---------|---------|
| N | 5个 | 10级 | 0.5× | 10 | 100 |
| R | 5个 | 8级 | 1× | 20 | 200 |
| SR | 5个 | 5级 | 2.5× | 50 | 500 |
| SSR | 4个 | 3级 | 6× | 100 | 1000 |
| UR | 3个 | 1级 | 15× | 300 | 3000 |

### 2. 遗宝获取与升级

**获取方式**：
1. **BOSS掉落**：击败BOSS随机掉落该BOSS遗宝池中的遗宝
2. **碎片兑换**：使用碎片在图鉴中兑换任意未拥有的遗宝

**升级机制**：
- 已获得遗宝重复掉落时自动升级
- 每级提供**指数级成长**：10^(基础指数 × 品质倍率 × 等级)
- 所有遗宝之间**独立相乘**，形成巨大的指数级提升
- 满级后再次获得自动分解为碎片

**碎片获取**：
- 满级遗宝溢出自动分解为碎片
- 碎片数量 = 该品质的overflowPoints

### 3. 遗宝属性（5大系统属性）

遗宝不再提供战斗内属性，而是影响5大系统：

| 属性ID | 名称 | 基础值 | 计算方式 | 成长公式 |
|-------|-----|-------|---------|---------|
| all_stat_mult | 全属性倍率 | 0.02 | **乘算**（指数级） | 10^(值×品质×等级)，遗宝相乘 |
| tower_drop_rate | 爬塔掉率 | 0.03 | **乘算**（指数级） | 10^(值×品质×等级)，遗宝相乘 |
| pill_effect_mult | 刷丹倍率 | 0.04 | **乘算**（指数级） | 10^(值×品质×等级)，遗宝相乘 |
| equip_level_boost | 装备等级 | **0.006** | **加算**（线性） | 值×品质×等级，遗宝相加 |
| treasure_level_boost | 秘宝等级 | **0.006** | **加算**（线性） | 值×品质×等级，遗宝相加 |

> ⚠️ **重要：计算方式区分设计**
> 
> **乘算属性**（全属性/爬塔/刷丹）：指数级成长，遗宝之间独立相乘，效果爆炸
> 
> **加算属性**（装备/秘宝等级）：线性成长，遗宝之间累加，刻意控制
> - +1装备等级 = 装备属性 × 1.2（看似加算实为乘算）
> - +1秘宝等级 = 秘宝指数属性大幅提升（秘宝本身指数成长）
> - 如果也用乘算，数值会指数级爆炸，破坏游戏平衡

**属性计算公式**（指数级成长，独立相乘）：
```javascript
// 单个遗宝加成 = 10^(基础指数 × 品质倍率 × 等级)
// 所有同类型遗宝之间乘算

// 品质倍率：N(0.5) / R(1) / SR(2.5) / SSR(6) / UR(15)

// 【乘算属性】全属性/爬塔/刷丹（基础值 0.02~0.04）
// UR 1级：10^(0.02×15) = 10^0.3 ≈ ×2.0
// N 10级：10^(0.02×0.5×10) = 10^0.1 ≈ ×1.26
// 5个UR相乘：2^5 = 32倍

// 【加算属性】装备等级/秘宝等级（基础值 0.006）
// UR 1级：0.006 × 15 = +0.09 等级
// N 10级：0.006 × 0.5 × 10 = +0.03 等级
// 5个UR相加：0.09 × 5 = +0.45 等级
```

### 4. 满级预期效果

**单遗宝加成效果**：
```
【乘算属性】（基础值 0.02~0.04，指数级成长）
- UR 1级：×2.0    - SSR 3级：×2.0
- SR 5级：×1.78   - R 8级：×1.58
- N 10级：×1.26

【加算属性】（基础值 0.006，线性成长）
- UR 1级：+0.09等级
- SSR 3级：+0.108等级
- SR 5级：+0.075等级
- R 8级：+0.048等级
- N 10级：+0.03等级
```

**每个BOSS满级（22个遗宝）**：
```
全属性倍率：约 ×12倍（10^1.08）
爬塔掉率：约 ×12倍
刷丹倍率：约 ×12倍
装备等级：约 +3等级（线性累加）
秘宝等级：约 +3等级（线性累加）
```

**全部5个BOSS满级（110个遗宝）**：
```
全属性倍率：约 ×24.8万倍（10^5.4，遗宝相乘）
爬塔掉率：约 ×1.58亿倍（10^8.2，遗宝相乘）
刷丹倍率：约 ×2.5亿倍（10^8.4，遗宝相乘）
装备等级：约 +15等级（线性累加）
秘宝等级：约 +15等级（线性累加）
```

**设计说明**：
- **乘算属性**：指数级成长，遗宝之间相乘，效果爆炸（数十万~数亿倍）
- **加算属性**：线性成长，遗宝之间累加，刻意控制（仅+15等级）
  - +15装备等级 ≈ 1.2^15 ≈ ×15属性（可接受范围）
  - +15秘宝等级：秘宝本身指数成长，效果已很可观
- 与境界、法则、秘宝等系统形成互补

---

## 💰 商业化方案

### 付费点设计

#### 1. 深渊挑战券（便捷类）
```
道具：深渊挑战券
功能：无视复活时间，立即挑战指定BOSS
价格：
- 魔龙挑战券：6元/张
- 魔王挑战券：12元/张
- 巨兽挑战券：18元/张
- 邪神挑战券：30元/张
- 主宰挑战券：68元/张

打包优惠：
- 挑战礼包（含5种各1张）：98元（原价134元，7.3折）
```

#### 2. 遗宝碎片礼包（加速类）
```
道具：深渊精华
功能：直接获得遗宝碎片
价格：
- 小份（100碎片）：30元
- 中份（300碎片）：88元
- 大份（1000碎片）：288元

道具：遗宝定向符
功能：使用后下一次掉落必定为指定品质（不低于当前）
价格：128元/个
限制：每周限购1个
```

#### 3. 深渊月卡（订阅类）
```
深渊探索卡 - 68元/月
权益：
- 每日领取挑战券×1（随机BOSS）
- 复活时间减少50%
- 遗宝掉落时20%概率额外+1级
- 碎片获取量+50%
- 深渊商店9折
- 专属深渊头像框
```

#### 4. 限时礼包
```
新手深渊礼包（N50解锁，限时7天）：
- 价格：30元
- 内容：
  - 魔龙挑战券×5
  - 深渊精华（100碎片）
  - 法则真意×1000

深渊征服者礼包：
- 价格：198元
- 内容：
  - 各BOSS挑战券×3
  - 深渊精华（300碎片）
  - 遗宝定向符×1
  - 专属称号"深渊行者"
```

### 免费获取途径
```
挑战券获取：
- 每日任务：1张（随机BOSS）
- 周常任务：3张（可自选BOSS）
- 境界突破：每突破一个大境界送5张

碎片获取：
- 满级遗宝溢出自动分解
- 活动奖励
- 成就系统
```

---

## 📊 数值平衡

### 与现有系统的对比

| 系统 | 加成类型 | 满级加成 | 获取速度 | 特点 |
|-----|---------|----------|---------|-----|
| 境界 | 乘法×1.05/级 | ×~200（100级） | 随难度自然提升 | 基础成长 |
| 秘宝 | 乘法10^(val×Lv/10) | ×1e90（6件） | 每日限制20次 | 中期核心 |
| 法则 | 乘法×1.1/步 | ×1e50（500轮） | 消耗真意 | 中期核心 |
| 百草 | 转化为法则 | 间接 | 时间积累 | 辅助产出 |
| **深渊遗宝** | **混合计算** | **×~25万 / +15等级** | **长期收集** | **后期核心** |

> 深渊遗宝内部区分：
> - 全属性/爬塔/刷丹：乘算，满收集 ×25万倍
> - 装备/秘宝等级：加算，满收集 +15等级

### 数值验证

**遗宝系统设计目标**：
- 每个遗宝提供指数级成长，升级收益巨大
- 遗宝之间**独立相乘**，满收集可达数十万倍提升
- 与境界、法则、秘宝等系统形成互补，各有侧重
- 鼓励长期收集和战略性升级

**收集周期预估**：
```
每个BOSS：
- 首次收集：~30次挑战（2-3周）
- 全部满级：~150次挑战（2-3个月）

全部5个BOSS：
- 首次收集：~150次挑战（3-4个月）
- 全部满级：~750次挑战（12-18个月）

碎片兑换可加速约30%
```

---

## 🔄 与现有系统的联动

### 材料联动
```
遗宝碎片获取：
- 满级遗宝溢出自动分解
- 活动奖励、成就系统
- 与装备分解、秘宝分解形成资源循环
```

### 系统解锁
```
解锁条件：
- 主线难度达到N50自动解锁第一个BOSS
- 每提升100-200难度解锁新BOSS
- 与境界突破进度大致匹配
```

### 数值协同
```
全属性倍率 → 影响所有战斗属性
爬塔掉率 → 加速法则修炼
刷丹倍率 → 加速基础属性成长
装备等级 → 提升装备品质
秘宝等级 → 提升秘宝品质
```

---

## 📈 运营数据预期

### 参与度指标
| 指标 | 预期值 | 说明 |
|-----|-------|------|
| N50+玩家参与率 | >80% | 核心养成系统 |
| 每日挑战次数 | 3-5次 | 受复活时间限制 |
| 月卡购买率 | 15-25% | 深渊月卡吸引力 |
| 满收集周期 | 12-18个月 | 超长期目标 |

### 收入预估
```
假设DAU 10,000，其中N50+玩家 3,000人：

深渊月卡：3000 × 20% × 68元 = 40,800元/月
挑战券：3000 × 10% × 30元 = 9,000元/月
碎片礼包：3000 × 5% × 88元 = 13,200元/月

月收入预估：约6.3万元
占整体收入预估：10-15%
```

---

## ✅ 验收标准

### 功能验收
- [ ] 5个深渊BOSS正常解锁和挑战
- [ ] BOSS复活倒计时正常工作
- [ ] 数值压缩逻辑正确应用
- [ ] 遗宝掉落、升级、溢出正确
- [ ] 碎片兑换功能正常
- [ ] 属性加成正确计算并应用
- [ ] 图鉴展示所有遗宝及等级

### 数值验收
- [ ] BOSS战斗时间符合预期（刚解锁40-60秒）
- [ ] 玩家变强后击杀时间显著缩短
- [ ] 遗宝升级数值计算正确
- [ ] 满收集加成在合理范围内
- [ ] 商业化道具定价合理

### 体验验收
- [ ] 挑战有策略性（选择BOSS）
- [ ] 收集升级有成就感
- [ ] UI清晰展示进度和加成
- [ ] 付费有明确价值感

---

## 📝 更新日志

| 版本 | 日期 | 变更内容 |
|-----|------|---------|
| v1.0 | 2026-02-14 | 初始版本，基础系统实现 |
| v2.0 | 2026-02-14 | 重构：新增遗宝等级系统、碎片兑换、5大系统属性 |
| v2.1 | 2026-02-14 | 重构BOSS数值：改为固定预期属性设计，目标击杀时间40-60秒 |
| v3.0 | 2026-02-14 | **数值系统重构**：改为指数级独立相乘机制<br>• 每个遗宝：10^(基础指数×品质×等级)<br>• 遗宝之间：独立相乘<br>• 满收集：单BOSS约×12倍，5BOSS约×25万倍 |
