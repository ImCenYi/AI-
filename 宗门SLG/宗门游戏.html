<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é“å¤©ï¼šå®—é—¨å´›èµ· - æœ¬åœ°ç‰ˆ</title>
    <!-- 1. å¼•å…¥ Tailwind CSS (è´Ÿè´£æ¼‚äº®çš„ç•Œé¢) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 2. å¼•å…¥ React å’Œ ReactDOM (è´Ÿè´£æ¸¸æˆé€»è¾‘) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- 3. å¼•å…¥ Babel (è´Ÿè´£æŠŠä»£ç ç¿»è¯‘ç»™æµè§ˆå™¨çœ‹) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        /* è‡ªå®šä¹‰æ»šåŠ¨æ¡æ ·å¼ */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #1e293b; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #475569; }
        body { background-color: #0f172a; color: #f1f5f9; }
    </style>
</head>
<body>
    <div id="root"></div>

    <!-- 4. æ¸¸æˆä»£ç åŒºåŸŸ -->
    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- ç®€å•çš„å›¾æ ‡ç»„ä»¶ (ç”¨ Emoji ä»£æ›¿) ---
        const Pickaxe = () => <span className="mr-1">â›ï¸</span>;
        const Scroll = () => <span className="mr-1">ğŸ“œ</span>;
        const Users = () => <span className="mr-1">ğŸ‘¥</span>;
        const Building2 = () => <span className="mr-1">ğŸ›–</span>;
        const Sword = () => <span className="mr-1">âš”ï¸</span>;
        const Leaf = () => <span className="mr-1">ğŸŒ¿</span>;
        const Hammer = () => <span className="mr-1">ğŸ”¨</span>;
        const Zap = () => <span className="mr-1">âš¡</span>;
        const Coins = () => <span className="mr-1">ğŸ’°</span>;
        const Globe = () => <span className="mr-1">ğŸŒ</span>;
        const Mountain = () => <span className="mr-1">ğŸ”ï¸</span>;
        const ArrowUpCircle = () => <span className="mr-1">â¬†ï¸</span>;
        const Activity = () => <span className="mr-1">ğŸ§ </span>;
        const Box = () => <span className="mr-1">ğŸ“¦</span>;

        // --- æ¸¸æˆå¸¸é‡ ---
        const REALMS = [
            { name: 'å‡¡äºº', multiplier: 1, maxQi: 100 },
            { name: 'ç»ƒæ°”', multiplier: 2, maxQi: 1000 },
            { name: 'ç­‘åŸº', multiplier: 5, maxQi: 5000 },
            { name: 'é‡‘ä¸¹', multiplier: 12, maxQi: 20000 },
            { name: 'å…ƒå©´', multiplier: 30, maxQi: 100000 },
            { name: 'åŒ–ç¥', multiplier: 100, maxQi: 1000000 },
        ];

        const RESOURCES = {
            spiritStones: { name: 'çµçŸ³', icon: <Coins />, desc: 'é€šç”¨è´§å¸ï¼Œè•´å«çµæ°”' },
            wood: { name: 'çµæœ¨', icon: <Building2 />, desc: 'åŸºç¡€å»ºç­‘ææ–™' },
            herbs: { name: 'çµè‰', icon: <Leaf />, desc: 'ç‚¼ä¸¹åŸææ–™' },
            iron: { name: 'ç„é“', icon: <Hammer />, desc: 'é«˜çº§å»ºç­‘ä¸æ³•å®ææ–™' },
            pills: { name: 'èšæ°”ä¸¹', icon: <Zap />, desc: 'æå‡ä¿®ä¸ºçš„å…³é”®ä¸¹è¯' },
        };

        const BUILDINGS = [
            { id: 'dwelling', name: 'å¼Ÿå­ç²¾èˆ', cost: { wood: 50 }, desc: 'å¢åŠ 5åæœ€å¤§äººå£å®¹é‡', effect: (state) => ({ maxPop: 5 }) },
            { id: 'spiritField', name: 'çµç”°', cost: { wood: 100, spiritStones: 50 }, desc: 'ç§æ¤çµè‰ï¼Œéœ€å¼Ÿå­ç…§æ–™', job: 'farmer' },
            { id: 'lumberYard', name: 'ä¼æœ¨åœº', cost: { spiritStones: 30 }, desc: 'è‡ªåŠ¨ç ä¼çµæœ¨', job: 'lumberjack' },
            { id: 'mine', name: 'ç„é“çŸ¿æ´', cost: { wood: 200, spiritStones: 100 }, desc: 'å¼€é‡‡ç„é“', job: 'miner' },
            { id: 'alchemyLab', name: 'ç‚¼ä¸¹é˜', cost: { wood: 300, iron: 50 }, desc: 'æ¶ˆè€—çµè‰ç‚¼åˆ¶èšæ°”ä¸¹', job: 'alchemist' },
            { id: 'library', name: 'è—ç»é˜', cost: { wood: 500, iron: 100 }, desc: 'äº§ç”Ÿæ‚Ÿæ€§ï¼Œç”¨äºç ”ç©¶ç§‘æŠ€', job: 'scholar' },
        ];

        const TECHS = [
            { id: 'basic_array', name: 'èšçµé˜µæ³•', cost: 100, desc: 'çµçŸ³è·å–æ•ˆç‡ +20%' },
            { id: 'advanced_farming', name: 'çµæ¤åŸ¹è‚²', cost: 250, desc: 'çµç”°äº§å‡º +50%' },
            { id: 'sword_flying', name: 'å¾¡å‰‘æœ¯', cost: 500, desc: 'è§£é”å¤–äº¤ä¸æ¢ç´¢åŠŸèƒ½' },
            { id: 'alchemy_mastery', name: 'ä¸¹é“ç²¾é€š', cost: 1000, desc: 'ç‚¼ä¸¹æ•ˆç‡ç¿»å€' },
        ];

        const NEIGHBORS = [
            { id: 1, name: 'é’äº‘é—¨', align: 'æ­£é“', attitude: 50, desc: 'ä¼ ç»Ÿæ­£é“å¤§å®—ï¼Œç”±äºä½ æ˜¯æ–°ç§€ï¼Œå¯¹ä½ æŒè§‚æœ›æ€åº¦ã€‚' },
            { id: 2, name: 'è¡€ç…æ•™', align: 'é­”é“', attitude: -30, desc: 'è¡Œäº‹è¯¡ç§˜ï¼Œç»å¸¸è§Šè§ä½ çš„èµ„æºã€‚' },
            { id: 3, name: 'ä¸‡å®æ¥¼', align: 'ä¸­ç«‹', attitude: 100, desc: 'å”¯åˆ©æ˜¯å›¾çš„å•†ä¸šç»„ç»‡ã€‚' },
        ];

        // --- ä¸»ç¨‹åº ---
        function DaoistSkylines() {
            const [activeTab, setActiveTab] = useState('sect');
            const [logs, setLogs] = useState([{ text: "å®—é—¨åˆç«‹ï¼Œç™¾åºŸå¾…å…´ã€‚æŒé—¨è¯·å¼€å§‹ä¿®ç‚¼ã€‚", type: 'info', id: 0 }]);
            
            // æ¸¸æˆçŠ¶æ€
            const [res, setRes] = useState({ spiritStones: 0, wood: 0, herbs: 0, iron: 0, pills: 0, insight: 0 });
            const [pop, setPop] = useState({ total: 1, assigned: {}, idle: 1, realmIdx: 0, qi: 0 }); 
            const [buildings, setBuildings] = useState({ dwelling: 1, spiritField: 0, lumberYard: 0, mine: 0, alchemyLab: 0, library: 0 });
            const [jobs, setJobs] = useState({ farmer: 0, lumberjack: 0, miner: 0, alchemist: 0, scholar: 0 });
            const [techs, setTechs] = useState([]);

            const maxPop = 5 + (buildings.dwelling * 5);
            const currentRealm = REALMS[pop.realmIdx];
            const nextRealm = REALMS[pop.realmIdx + 1];

            const addLog = (text, type = 'info') => {
                setLogs(prev => [{ text, type, id: Date.now() + Math.random() }, ...prev].slice(0, 20));
            };

            const formatNumber = (num) => Math.floor(num).toLocaleString();

            // æ¸¸æˆå¾ªç¯ (æ¯ç§’)
            useEffect(() => {
                const tick = setInterval(() => {
                setRes(prev => {
                    const newRes = { ...prev };
                    
                    // 1. åŸºç¡€äº§å‡º (æŒé—¨)
                    let stoneGain = 1 * currentRealm.multiplier;
                    if (techs.includes('basic_array')) stoneGain *= 1.2;
                    newRes.spiritStones += stoneGain;

                    // 2. èŒä¸šäº§å‡º
                    newRes.wood += jobs.lumberjack * 2;
                    
                    let herbGain = jobs.farmer * 1.5;
                    if (techs.includes('advanced_farming')) herbGain *= 1.5;
                    newRes.herbs += herbGain;

                    newRes.iron += jobs.miner * 0.8;
                    newRes.insight += jobs.scholar * 1;

                    // ç‚¼ä¸¹æ¶ˆè€—
                    if (jobs.alchemist > 0) {
                        const herbCost = jobs.alchemist * 5;
                        let pillProd = jobs.alchemist * 1;
                        if (techs.includes('alchemy_mastery')) pillProd *= 2;

                        if (newRes.herbs >= herbCost) {
                            newRes.herbs -= herbCost;
                            newRes.pills += pillProd;
                        }
                    }
                    return newRes;
                });

                // 3. ä¿®ç‚¼
                setPop(prevP => {
                    if (!nextRealm) return prevP;
                    let cultivationSpeed = 5 * (buildings.dwelling * 0.1 + 1); 
                    let newQi = prevP.qi + cultivationSpeed;
                    if (newQi > currentRealm.maxQi) newQi = currentRealm.maxQi;
                    return { ...prevP, qi: newQi };
                });

                }, 1000);
                return () => clearInterval(tick);
            }, [jobs, buildings, currentRealm, techs, nextRealm]);

            // --- äº¤äº’å‡½æ•° ---
            const handleManualGather = () => {
                setRes(prev => ({ ...prev, spiritStones: prev.spiritStones + 10 }));
                addLog("æŒé—¨äº²è‡ªä¸‹å±±åŒ–ç¼˜ï¼Œè·å¾— 10 çµçŸ³ã€‚", 'success');
            };

            const handleBuild = (bId) => {
                const b = BUILDINGS.find(x => x.id === bId);
                if (!b) return;
                for (const [key, val] of Object.entries(b.cost)) {
                    if (res[key] < val) {
                        addLog(`èµ„æºä¸è¶³ï¼šç¼ºå°‘ ${RESOURCES[key]?.name || key}`, 'error');
                        return;
                    }
                }
                const newRes = { ...res };
                for (const [key, val] of Object.entries(b.cost)) {
                    newRes[key] -= val;
                }
                setRes(newRes);
                setBuildings(prev => ({ ...prev, [bId]: prev[bId] + 1 }));
                addLog(`å»ºé€ äº† ${b.name}`, 'success');
            };

            const handleRecruit = () => {
                if (res.spiritStones < 50) {
                    addLog("æ‹›å‹Ÿå‡¡äººå¼Ÿå­éœ€è¦ 50 çµçŸ³ä½œä¸ºå®‰å®¶è´¹ã€‚", 'error');
                    return;
                }
                if (pop.total >= maxPop) {
                    addLog("å®—é—¨ä½æˆ¿ä¸è¶³ï¼Œè¯·å‡çº§å¼Ÿå­ç²¾èˆã€‚", 'error');
                    return;
                }
                setRes(prev => ({ ...prev, spiritStones: prev.spiritStones - 50 }));
                setPop(prev => ({ ...prev, total: prev.total + 1, idle: prev.idle + 1 }));
                addLog("ä¸€åå‡¡äººä»°æ…•å®—é—¨å¨åï¼Œæ‹œå…¥å±±é—¨ã€‚", 'success');
            };

            const assignJob = (jobId, delta) => {
                setJobs(prev => {
                    const current = prev[jobId];
                    if (delta > 0) {
                        if (pop.idle > 0) {
                            setPop(p => ({ ...p, idle: p.idle - 1 }));
                            return { ...prev, [jobId]: current + 1 };
                        }
                    } else {
                        if (current > 0) {
                            setPop(p => ({ ...p, idle: p.idle + 1 }));
                            return { ...prev, [jobId]: current - 1 };
                        }
                    }
                    return prev;
                });
            };

            const handleBreakthrough = () => {
                if (!nextRealm) return;
                if (pop.qi < currentRealm.maxQi) {
                    addLog("ä¿®ä¸ºæœªæ»¡ï¼Œæ— æ³•çªç ´ã€‚", 'error');
                    return;
                }
                const pillCost = (pop.realmIdx + 1) * 50;
                if (res.pills < pillCost) {
                    addLog(`çªç ´éœ€è¦ ${pillCost} æšèšæ°”ä¸¹æŠ¤ä½“ã€‚`, 'error');
                    return;
                }
                setRes(prev => ({ ...prev, pills: prev.pills - pillCost }));
                setPop(prev => ({ ...prev, realmIdx: prev.realmIdx + 1, qi: 0 }));
                addLog(`å¤©é™ç¥¥ç‘ï¼æŒé—¨æˆåŠŸçªç ´è‡³ [${nextRealm.name}] å¢ƒç•Œï¼`, 'gold');
            };

            const handleResearch = (techId) => {
                const tech = TECHS.find(t => t.id === techId);
                if (res.insight >= tech.cost) {
                    setRes(prev => ({ ...prev, insight: prev.insight - tech.cost }));
                    setTechs(prev => [...prev, techId]);
                    addLog(`æˆåŠŸç ”ä¹ ç§˜æ³•ï¼š${tech.name}`, 'success');
                } else {
                    addLog("æ‚Ÿæ€§ä¸è¶³ï¼Œæ— æ³•å‚é€æ­¤æ³•ã€‚", 'error');
                }
            };

            const handleDiplomacy = (neighbor, action) => {
                if (action === 'trade') {
                    if (res.spiritStones >= 100) {
                        setRes(prev => ({ ...prev, spiritStones: prev.spiritStones - 100, wood: prev.wood + 50, iron: prev.iron + 20 }));
                        addLog(`ä¸ ${neighbor.name} è´¸æ˜“æˆåŠŸã€‚`, 'success');
                    } else {
                        addLog("çµçŸ³ä¸è¶³ã€‚", 'error');
                    }
                } else if (action === 'tribute') {
                    if (res.pills >= 10) {
                        setRes(prev => ({...prev, pills: prev.pills - 10}));
                        addLog(`å‘ ${neighbor.name} è¿›è´¡äº†ä¸¹è¯ã€‚`, 'info');
                    } else {
                        addLog("ä¸¹è¯ä¸è¶³ã€‚", 'error');
                    }
                }
            };

            const ProgressBar = ({ current, max, color = 'bg-blue-500' }) => (
                <div className="w-full bg-slate-700 h-2 rounded-full mt-1 overflow-hidden">
                    <div className={`h-full ${color} transition-all duration-500`} style={{ width: `${Math.min(100, (current / max) * 100)}%` }} />
                </div>
            );

            // --- ç•Œé¢æ¸²æŸ“ ---
            return (
                <div className="min-h-screen bg-slate-900 text-slate-100 font-sans selection:bg-emerald-500/30 pb-10">
                    {/* å¤´éƒ¨ */}
                    <header className="bg-slate-800 border-b border-slate-700 p-4 sticky top-0 z-10 shadow-lg">
                        <div className="max-w-6xl mx-auto flex flex-col md:flex-row justify-between items-center gap-4">
                            <div className="flex items-center gap-3">
                                <div className="w-10 h-10 rounded bg-emerald-600 flex items-center justify-center text-xl font-bold border border-emerald-400">é“</div>
                                <div>
                                    <h1 className="text-xl font-bold text-emerald-100">é“å¤©ï¼šå®—é—¨å´›èµ·</h1>
                                    <p className="text-xs text-slate-400">ä¿®ä»™çºªå…ƒï¼š{Math.floor(Date.now() / 10000) % 10000} å¹´</p>
                                </div>
                            </div>
                            <div className="flex gap-4 text-sm font-medium flex-wrap justify-center">
                                <span className="bg-slate-700 px-2 py-1 rounded border border-slate-600 text-emerald-400">å¢ƒç•Œ: {currentRealm.name}</span>
                                <span className="flex items-center gap-1 text-amber-400"><Coins /> {formatNumber(res.spiritStones)}</span>
                                <span className="flex items-center gap-1 text-purple-400"><Activity /> æ‚Ÿæ€§: {formatNumber(res.insight)}</span>
                                <span className="flex items-center gap-1 text-blue-400"><Users /> {pop.total} / {maxPop} äºº</span>
                            </div>
                        </div>
                    </header>

                    <main className="max-w-6xl mx-auto p-4 grid grid-cols-1 lg:grid-cols-4 gap-6 mt-4">
                        {/* ä¾§è¾¹æ  */}
                        <aside className="lg:col-span-1 space-y-4">
                            <nav className="bg-slate-800 rounded-lg p-2 border border-slate-700 shadow-sm flex flex-col gap-1">
                                {[
                                    { id: 'sect', icon: <Mountain />, label: 'å®—é—¨å¤§æ®¿' },
                                    { id: 'resources', icon: <Pickaxe />, label: 'èµ„æºä¸åŠ³åŠ›' },
                                    { id: 'build', icon: <Hammer />, label: 'è¥é€ å»ºè®¾' },
                                    { id: 'tech', icon: <Scroll />, label: 'è—ç»é˜ (ç§‘æŠ€)' },
                                    { id: 'world', icon: <Globe />, label: 'å¤©ä¸‹å¤§åŠ¿' },
                                ].map(tab => (
                                    <button
                                        key={tab.id}
                                        onClick={() => setActiveTab(tab.id)}
                                        className={`flex items-center gap-3 px-4 py-3 rounded-md transition-all ${
                                            activeTab === tab.id ? 'bg-emerald-900/50 text-emerald-300 border border-emerald-800' : 'hover:bg-slate-700 text-slate-300'
                                        }`}
                                    >
                                        {tab.icon} {tab.label}
                                    </button>
                                ))}
                            </nav>

                            <div className="bg-slate-800 p-4 rounded-lg border border-emerald-900/50 shadow-inner relative overflow-hidden group">
                                <h3 className="font-bold text-emerald-300 mb-2 flex items-center gap-2">æŒé—¨ä¿®ç‚¼</h3>
                                {nextRealm ? (
                                    <div className="space-y-2">
                                        <div className="flex justify-between text-xs text-slate-400">
                                            <span>{currentRealm.name}</span>
                                            <span>{nextRealm.name}</span>
                                        </div>
                                        <ProgressBar current={pop.qi} max={currentRealm.maxQi} color="bg-emerald-500" />
                                        <div className="text-center text-xs mt-1 text-slate-400">çµæ°”: {Math.floor(pop.qi)} / {currentRealm.maxQi}</div>
                                        <button onClick={handleBreakthrough} className={`w-full mt-3 py-2 text-sm font-bold rounded shadow-lg transition-all border ${pop.qi >= currentRealm.maxQi ? 'bg-amber-600 hover:bg-amber-500 text-white border-amber-400 animate-pulse' : 'bg-slate-700 text-slate-500 border-slate-600 cursor-not-allowed'}`}>
                                            {pop.qi >= currentRealm.maxQi ? 'é€†å¤©æ”¹å‘½ (çªç ´)' : 'ç§¯è“„çµæ°”ä¸­...'}
                                        </button>
                                    </div>
                                ) : (
                                    <div className="text-center text-amber-500 font-bold py-4">å·²è‡»åŒ–å¢ƒ</div>
                                )}
                            </div>
                            
                            <div className="bg-slate-800 p-3 rounded-lg border border-slate-700 h-64 overflow-y-auto text-sm space-y-2 font-mono">
                                {logs.map(log => (
                                    <div key={log.id} className={`pb-1 border-b border-slate-700/50 ${log.type === 'error' ? 'text-red-400' : log.type === 'success' ? 'text-emerald-400' : log.type === 'gold' ? 'text-amber-300 font-bold' : 'text-slate-300'}`}>
                                        <span className="opacity-50 text-xs">[{new Date(log.id).toLocaleTimeString().split(' ')[0]}]</span> {log.text}
                                    </div>
                                ))}
                            </div>
                        </aside>

                        {/* ä¸»å†…å®¹åŒº */}
                        <div className="lg:col-span-3 bg-slate-800/50 rounded-lg border border-slate-700 p-6 min-h-[600px]">
                            {activeTab === 'sect' && (
                                <div className="space-y-6">
                                    <div className="flex justify-between items-center mb-6">
                                        <h2 className="text-2xl font-bold text-white">å®—é—¨æ¦‚è§ˆ</h2>
                                        <button onClick={handleManualGather} className="bg-emerald-700 hover:bg-emerald-600 text-white px-6 py-2 rounded-full shadow-lg font-bold transition flex items-center gap-2 border border-emerald-500">
                                            <Pickaxe /> ä¸‹å±±åŒ–ç¼˜ (æ‰‹åŠ¨)
                                        </button>
                                    </div>
                                    <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                                        {Object.entries(RESOURCES).map(([key, info]) => (
                                            <div key={key} className="bg-slate-800 p-4 rounded border border-slate-700 flex flex-col items-center justify-center gap-2 hover:border-emerald-500 transition">
                                                <div className="text-emerald-400 text-xl">{info.icon}</div>
                                                <div className="text-2xl font-mono">{formatNumber(res[key])}</div>
                                                <div className="text-xs text-slate-400">{info.name}</div>
                                            </div>
                                        ))}
                                    </div>
                                     <div className="bg-slate-800 p-6 rounded-lg border border-slate-700">
                                        <h3 className="font-bold mb-4 flex items-center gap-2"><Scroll /> å®—é—¨ç®´è¨€</h3>
                                        <p className="text-slate-300 leading-relaxed italic border-l-4 border-emerald-500 pl-4">
                                        "ä¿®ä»™ä¹‹è·¯ï¼Œè´¢ä¾£æ³•åœ°ã€‚ä»Šæˆ‘å®—é—¨æ®æ­¤çµå±±ï¼Œå½“å¼€è’ç§ç”°ï¼Œç‚¼ä¸¹é“¸å™¨ã€‚å¹¿ç§¯ç²®ï¼Œé«˜ç­‘å¢™ï¼Œç¼“ç§°ç‹ã€‚å¾…åˆ°å…ƒå©´å¤§æˆæ—¥ï¼Œæ–¹æ˜¯é€é¥è‡ªåœ¨æ—¶ã€‚"
                                        </p>
                                    </div>
                                </div>
                            )}

                            {activeTab === 'resources' && (
                                <div className="space-y-6">
                                    <div className="flex justify-between items-center">
                                        <h2 className="text-2xl font-bold">èµ„æºä¸åŠ³åŠ›</h2>
                                        <div className="bg-slate-700 px-4 py-2 rounded-full text-sm">
                                            é—²ç½®å¼Ÿå­: <span className="text-emerald-400 font-bold text-lg">{pop.idle}</span> äºº
                                            <button onClick={handleRecruit} className="ml-4 bg-blue-600 hover:bg-blue-500 px-3 py-1 rounded text-xs text-white">æ‹›å‹Ÿ (+1)</button>
                                        </div>
                                    </div>
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        {[
                                            { id: 'lumberjack', name: 'ä¼æœ¨æ‚å½¹', buildReq: 'lumberYard', out: 'çµæœ¨', icon: <Building2 /> },
                                            { id: 'farmer', name: 'çµæ¤å¤«', buildReq: 'spiritField', out: 'çµè‰', icon: <Leaf /> },
                                            { id: 'miner', name: 'çŸ¿å·¥', buildReq: 'mine', out: 'ç„é“', icon: <Hammer /> },
                                            { id: 'alchemist', name: 'ç‚¼ä¸¹å¸ˆ', buildReq: 'alchemyLab', out: 'èšæ°”ä¸¹', icon: <Zap /> },
                                            { id: 'scholar', name: 'ç»æ¥¼å­¦å£«', buildReq: 'library', out: 'æ‚Ÿæ€§', icon: <Scroll /> },
                                        ].map(job => (
                                            <div key={job.id} className={`p-4 rounded border ${buildings[job.buildReq] > 0 ? 'bg-slate-800 border-slate-600' : 'bg-slate-800/50 border-slate-800 opacity-60'}`}>
                                                <div className="flex justify-between items-start mb-2">
                                                    <div className="flex items-center gap-2"><span className="text-emerald-400">{job.icon}</span><h3 className="font-bold">{job.name}</h3></div>
                                                    <span className="text-xs bg-slate-900 px-2 py-1 rounded text-slate-400">äº§å‡º: {job.out}</span>
                                                </div>
                                                {buildings[job.buildReq] > 0 ? (
                                                    <div className="flex items-center justify-between mt-4 bg-slate-900 p-2 rounded">
                                                        <button onClick={() => assignJob(job.id, -1)} className="w-8 h-8 bg-slate-700 hover:bg-slate-600 rounded text-xl">-</button>
                                                        <span className="font-mono text-xl text-white w-12 text-center">{jobs[job.id]}</span>
                                                        <button onClick={() => assignJob(job.id, 1)} className="w-8 h-8 bg-emerald-700 hover:bg-emerald-600 rounded text-xl">+</button>
                                                    </div>
                                                ) : (
                                                    <div className="text-xs text-red-400 mt-2">éœ€å…ˆå»ºé€ : {BUILDINGS.find(b=>b.id === job.buildReq)?.name}</div>
                                                )}
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            )}

                            {activeTab === 'build' && (
                                <div className="space-y-6">
                                    <h2 className="text-2xl font-bold">å®—é—¨è¥é€ </h2>
                                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                        {BUILDINGS.map(b => (
                                            <div key={b.id} className="bg-slate-800 p-4 rounded-lg border border-slate-600 flex flex-col justify-between">
                                                <div>
                                                    <div className="flex justify-between items-center mb-2">
                                                        <h3 className="font-bold text-lg">{b.name}</h3>
                                                        <span className="text-sm bg-slate-900 px-2 py-1 rounded text-emerald-400">æ‹¥æœ‰: {buildings[b.id]}</span>
                                                    </div>
                                                    <p className="text-xs text-slate-400 mb-4 h-8">{b.desc}</p>
                                                    <div className="space-y-1 mb-4">
                                                        {Object.entries(b.cost).map(([resName, amt]) => (
                                                            <div key={resName} className={`text-xs flex justify-between ${res[resName] >= amt ? 'text-slate-300' : 'text-red-400'}`}>
                                                                <span>{RESOURCES[resName]?.name || resName}</span><span>{amt}</span>
                                                            </div>
                                                        ))}
                                                    </div>
                                                </div>
                                                <button onClick={() => handleBuild(b.id)} className="w-full py-2 bg-slate-700 hover:bg-emerald-700 hover:text-white rounded border border-slate-600 transition-colors flex items-center justify-center gap-2">
                                                    <Hammer /> å»ºé€ 
                                                </button>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            )}

                            {activeTab === 'tech' && (
                                <div className="space-y-6">
                                    <div className="flex justify-between"><h2 className="text-2xl font-bold">è—ç»é˜</h2><div className="text-purple-400 flex items-center gap-2"><Activity /> å‰©ä½™æ‚Ÿæ€§: {formatNumber(res.insight)}</div></div>
                                    <div className="space-y-4">
                                        {TECHS.map(tech => {
                                            const isResearched = techs.includes(tech.id);
                                            const canAfford = res.insight >= tech.cost;
                                            return (
                                                <div key={tech.id} className={`p-5 rounded-lg border flex items-center justify-between ${isResearched ? 'bg-emerald-900/20 border-emerald-800' : 'bg-slate-800 border-slate-600'}`}>
                                                    <div>
                                                        <h3 className={`font-bold text-lg ${isResearched ? 'text-emerald-400' : 'text-slate-200'}`}>{tech.name}</h3>
                                                        <p className="text-sm text-slate-400">{tech.desc}</p>
                                                    </div>
                                                    {isResearched ? (
                                                        <div className="px-4 py-2 bg-emerald-900/50 text-emerald-400 rounded text-sm font-bold border border-emerald-800">å·²ç ”ä¹ </div>
                                                    ) : (
                                                        <button onClick={() => handleResearch(tech.id)} disabled={!canAfford} className={`px-6 py-2 rounded text-sm font-bold transition ${canAfford ? 'bg-purple-700 hover:bg-purple-600 text-white shadow-lg' : 'bg-slate-700 text-slate-500 cursor-not-allowed'}`}>
                                                            ç ”ä¹  (-{tech.cost} æ‚Ÿæ€§)
                                                        </button>
                                                    )}
                                                </div>
                                            );
                                        })}
                                    </div>
                                </div>
                            )}

                            {activeTab === 'world' && (
                                <div className="space-y-6">
                                    <h2 className="text-2xl font-bold">å¤©ä¸‹å¤§åŠ¿</h2>
                                    {!techs.includes('sword_flying') ? (
                                        <div className="h-64 flex flex-col items-center justify-center bg-slate-900/50 rounded border border-slate-700 border-dashed text-slate-500">
                                            <Sword />
                                            <p className="mt-2">å®—é—¨å°šæœªæŒæ¡ã€å¾¡å‰‘æœ¯ã€‘ï¼Œæ— æ³•é£å‡ºæŠ¤å±±å¤§é˜µã€‚</p>
                                        </div>
                                    ) : (
                                        <div className="grid grid-cols-1 gap-4">
                                            {NEIGHBORS.map(n => (
                                                <div key={n.id} className="bg-slate-800 p-5 rounded border-l-4 border-slate-600 flex flex-col md:flex-row justify-between gap-4" style={{ borderLeftColor: n.align === 'æ­£é“' ? '#10b981' : n.align === 'é­”é“' ? '#ef4444' : '#f59e0b' }}>
                                                    <div>
                                                        <div className="flex items-center gap-3 mb-1"><h3 className="font-bold text-lg">{n.name}</h3><span className="text-xs px-2 py-0.5 rounded bg-slate-900">{n.align}</span></div>
                                                        <p className="text-sm text-slate-400 mb-2">{n.desc}</p>
                                                        <div className="text-xs text-slate-500">å…³ç³»: {n.attitude}</div>
                                                    </div>
                                                    <div className="flex gap-2 items-center">
                                                        <button onClick={() => handleDiplomacy(n, 'trade')} className="px-4 py-2 bg-slate-700 hover:bg-blue-700 rounded text-sm transition">è´¸æ˜“ (-100çµçŸ³)</button>
                                                        <button onClick={() => handleDiplomacy(n, 'tribute')} className="px-4 py-2 bg-slate-700 hover:bg-emerald-700 rounded text-sm transition">è¿›è´¡ (-10ä¸¹è¯)</button>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    )}
                                </div>
                            )}
                        </div>
                    </main>
                </div>
            );
        }

        // æ¸²æŸ“åˆ°é¡µé¢
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<DaoistSkylines />);
    </script>
</body>
</html>