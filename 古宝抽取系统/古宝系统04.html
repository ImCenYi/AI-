<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Â§ßÂçÉÂÆùÂΩïÂè§ÂÆùÁ≥ªÁªü</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;700;900&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap');
        
        body {
            font-family: 'Noto Sans SC', sans-serif;
            background-color: #020617;
            color: #f1f5f9;
            overflow: hidden;
        }

        .font-mono {
            font-family: 'JetBrains Mono', monospace;
        }

        .custom-scrollbar::-webkit-scrollbar {
            width: 2px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: transparent;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: rgba(59, 130, 246, 0.2);
            border-radius: 10px;
        }

        .float-animation {
            animation: float 5s ease-in-out infinite;
        }
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-5px); }
            100% { transform: translateY(0px); }
        }
        
        .fade-in {
            animation: fadeIn 0.3s ease-out forwards;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* ÈúìËôπÊñáÂ≠óÊïàÊûú - Â¢ûÂº∫Áâà */
        .neon-text {
            text-shadow: 0 0 10px rgba(59, 130, 246, 0.6), 0 0 20px rgba(59, 130, 246, 0.4), 0 0 30px rgba(234, 179, 8, 0.2);
        }
    </style>
</head>
<body>
    <div id="app" class="min-h-screen flex items-center justify-center p-2 select-none">
        <!-- ‰∏ªÁïåÈù¢ÂÆπÂô® -->
        <div class="relative w-full max-w-6xl aspect-[16/9] bg-[#0f172a] border border-slate-700/30 rounded-2xl shadow-2xl flex overflow-hidden">
            
            <!-- 1. Â∑¶‰æßÈ°µÁ≠æÊ†è -->
            <div class="w-16 bg-[#020617]/70 border-r border-slate-800/50 flex flex-col items-center py-4 gap-4 z-20">
                <div class="w-10 h-10 rounded-full bg-blue-600/10 flex items-center justify-center text-blue-500 border border-blue-500/20">
                    <i data-lucide="layout-grid" size="18"></i>
                </div>
                <div class="flex-1 flex flex-col gap-3">
                    <button 
                        v-for="(items, tabName) in library" 
                        :key="tabName"
                        @click="activeTab = tabName; selectedId = null"
                        :class="['w-10 h-14 rounded-lg flex items-center justify-center transition-all border', activeTab === tabName ? 'bg-blue-600 text-white border-blue-400 shadow-lg' : 'text-slate-500 border-transparent hover:text-slate-300']"
                    >
                        <span class="text-[9px] font-black" style="writing-mode: vertical-rl;">{{ tabName.slice(0, 2) }}</span>
                    </button>
                </div>

                <!-- ÂÖ®Â±Ä‰∏ÄÈîÆÂçáÁ∫ßÊåâÈíÆ -->
                <button 
                    @click="handleGlobalQuickUpgrade"
                    class="w-10 h-10 rounded-lg bg-orange-600/20 border border-orange-500/40 text-orange-400 flex flex-col items-center justify-center hover:bg-orange-600/40 transition-all group"
                    title="‰∏ÄÈîÆÂçáÁ∫ßÊâÄÊúâÂè§ÂÆù"
                >
                    <i data-lucide="zap" size="14" class="group-hover:scale-110 transition-transform"></i>
                    <span class="text-[7px] font-bold mt-0.5">ALL</span>
                </button>
            </div>

            <!-- 2. ‰∏≠Èó¥ÂõæÈâ¥ÂàóË°® -->
            <div class="flex-1 bg-slate-900/10 p-4 overflow-y-auto custom-scrollbar relative z-10">
                <!-- È°∂ÈÉ®Êï∞ÂÄºÂ±ïÁ§∫Âå∫ -->
                <div class="mb-4 flex justify-between items-end px-1 border-b border-slate-800/50 pb-2">
                    <div>
                        <h2 class="text-base font-black tracking-[0.3em] bg-clip-text text-transparent bg-gradient-to-r from-white to-slate-400 uppercase">
                            ‰∏á ‰ª£ Âè§ ÂÆù Â∫ì
                        </h2>
                        <div class="flex items-baseline gap-2 mt-1">
                            <span class="text-[8px] text-slate-500 font-bold uppercase tracking-widest">Total Multiplier:</span>
                            <!-- ÊÄªÊàòÂäõÊòæÁ§∫ (Log10ÁßëÂ≠¶ËÆ°Êï∞Ê≥ï) -->
                            <span class="text-2xl font-black text-transparent bg-clip-text bg-gradient-to-r from-yellow-300 via-orange-400 to-red-500 neon-text font-mono tracking-tight">
                                √ó{{ formatLog10(totalLog10Power) }}
                            </span>
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="text-[7px] text-slate-600 font-bold uppercase tracking-widest">
                            Â∑≤Êî∂ÈõÜ: <span class="text-blue-400">{{ collectedCount }}</span> / {{ totalCount }}
                        </div>
                        <div class="text-[7px] text-slate-600 font-bold uppercase tracking-widest mt-0.5">
                           ÂΩìÂâçÁïåÂüü: √ó{{ formatLog10(tabLog10Power(activeTab)) }}
                        </div>
                    </div>
                </div>

                <!-- ÂàÜÂìÅË¥®Ê∏≤Êüì -->
                <div v-for="rank in ['UR', 'SSR', 'SR', 'R']" :key="rank" class="mb-5">
                    <div v-if="filteredLibrary(rank).length" class="flex items-center gap-2 mb-2">
                        <span :class="['text-[7px] font-black px-1 py-0.5 rounded text-white shadow-sm', rankColors[rank]]">{{ rank }}</span>
                        <span class="text-[7px] text-slate-600 font-mono scale-90 origin-left">
                            (ÊàêÈïøÁéá: {{ ((rankGrowth[rank] - 1) * 100).toFixed(0) }}%)
                        </span>
                        <div class="h-[1px] flex-1 bg-slate-800/30"></div>
                    </div>
                    
                    <div class="grid grid-cols-10 gap-x-2 gap-y-3">
                        <div 
                            v-for="item in filteredLibrary(rank)" 
                            :key="item.id"
                            @click="selectedId = item.id"
                            :class="['relative group cursor-pointer transition-all duration-300', selectedId === item.id ? 'scale-105 z-10' : 'hover:scale-105']"
                        >
                            <div :class="['relative aspect-square rounded-lg border transition-all p-1 overflow-hidden', 
                                selectedId === item.id ? 'border-blue-500 bg-blue-500/10 shadow-[0_0_10px_rgba(59,130,246,0.3)]' : 'border-slate-800/40 bg-slate-900/20 hover:border-slate-600',
                                !isUnlocked(item.id) ? 'grayscale opacity-25 hover:opacity-100 hover:grayscale-0' : '']">
                                
                                <div v-if="hasShards(item.id)" class="absolute top-0.5 right-0.5 w-1 h-1 bg-red-500 rounded-full z-20"></div>

                                <!-- Â∑¶‰∏äËßíÔºöÈáçÊï∞ -->
                                <div v-if="isUnlocked(item.id)" class="absolute top-0 left-0 px-1 py-0.5 bg-black/60 rounded-br-lg backdrop-blur-sm z-10 border-r border-b border-white/5">
                                    <span class="text-[9px] font-black text-blue-400 leading-none tracking-tighter shadow-black drop-shadow-md">
                                        {{ playerData[item.id].tier }}Èáç
                                    </span>
                                </div>

                                <!-- Âè≥‰∏ãËßíÔºöÁ≠âÁ∫ß -->
                                <div v-if="isUnlocked(item.id)" class="absolute bottom-0 right-0 px-1 py-0.5 z-10 bg-black/40 rounded-tl-lg backdrop-blur-[1px]">
                                    <span class="text-[8px] font-black text-white/90 font-mono italic">
                                        Lv.{{ getTotalLevel(item.id) }}
                                    </span>
                                </div>

                                <div class="w-full h-full flex items-center justify-center text-xl transition-transform group-hover:rotate-12">
                                    {{ item.icon }}
                                </div>

                                <div v-if="!isUnlocked(item.id) && hasShards(item.id)" class="absolute inset-0 flex items-center justify-center bg-blue-500/10">
                                    <div class="w-1.5 h-1.5 bg-blue-400 rounded-full animate-ping"></div>
                                </div>
                            </div>
                            <p :class="['text-center mt-1 text-[9px] font-black tracking-tighter truncate transition-colors leading-tight', selectedId === item.id ? 'text-blue-400 opacity-100' : 'text-slate-400 opacity-80 group-hover:text-slate-200']">
                                {{ item.name }}
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 3. Âè≥‰æßËØ¶ÊÉÖ/ÊäΩÂ•ñÈù¢Êùø -->
            <div class="w-64 bg-[#020617] border-l border-slate-800/50 flex flex-col z-20 shadow-[-10px_0_30px_rgba(0,0,0,0.5)]">
                <div v-if="!selectedId" class="flex-1 flex flex-col">
                    <div class="p-4 flex-1 flex flex-col">
                        <div class="flex-1 rounded-xl bg-gradient-to-b from-blue-900/10 to-transparent border border-blue-500/5 p-4 flex flex-col items-center justify-center text-center">
                            <div class="relative w-16 h-16 mb-4 float-animation">
                                <i data-lucide="sparkle" class="w-16 h-16 text-blue-600 opacity-10"></i>
                                <i data-lucide="box" class="absolute inset-0 m-auto w-6 h-6 text-blue-400 animate-pulse"></i>
                            </div>
                            <h3 class="text-sm font-black italic tracking-[0.4em] text-white mb-1 uppercase">Â§© ÂëΩ ÂØª ÂÆù</h3>
                            <p class="text-[7px] text-slate-500 leading-tight px-4 uppercase tracking-tighter mb-4">
                                Ê¶ÇÁéáÔºöUR 2% | SSR 8% | SR 30%
                            </p>
                            
                            <div class="px-2 py-0.5 bg-blue-500/5 border border-blue-500/10 rounded-full text-[7px] text-blue-400/80 font-bold uppercase tracking-widest">
                                UR Pity: {{ pityCount }}/40
                            </div>
                        </div>
                    </div>
                    
                    <div class="p-4 grid grid-cols-2 gap-2 bg-slate-900/10">
                        <button @click="handleDraw(1)" class="py-2.5 rounded-lg bg-slate-800/40 border border-slate-700 text-[8px] font-bold hover:bg-slate-700 transition-all uppercase">
                            ‰∏ÄÊ¨°
                        </button>
                        <button @click="handleDraw(10)" class="py-2.5 rounded-lg bg-blue-600 border border-blue-400 text-[8px] font-bold hover:bg-blue-500 transition-all shadow-lg uppercase">
                            ÂçÅÊ¨°
                        </button>
                    </div>
                </div>

                <!-- ËØ¶ÊÉÖÈ°µ -->
                <div v-else class="flex-1 flex flex-col animate-in slide-in-from-right duration-200 bg-[#020617]">
                    <div class="p-2.5 flex justify-between items-center border-b border-slate-800/50">
                        <button @click="selectedId = null" class="p-1 text-slate-500 hover:text-white transition-colors">
                            <i data-lucide="x" size="14"></i>
                        </button>
                        <span class="text-[8px] font-black text-slate-600 tracking-[0.3em] uppercase">Detail View</span>
                        <div class="w-6"></div>
                    </div>

                    <div class="flex-1 p-4 overflow-y-auto custom-scrollbar">
                        <div class="flex flex-col items-center mb-4">
                            <div :class="['w-16 h-16 rounded-xl bg-gradient-to-br p-[1px] shadow-2xl mb-2', rankColors[selectedItem.rank]]">
                                <div class="w-full h-full bg-[#020617] rounded-xl flex items-center justify-center text-3xl relative overflow-hidden">
                                    {{ selectedItem.icon }}
                                    <div class="absolute inset-0 bg-gradient-to-tr from-white/5 to-transparent opacity-50 animate-pulse"></div>
                                </div>
                            </div>
                            <h3 class="text-sm font-black text-white mb-0.5">{{ selectedItem.name }}</h3>
                            <div class="flex items-center gap-1">
                                <span class="text-[8px] text-slate-500 font-mono">ÊàêÈïø: {{ ((rankGrowth[selectedItem.rank] - 1) * 100).toFixed(0) }}%/Lv</span>
                            </div>
                        </div>

                        <div class="space-y-2">
                            <div class="bg-slate-900/40 p-2.5 rounded-lg border border-slate-800/50">
                                <div class="flex justify-between items-center mb-0.5">
                                    <h4 class="text-[7px] font-black text-blue-500 uppercase tracking-widest">Âçï‰ΩìÂÄçÁéá</h4>
                                    <span class="text-[7px] text-slate-600 font-mono">{{ selectedItem.attr }}</span>
                                </div>
                                <!-- Âçï‰ΩìÂÄçÁéáÂ±ïÁ§∫ -->
                                <div class="text-xl font-black text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-cyan-300 font-mono tracking-tight">
                                    √ó{{ formatNumber(calculateSinglePower(selectedId)) }}
                                </div>
                                <div class="text-[7px] text-slate-500 mt-1 flex justify-between">
                                    <span>‰∏ãÁ∫ßÈ¢ÑËßà:</span>
                                    <span class="text-green-400">√ó{{ formatNumber(calculateSinglePower(selectedId, 1)) }}</span>
                                </div>
                            </div>

                            <div class="bg-slate-900/40 p-2.5 rounded-lg border border-slate-800/50">
                                <h4 class="text-[7px] font-black text-blue-500 uppercase mb-0.5 tracking-widest">Âè§ÂÆù‰º†ËÆ∞</h4>
                                <p class="text-[8px] text-slate-500 leading-relaxed italic">
                                    {{ selectedItem.desc }}
                                </p>
                            </div>
                        </div>
                    </div>

                    <div class="p-4 border-t border-slate-800/50 bg-slate-900/20">
                        <div class="mb-3">
                            <div class="flex justify-between text-[7px] font-bold mb-1 px-0.5">
                                <span class="text-slate-500 uppercase tracking-widest">Ê≥®ÂÖ•ËøõÂ∫¶</span>
                                <span class="text-blue-400 font-mono">{{ selectedStats.level }}/10</span>
                            </div>
                            <div class="h-1 w-full bg-slate-800 rounded-full overflow-hidden">
                                <div 
                                    class="h-full bg-gradient-to-r from-blue-600 to-cyan-400 transition-all duration-500"
                                    :style="{ width: (selectedStats.level / 10 * 100) + '%' }"
                                ></div>
                            </div>
                        </div>

                        <button 
                            @click="handleUpgrade(selectedId)"
                            :disabled="selectedStats.shards <= 0"
                            :class="['w-full py-2.5 rounded-lg flex items-center justify-center gap-2 transition-all border shadow-sm', 
                                selectedStats.shards > 0 
                                ? 'bg-orange-600/90 border-orange-400 text-white hover:bg-orange-500 active:scale-95' 
                                : 'bg-slate-800 border-slate-700 text-slate-500 cursor-not-allowed opacity-50']"
                        >
                            <span class="text-[9px] font-black uppercase tracking-[0.1em]">{{ selectedStats.level === 0 ? 'ÊøÄÊ¥ª' : 'Ê≥®ÂÖ•' }}</span>
                            <span class="text-[7px] opacity-70">Á¢éÁâá x1 (‰Ωô:{{ selectedStats.shards }})</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- ÊäΩÂ•ñÁªìÊûú (ÂÖ®Â±èÁÇπÂáªÈÄÄÂá∫) -->
            <div 
                v-if="showResult" 
                @click="showResult = false"
                class="absolute inset-0 z-50 bg-[#020617]/90 backdrop-blur-xl flex flex-col items-center justify-center fade-in cursor-pointer"
            >
                <div class="flex flex-col items-center pointer-events-none w-full">
                    <h2 class="text-2xl font-black italic tracking-[1em] text-white/40 mb-10 uppercase drop-shadow-[0_5px_5px_rgba(0,0,0,0.5)]">ÂØª Âæó ÂÆù Áâ©</h2>
                    <div class="grid grid-cols-5 gap-4 max-w-4xl px-4 justify-items-center">
                        <div v-for="(item, idx) in drawResults" :key="idx" class="flex flex-col items-center group">
                            <div :class="['w-20 h-20 rounded-xl bg-gradient-to-br p-[2px] relative shadow-2xl transform transition-transform duration-300 group-hover:scale-110', rankColors[item.rank]]">
                                <div class="w-full h-full bg-[#020617] rounded-xl flex items-center justify-center text-4xl">
                                    {{ item.icon }}
                                    <div class="absolute -bottom-2 -right-2 bg-slate-900 border border-slate-700 rounded-md px-1.5 py-0.5 text-[10px] font-bold text-orange-400 shadow-lg">x1</div>
                                </div>
                            </div>
                            <p class="mt-3 text-[10px] font-black text-slate-400 tracking-wider group-hover:text-blue-400 transition-colors">{{ item.name }}</p>
                        </div>
                    </div>
                    <div class="mt-16 text-[10px] font-bold text-slate-500 tracking-[0.5em] uppercase border-b border-slate-800 pb-1 animate-pulse">
                        ÁÇπÂáª‰ªªÊÑè‰ΩçÁΩÆÂÖ≥Èó≠
                    </div>
                </div>
            </div>

            <!-- ÂÖ®Â±ÄÈÄöÁü• -->
            <div v-if="toastMsg" class="absolute bottom-6 left-1/2 -translate-x-1/2 z-[100] px-4 py-1.5 bg-blue-600/90 text-white text-[9px] font-bold rounded-full shadow-2xl backdrop-blur-md animate-bounce">
                {{ toastMsg }}
            </div>

            <!-- Âä®ÁîªÈÅÆÁΩ© -->
            <div v-if="isDrawing" class="absolute inset-0 z-[60] bg-[#020617] flex items-center justify-center">
                <div class="flex flex-col items-center gap-2">
                    <div class="w-8 h-8 border-2 border-blue-500/20 border-t-blue-500 rounded-full animate-spin"></div>
                    <span class="text-[7px] font-black text-blue-500 tracking-[0.3em] uppercase">Êé¢Êü•‰∏≠...</span>
                </div>
            </div>

        </div>
    </div>

    <script>
        const { createApp, ref, computed, onMounted, nextTick } = Vue;

        createApp({
            setup() {
                const library = {
                    'Âá°ÁïåÂè§ÂÆù': [
                        { id: 1, name: 'ÈùíÁ´πËúÇ‰∫ëÂâë', rank: 'UR', icon: 'üó°Ô∏è', desc: 'ÈáëÈõ∑Á´πÁÇºÊàêÔºåËæüÈÇ™Á•ûÈõ∑„ÄÇ', attr: 'ÊîªÂáª' },
                        { id: 2, name: 'ËôöÂ§©Èºé', rank: 'UR', icon: 'üçØ', desc: '‰π±ÊòüÊµ∑Á¨¨‰∏ÄÁßòÂÆù„ÄÇ', attr: 'Èò≤Âæ°' },
                        { id: 3, name: 'ÈïáÊµ∑Èíü', rank: 'UR', icon: 'üîî', desc: 'ÈíüÂ£∞ÂìçËµ∑Ôºå‰∏áÊ≥ïÁöÜÁ©∫„ÄÇ', attr: 'ÊéßÂà∂' },
                        { id: 4, name: 'Â¶ÇÊÑèÂúà', rank: 'SSR', icon: '‚≠ï', desc: 'Âõ∞Êïå‰πãÂÆùÔºåÈöèÂøÉËÄåÂä®„ÄÇ', attr: 'ÊïèÊç∑' },
                        { id: 5, name: 'È£éÈõ∑ÁøÖ', rank: 'SSR', icon: 'ü¶ã', desc: 'ÈÅÅÈÄüÊÉä‰∫∫ÔºåËûçÂêàÈ£éÈõ∑„ÄÇ', attr: 'ÊïèÊç∑' },
                        { id: 6, name: 'Ê∑∑ÂÖÉÈíµ', rank: 'SSR', icon: 'ü•£', desc: 'Âê∏Á∫≥ÁÅµÊ∞îÔºåÂõûÂ§çÁúüÂÖÉ„ÄÇ', attr: 'ÂõûÂ§ç' },
                        { id: 7, name: '‰∫îË°åÁéØ', rank: 'SR', icon: 'üíç', desc: '‰∫îË°åÁõ∏ÁîüÔºåÊîªÂÆàÂÖºÂ§á„ÄÇ', attr: 'ÂùáË°°' },
                        { id: 8, name: 'ÁôΩÈ≥ûÁõæ', rank: 'SR', icon: 'üõ°Ô∏è', desc: 'Ê∑±Êµ∑ËõüÈ≥ûÔºåÂùö‰∏çÂèØÊëß„ÄÇ', attr: 'ÂÖç‰º§' },
                        { id: 9, name: 'ÊµÅÊòüÂù†', rank: 'SR', icon: 'üíé', desc: 'ÊèêÂçáÊÑüÁü•ÔºåÊòüËæ∞‰πãÂäõ„ÄÇ', attr: 'Êö¥Âáª' },
                        { id: 10, name: 'ÂºïÈ≠ÇÁÅØ', rank: 'R', icon: 'üèÆ', desc: 'ÊåáÂºïÁ•ûÈ≠ÇÔºåÂä†ÈÄü‰øÆÁÇº„ÄÇ', attr: 'ÁúüÂÖÉ' },
                        { id: 11, name: 'ÁôæËçâÈîÑ', rank: 'R', icon: '‚õèÔ∏è', desc: 'ËçØÂ∏à‰πãÂà©ÔºåÈááÈõÜÂøÖÂ§á„ÄÇ', attr: 'ÈááÈõÜ' },
                        { id: 12, name: 'Ê∏ÖÂøÉÈìÉ', rank: 'R', icon: 'üîî', desc: 'Âπ≥Â§çÂøÉÈ≠îÔºåÂõ∫ÂÆàÊú¨Ê∫ê„ÄÇ', attr: 'ÊäóÊÄß' },
                        { id: 13, name: 'ÂºÄÂ±±Êñß', rank: 'R', icon: 'ü™ì', desc: 'ÂäõÂ§ßÊó†Á©∑„ÄÇ', attr: 'ÈáçÂáª' },
                        { id: 14, name: 'ÈÅøÊ∞¥Áè†', rank: 'R', icon: 'üíß', desc: 'ÂÖ•Ê∞¥Â¶ÇÂ∏∏„ÄÇ', attr: 'ÁßªÈÄü' },
                        { id: 15, name: 'ÂÆöÈ≠ÇÁè†', rank: 'R', icon: '‚ö™', desc: 'ÂÆö‰ΩèÁ•ûÈ≠Ç„ÄÇ', attr: 'ÊäóÊÄß' },
                        { id: 16, name: 'ÊçÜ‰ªôÁª≥', rank: 'SR', icon: 'ü™¢', desc: 'ÊùüÁºöË°åÂä®„ÄÇ', attr: 'ÊéßÂà∂' },
                        { id: 17, name: '‰πæÂù§Êâá', rank: 'SSR', icon: 'ü™≠', desc: 'ÊâáÂä®‰πæÂù§ÔºåÈ£ìÈ£éÁ™ÅË¢≠„ÄÇ', attr: 'ËåÉÂõ¥' },
                        { id: 18, name: 'ÂåñÂäüÁ¢ü', rank: 'SR', icon: 'Áöø', desc: 'Âê∏‰∫∫ÂÜÖÂäüÔºåÊçü‰∫∫Âà©Â∑±„ÄÇ', attr: 'Âê∏Âèñ' },
                        { id: 19, name: 'ËÅöÁÅµÁü≥', rank: 'R', icon: 'ü™®', desc: 'ËÅöÈõÜÂæÆÂº±ÁÅµÊ∞î„ÄÇ', attr: '‰øÆÁÇº' },
                        { id: 20, name: 'ÈìÅÁ∫øÁΩë', rank: 'R', icon: 'üï∏Ô∏è', desc: 'ÊçïËé∑ÁÅµÂÖΩ‰πãÁî®„ÄÇ', attr: 'ÊçïÊçâ' },
                        { id: 21, name: 'ÁéÑÈªÑÂ°î', rank: 'UR', icon: 'üóº', desc: 'ÁéÑÈªÑÊØçÊ∞îÔºå‰∏áÂä´‰∏çÁ£®„ÄÇ', attr: 'ÂÖ®Âæ°' },
                        { id: 22, name: 'ÈæôÈ≥ûÂàÉ', rank: 'SSR', icon: 'üó°Ô∏è', desc: 'ËõüÈæô‰πãÈ≥ûÔºåÁ†¥Áî≤Â¶ÇÊ≥•„ÄÇ', attr: 'Á©øÈÄè' },
                        { id: 23, name: 'Á¥´‰∫ëÁÇâ', rank: 'SR', icon: 'üî•', desc: 'ÁÇº‰∏πÂú£ÂìÅÔºå‰∏πÈ¶ôÂõõÊ∫¢„ÄÇ', attr: 'ÊïàÁéá' },
                    ],
                    'ÁÅµÁïåÂè§ÂÆù': [
                        { id: 101, name: 'Êñ©ÁÅµÂâë', rank: 'UR', icon: '‚öîÔ∏è', desc: '‰∏ÄÂâëÊå•Âá∫ÔºåËôöÁ©∫ÈúáË£Ç„ÄÇ', attr: 'Á©øÈÄè' },
                        { id: 102, name: '‰∏ÉÂÆùÂ¶ôÊ†ë', rank: 'UR', icon: 'üå≥', desc: 'Êó†Áâ©‰∏çÂà∑„ÄÇ', attr: 'ÂÖ®ËÉΩ' },
                        { id: 103, name: 'Â§™ÊûÅÂõæ', rank: 'UR', icon: '‚òØÔ∏è', desc: 'ÂÆö‰ΩèÈò¥Èò≥ÔºåÈáçÂàíÊ∑∑Ê≤å„ÄÇ', attr: 'Èò≤Âæ°' },
                        { id: 104, name: '‰∏áÂÆùËΩÆ', rank: 'SSR', icon: '‚ò∏Ô∏è', desc: 'Áº©Áü≠ÂÜ∑Âç¥„ÄÇ', attr: 'ÊÄ•ÈÄü' },
                        { id: 105, name: 'Á¥´ÈáëËë´Ëä¶', rank: 'SSR', icon: 'üç∂', desc: 'Âê∏Á∫≥ÊïåÊñπÁ•ûÈ≠Ç„ÄÇ', attr: 'Âê∏Ë°Ä' },
                        { id: 106, name: 'ÁøªÂ§©Âç∞', rank: 'SSR', icon: 'üß±', desc: 'Â∞ÅÁ¶ÅËôöÁ©∫„ÄÇ', attr: 'ÂéãÂà∂' },
                        { id: 107, name: 'ÊãõÂ¶ñÂπ°', rank: 'UR', icon: 'üö©', desc: 'Âè∑‰ª§Áæ§Â¶ñÔºåËé´Êï¢‰∏ç‰ªé„ÄÇ', attr: 'ÁªüÂ∏Ö' },
                        { id: 108, name: 'Èò¥Èò≥Èïú', rank: 'SSR', icon: 'ü™û', desc: 'ÁÖß‰∫∫Âç≥Ê≠ªÔºåËΩ¨Èù¢Âç≥Áîü„ÄÇ', attr: 'ÁîüÊ≠ª' },
                        { id: 109, name: 'Á†¥ÁïåÊ¢≠', rank: 'SR', icon: 'üöÄ', desc: 'Á†¥ÂºÄÁ¶ÅÂà∂„ÄÇ', attr: 'Á†¥Èöú' },
                        { id: 110, name: 'ËêΩÈ≠ÇÈìÉ', rank: 'SR', icon: 'üîï', desc: 'Á•ûÈ≠ÇÂπ≤Êâ∞„ÄÇ', attr: 'Á•ûËØÜ' },
                        { id: 111, name: 'ÂØíÂÜ∞Â∞∫', rank: 'R', icon: 'üìè', desc: 'ÁéÑÂÜ∞ÊâìÈÄ†„ÄÇ', attr: 'ÂÜ∞Èúú' },
                        { id: 112, name: 'ÁÉàÁÅ´Êóó', rank: 'R', icon: 'üéå', desc: 'ÁúüÁÅ´ÁÅºÁÉß„ÄÇ', attr: 'ÁÅ´ÁÑ∞' },
                        { id: 113, name: 'ÂÆöÊµ∑Áè†', rank: 'UR', icon: 'üîÆ', desc: '‰∫åÂçÅÂõõÈ¢óÔºåËá™ÊàêËØ∏Â§©„ÄÇ', attr: 'Ê≥ï‰º§' },
                        { id: 114, name: 'Êñ©‰ªôÈ£ûÂàÄ', rank: 'UR', icon: 'üè∫', desc: 'ËØ∑ÂÆùË¥ùËΩ¨Ë∫´ÔºÅ', attr: 'Êñ©ÊùÄ' },
                    ],
                };

                const rankColors = {
                    'UR': 'from-red-600 to-orange-500 shadow-red-500/20',
                    'SSR': 'from-orange-500 to-yellow-400 shadow-orange-500/20',
                    'SR': 'from-purple-600 to-pink-500 shadow-purple-500/20',
                    'R': 'from-blue-500 to-cyan-400 shadow-blue-500/20',
                };

                // Êï∞ÂÄºÂπ≥Ë°°ÂæÆË∞ÉÔºöÊåáÊï∞Â¢ûÈïøÂ∫ïÊï∞
                // UR 1.5ÂÄçÊØèÁ∫ßÔºåSSR 1.3ÂÄçÊØèÁ∫ß
                const rankGrowth = {
                    'UR': 1.50,
                    'SSR': 1.30,
                    'SR': 1.15,
                    'R': 1.05
                };

                // È¢ÑËÆ°ÁÆó Log10 ÊàêÈïøÁéáÔºå‰ºòÂåñËÆ°ÁÆóÊÄßËÉΩ
                const rankGrowthLog = {
                    'UR': Math.log10(1.50),
                    'SSR': Math.log10(1.30),
                    'SR': Math.log10(1.15),
                    'R': Math.log10(1.05)
                };

                const activeTab = ref('Âá°ÁïåÂè§ÂÆù');
                const playerData = ref({});
                const selectedId = ref(null);
                const isDrawing = ref(false);
                const showResult = ref(false);
                const drawResults = ref([]);
                const pityCount = ref(35);
                const toastMsg = ref("");

                const totalCount = computed(() => Object.values(library).flat().length);
                const collectedCount = computed(() => Object.values(playerData.value).filter(p => p.level > 0).length);

                const filteredLibrary = (rank) => {
                    return library[activeTab.value].filter(i => i.rank === rank);
                };

                const isUnlocked = (id) => playerData.value[id]?.level > 0;
                const hasShards = (id) => playerData.value[id]?.shards > 0;

                const selectedItem = computed(() => {
                    return Object.values(library).flat().find(i => i.id === selectedId.value);
                });

                const selectedStats = computed(() => {
                    return playerData.value[selectedId.value] || { shards: 0, level: 0, tier: 1 };
                });

                const getTotalLevel = (id) => {
                    const data = playerData.value[id];
                    if (!data) return 0;
                    return (data.tier - 1) * 10 + data.level;
                };

                // ÊôÆÈÄöÂçï‰ΩìËÆ°ÁÆóÔºàÁî®‰∫éÊòæÁ§∫Â∞èÊï∞ÂÄºÔºå<1e308Ôºâ
                const calculateSinglePower = (id, extraLevel = 0) => {
                    const item = Object.values(library).flat().find(i => i.id === id);
                    const level = getTotalLevel(id) + extraLevel;
                    if (!item || level === 0) return 1;
                    return Math.pow(rankGrowth[item.rank], level);
                };

                // Ê†∏ÂøÉÁÆóÊ≥ïÔºöËÆ°ÁÆó Log10 ÂΩ¢ÂºèÁöÑÊÄªÊàòÂäõ
                // Log(A * B) = Log(A) + Log(B)
                // ÊÄªÊàòÂäõ Log = sum(ÊØè‰∏™Âè§ÂÆùÁöÑ Log)
                // Âçï‰∏™Âè§ÂÆù Log = Á≠âÁ∫ß * Log(ÊàêÈïøÁéá)
                const totalLog10Power = computed(() => {
                    let totalLog = 0;
                    Object.keys(playerData.value).forEach(id => {
                        const item = Object.values(library).flat().find(i => i.id == id);
                        if(item) {
                            const level = getTotalLevel(id);
                            if(level > 0) {
                                totalLog += level * rankGrowthLog[item.rank];
                            }
                        }
                    });
                    return totalLog;
                });

                // ËÆ°ÁÆóÂΩìÂâçTabÁöÑ Log10 ÊàòÂäõ
                const tabLog10Power = (tabName) => {
                    let totalLog = 0;
                    library[tabName].forEach(item => {
                        const data = playerData.value[item.id];
                        if (data && data.level > 0) {
                            const level = (data.tier - 1) * 10 + data.level;
                            totalLog += level * rankGrowthLog[item.rank];
                        }
                    });
                    return totalLog;
                };

                // ÈÄöÁî®Â§ßÊï∞ÂÄºÊ†ºÂºèÂåñ
                const formatNumber = (num) => {
                    if (num < 10000) return num.toFixed(2);
                    return num.toExponential(2).replace('+', ''); // 1.23e45
                };

                // Log10 Ê†ºÂºèÂåñÔºöÂ∞Ü Log ÂÄºËΩ¨ÂõûÁßëÂ≠¶ËÆ°Êï∞Ê≥ïÊòæÁ§∫
                // Â¶ÇÊûú Log ÂÄºÊòØ 45.3ÔºåÊÑèÂë≥ÁùÄÂÆûÈôÖÂÄºÊòØ 10^45.3
                // 10^45.3 = 10^0.3 * 10^45 = 1.99 * 10^45 -> 1.99e45
                const formatLog10 = (logValue) => {
                    if (logValue < 4) { // Â∞è‰∫é 10000 (10^4)
                        return Math.pow(10, logValue).toFixed(2);
                    }
                    const exponent = Math.floor(logValue);
                    const mantissa = Math.pow(10, logValue - exponent);
                    return `${mantissa.toFixed(2)}e${exponent}`;
                };

                const showToast = (msg) => {
                    toastMsg.value = msg;
                    setTimeout(() => toastMsg.value = "", 2000);
                };

                const handleDraw = (count) => {
                    if (isDrawing.value) return;
                    isDrawing.value = true;
                    setTimeout(() => {
                        const pool = library[activeTab.value];
                        const results = [];
                        for (let i = 0; i < count; i++) {
                            const selected = pool[Math.floor(Math.random() * pool.length)];
                            if (!playerData.value[selected.id]) {
                                playerData.value[selected.id] = { shards: 1, level: 0, tier: 1 };
                            } else {
                                playerData.value[selected.id].shards += 1;
                            }
                            results.push(selected);
                        }
                        drawResults.value = results;
                        isDrawing.value = false;
                        showResult.value = true;
                        pityCount.value = Math.max(0, pityCount.value - count) === 0 ? 40 : pityCount.value - count;
                        nextTick(() => lucide.createIcons());
                    }, 500);
                };

                const handleUpgrade = (id) => {
                    const data = playerData.value[id];
                    if (!data || data.shards <= 0) return;
                    data.shards -= 1;
                    data.level += 1;
                    if (data.level > 10) {
                        data.level = 1;
                        data.tier += 1;
                    }
                    showToast("ÁÇºÂåñÊàêÂäü");
                    nextTick(() => lucide.createIcons());
                };

                const handleGlobalQuickUpgrade = () => {
                    let upgradedCount = 0;
                    Object.keys(playerData.value).forEach(id => {
                        const data = playerData.value[id];
                        if (data.shards > 0) {
                            const totalShards = data.shards;
                            let currentLevel = data.level;
                            let currentTier = data.tier;
                            let totalPoints = (currentTier - 1) * 10 + currentLevel + totalShards;
                            
                            data.tier = Math.floor((totalPoints - 1) / 10) + 1;
                            data.level = (totalPoints % 10) === 0 ? 10 : (totalPoints % 10);
                            data.shards = 0;
                            upgradedCount++;
                        }
                    });

                    if (upgradedCount > 0) {
                        showToast(`ÂÖ®ÂëòÁÇºÂåñÂÆåÊàêÔºå${upgradedCount}‰ª∂Âè§ÂÆùÂ∑≤Âº∫Âåñ`);
                    } else {
                        showToast("ÊöÇÊó†Á¢éÁâáÂèØ‰æõÁÇºÂåñ");
                    }
                };

                onMounted(() => {
                    lucide.createIcons();
                });

                return {
                    library, rankColors, activeTab, playerData, selectedId, 
                    isDrawing, showResult, drawResults, pityCount, toastMsg,
                    totalCount, collectedCount, rankGrowth, rankGrowthLog,
                    filteredLibrary, isUnlocked, hasShards, selectedItem, selectedStats,
                    handleDraw, handleUpgrade, handleGlobalQuickUpgrade,
                    getTotalLevel, calculateSinglePower, formatNumber, formatLog10, totalLog10Power, tabLog10Power
                };
            }
        }).mount('#app');
    </script>
</body>
</html>